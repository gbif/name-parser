<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span>package org.gbif.nameparser;<a name="line.1"></a>
<span class="sourceLineNo">002</span><a name="line.2"></a>
<span class="sourceLineNo">003</span>import org.gbif.api.model.checklistbank.ParsedName;<a name="line.3"></a>
<span class="sourceLineNo">004</span>import org.gbif.api.vocabulary.NamePart;<a name="line.4"></a>
<span class="sourceLineNo">005</span>import org.gbif.api.vocabulary.NameType;<a name="line.5"></a>
<span class="sourceLineNo">006</span>import org.gbif.api.vocabulary.Rank;<a name="line.6"></a>
<span class="sourceLineNo">007</span>import org.gbif.utils.file.FileUtils;<a name="line.7"></a>
<span class="sourceLineNo">008</span>import org.gbif.utils.file.InputStreamUtils;<a name="line.8"></a>
<span class="sourceLineNo">009</span><a name="line.9"></a>
<span class="sourceLineNo">010</span>import java.io.Reader;<a name="line.10"></a>
<span class="sourceLineNo">011</span>import java.util.List;<a name="line.11"></a>
<span class="sourceLineNo">012</span>import java.util.regex.Matcher;<a name="line.12"></a>
<span class="sourceLineNo">013</span><a name="line.13"></a>
<span class="sourceLineNo">014</span>import com.google.common.base.Joiner;<a name="line.14"></a>
<span class="sourceLineNo">015</span>import com.google.common.base.Splitter;<a name="line.15"></a>
<span class="sourceLineNo">016</span>import com.google.common.base.Strings;<a name="line.16"></a>
<span class="sourceLineNo">017</span>import junit.framework.TestCase;<a name="line.17"></a>
<span class="sourceLineNo">018</span>import org.apache.commons.io.LineIterator;<a name="line.18"></a>
<span class="sourceLineNo">019</span>import org.apache.commons.lang3.StringUtils;<a name="line.19"></a>
<span class="sourceLineNo">020</span>import org.junit.Ignore;<a name="line.20"></a>
<span class="sourceLineNo">021</span>import org.junit.Test;<a name="line.21"></a>
<span class="sourceLineNo">022</span>import org.slf4j.Logger;<a name="line.22"></a>
<span class="sourceLineNo">023</span>import org.slf4j.LoggerFactory;<a name="line.23"></a>
<span class="sourceLineNo">024</span><a name="line.24"></a>
<span class="sourceLineNo">025</span>import static org.junit.Assert.assertEquals;<a name="line.25"></a>
<span class="sourceLineNo">026</span>import static org.junit.Assert.assertFalse;<a name="line.26"></a>
<span class="sourceLineNo">027</span>import static org.junit.Assert.assertNotNull;<a name="line.27"></a>
<span class="sourceLineNo">028</span>import static org.junit.Assert.assertNull;<a name="line.28"></a>
<span class="sourceLineNo">029</span>import static org.junit.Assert.assertTrue;<a name="line.29"></a>
<span class="sourceLineNo">030</span>import static org.junit.Assert.fail;<a name="line.30"></a>
<span class="sourceLineNo">031</span><a name="line.31"></a>
<span class="sourceLineNo">032</span>/**<a name="line.32"></a>
<span class="sourceLineNo">033</span> * Test various scientific and non scientific names to parse.<a name="line.33"></a>
<span class="sourceLineNo">034</span> * TODO: Add tests for the following names found unparsed in CLB:<a name="line.34"></a>
<span class="sourceLineNo">035</span> * (?) Physignathus cochinchinensis Guérin, 1829<a name="line.35"></a>
<span class="sourceLineNo">036</span> * (Acmaeops)<a name="line.36"></a>
<span class="sourceLineNo">037</span> * (Acmaeops) rufula Gardiner, 1970<a name="line.37"></a>
<span class="sourceLineNo">038</span> * (Amsel, 1935)<a name="line.38"></a>
<span class="sourceLineNo">039</span> * (Antopocerus)<a name="line.39"></a>
<span class="sourceLineNo">040</span> * (Arocephalus) languidus (Flor, 1861)<a name="line.40"></a>
<span class="sourceLineNo">041</span> * (Athysanella) salsa (Ball &amp; Beamer, 1940)<a name="line.41"></a>
<span class="sourceLineNo">042</span> * (Erdianus) nigricans (Kirschbaum, 1868)<a name="line.42"></a>
<span class="sourceLineNo">043</span> * ? Callidium<a name="line.43"></a>
<span class="sourceLineNo">044</span> * ? Callidium (Phymatodes)<a name="line.44"></a>
<span class="sourceLineNo">045</span> * ? Callidium (Phymatodes) semicircularis Bland, 1862<a name="line.45"></a>
<span class="sourceLineNo">046</span> * ? Compsa<a name="line.46"></a>
<span class="sourceLineNo">047</span> * ? Compsa flavofasciata Martins &amp; Galileo, 2002<a name="line.47"></a>
<span class="sourceLineNo">048</span> */<a name="line.48"></a>
<span class="sourceLineNo">049</span>public class NameParserTest {<a name="line.49"></a>
<span class="sourceLineNo">050</span><a name="line.50"></a>
<span class="sourceLineNo">051</span>    private static Logger LOG = LoggerFactory.getLogger(NameParserTest.class);<a name="line.51"></a>
<span class="sourceLineNo">052</span>    private static final InputStreamUtils streamUtils = new InputStreamUtils();<a name="line.52"></a>
<span class="sourceLineNo">053</span>    private NameParser parser = new NameParser(50);<a name="line.53"></a>
<span class="sourceLineNo">054</span><a name="line.54"></a>
<span class="sourceLineNo">055</span>    private void assertHybridFormula(String name) {<a name="line.55"></a>
<span class="sourceLineNo">056</span>        try {<a name="line.56"></a>
<span class="sourceLineNo">057</span>            parser.parse(name, null);<a name="line.57"></a>
<span class="sourceLineNo">058</span>        } catch (UnparsableException e) {<a name="line.58"></a>
<span class="sourceLineNo">059</span>            assertEquals(NameType.HYBRID, e.type);<a name="line.59"></a>
<span class="sourceLineNo">060</span>        }<a name="line.60"></a>
<span class="sourceLineNo">061</span>    }<a name="line.61"></a>
<span class="sourceLineNo">062</span><a name="line.62"></a>
<span class="sourceLineNo">063</span>    private void assertHybridName(ParsedName pn) {<a name="line.63"></a>
<span class="sourceLineNo">064</span>        assertTrue(NameType.HYBRID != pn.getType());<a name="line.64"></a>
<span class="sourceLineNo">065</span>        assertTrue(pn.canonicalNameWithMarker().length() &gt; 8);<a name="line.65"></a>
<span class="sourceLineNo">066</span>    }<a name="line.66"></a>
<span class="sourceLineNo">067</span><a name="line.67"></a>
<span class="sourceLineNo">068</span>    private void assertUnparsableType(NameType type, String name) {<a name="line.68"></a>
<span class="sourceLineNo">069</span>        try {<a name="line.69"></a>
<span class="sourceLineNo">070</span>            parser.parse(name, null);<a name="line.70"></a>
<span class="sourceLineNo">071</span>            fail("Name should be an unparsable "+type+": " + name);<a name="line.71"></a>
<span class="sourceLineNo">072</span>        } catch (UnparsableException e) {<a name="line.72"></a>
<span class="sourceLineNo">073</span>            assertEquals(type, e.type);<a name="line.73"></a>
<span class="sourceLineNo">074</span>        }<a name="line.74"></a>
<span class="sourceLineNo">075</span>    }<a name="line.75"></a>
<span class="sourceLineNo">076</span><a name="line.76"></a>
<span class="sourceLineNo">077</span>    private void assertNoName(String name) {<a name="line.77"></a>
<span class="sourceLineNo">078</span>        assertUnparsableType(NameType.NO_NAME, name);<a name="line.78"></a>
<span class="sourceLineNo">079</span>    }<a name="line.79"></a>
<span class="sourceLineNo">080</span><a name="line.80"></a>
<span class="sourceLineNo">081</span>    private void assertUnparsableDoubtful(String name) {<a name="line.81"></a>
<span class="sourceLineNo">082</span>        try {<a name="line.82"></a>
<span class="sourceLineNo">083</span>            parser.parse(name, null);<a name="line.83"></a>
<span class="sourceLineNo">084</span>            fail("Name should be unparsable: " + name);<a name="line.84"></a>
<span class="sourceLineNo">085</span>        } catch (UnparsableException e) {<a name="line.85"></a>
<span class="sourceLineNo">086</span>            assertEquals(NameType.DOUBTFUL, e.type);<a name="line.86"></a>
<span class="sourceLineNo">087</span>        }<a name="line.87"></a>
<span class="sourceLineNo">088</span>    }<a name="line.88"></a>
<span class="sourceLineNo">089</span><a name="line.89"></a>
<span class="sourceLineNo">090</span>    private void allowUnparsable(String name) {<a name="line.90"></a>
<span class="sourceLineNo">091</span>        try {<a name="line.91"></a>
<span class="sourceLineNo">092</span>            parser.parse(name, null);<a name="line.92"></a>
<span class="sourceLineNo">093</span>        } catch (UnparsableException e) {<a name="line.93"></a>
<span class="sourceLineNo">094</span>        }<a name="line.94"></a>
<span class="sourceLineNo">095</span>    }<a name="line.95"></a>
<span class="sourceLineNo">096</span><a name="line.96"></a>
<span class="sourceLineNo">097</span>    // 0scientificName<a name="line.97"></a>
<span class="sourceLineNo">098</span>    // 1genusOrAbove<a name="line.98"></a>
<span class="sourceLineNo">099</span>    // 2infraGeneric<a name="line.99"></a>
<span class="sourceLineNo">100</span>    // 3specificEpithet<a name="line.100"></a>
<span class="sourceLineNo">101</span>    // 4infraSpecificEpithet<a name="line.101"></a>
<span class="sourceLineNo">102</span>    // 5 cultivarEpithet<a name="line.102"></a>
<span class="sourceLineNo">103</span>    // 6authorship<a name="line.103"></a>
<span class="sourceLineNo">104</span>    // 7year<a name="line.104"></a>
<span class="sourceLineNo">105</span>    // 8bracketAuthorship<a name="line.105"></a>
<span class="sourceLineNo">106</span>    // 9bracketYear<a name="line.106"></a>
<span class="sourceLineNo">107</span>    // 10rank<a name="line.107"></a>
<span class="sourceLineNo">108</span>    // 11nomcode<a name="line.108"></a>
<span class="sourceLineNo">109</span>    // 12nothotype<a name="line.109"></a>
<span class="sourceLineNo">110</span>    // 13nametype<a name="line.110"></a>
<span class="sourceLineNo">111</span>    private ParsedName buildParsedNameFromTabRow(String[] cols) {<a name="line.111"></a>
<span class="sourceLineNo">112</span>        ParsedName pn = null;<a name="line.112"></a>
<span class="sourceLineNo">113</span>        try {<a name="line.113"></a>
<span class="sourceLineNo">114</span>            pn = new ParsedName(NameType.fromString(cols[13]), StringUtils.trimToNull(cols[1]),<a name="line.114"></a>
<span class="sourceLineNo">115</span>                    StringUtils.trimToNull(cols[2]), StringUtils.trimToNull(cols[3]), StringUtils.trimToNull(cols[4]),<a name="line.115"></a>
<span class="sourceLineNo">116</span>                    NamePart.fromString(cols[12]), StringUtils.trimToNull(cols[10]), StringUtils.trimToNull(cols[6]),<a name="line.116"></a>
<span class="sourceLineNo">117</span>                    StringUtils.trimToNull(cols[7]), StringUtils.trimToNull(cols[8]), StringUtils.trimToNull(cols[9]),<a name="line.117"></a>
<span class="sourceLineNo">118</span>                    StringUtils.trimToNull(cols[5]), null, null, null, null);<a name="line.118"></a>
<span class="sourceLineNo">119</span>        } catch (ArrayIndexOutOfBoundsException e) {<a name="line.119"></a>
<span class="sourceLineNo">120</span>            LOG.error("scientific_names.txt file bogus, too little columns:\n{}", Joiner.on("|").useForNull("").join(cols));<a name="line.120"></a>
<span class="sourceLineNo">121</span>            throw e;<a name="line.121"></a>
<span class="sourceLineNo">122</span>        }<a name="line.122"></a>
<span class="sourceLineNo">123</span>        return pn;<a name="line.123"></a>
<span class="sourceLineNo">124</span>    }<a name="line.124"></a>
<span class="sourceLineNo">125</span><a name="line.125"></a>
<span class="sourceLineNo">126</span>    private String extractNomNote(String name) {<a name="line.126"></a>
<span class="sourceLineNo">127</span>        String nomNote = null;<a name="line.127"></a>
<span class="sourceLineNo">128</span>        Matcher matcher = NameParser.EXTRACT_NOMSTATUS.matcher(name);<a name="line.128"></a>
<span class="sourceLineNo">129</span>        if (matcher.find()) {<a name="line.129"></a>
<span class="sourceLineNo">130</span>            nomNote = (StringUtils.trimToNull(matcher.group(1)));<a name="line.130"></a>
<span class="sourceLineNo">131</span>        }<a name="line.131"></a>
<span class="sourceLineNo">132</span>        return nomNote;<a name="line.132"></a>
<span class="sourceLineNo">133</span>    }<a name="line.133"></a>
<span class="sourceLineNo">134</span><a name="line.134"></a>
<span class="sourceLineNo">135</span>    @Test<a name="line.135"></a>
<span class="sourceLineNo">136</span>    @Ignore<a name="line.136"></a>
<span class="sourceLineNo">137</span>    public void test4PartedNames() throws Exception {<a name="line.137"></a>
<span class="sourceLineNo">138</span>        ParsedName n = parser.parse("Bombus sichelii alticola latofasciatus", null);<a name="line.138"></a>
<span class="sourceLineNo">139</span>        assertEquals("Bombus sichelii infrasubsp. latofasciatus", n.canonicalNameWithMarker());<a name="line.139"></a>
<span class="sourceLineNo">140</span>        assertEquals("Bombus sichelii latofasciatus", n.canonicalName());<a name="line.140"></a>
<span class="sourceLineNo">141</span><a name="line.141"></a>
<span class="sourceLineNo">142</span>        n = parser.parse("Bombus sichelii alticola latofasciatus Vogt, 1909", null);<a name="line.142"></a>
<span class="sourceLineNo">143</span>        assertEquals("Bombus sichelii infrasubsp. latofasciatus", n.canonicalNameWithMarker());<a name="line.143"></a>
<span class="sourceLineNo">144</span>        assertEquals("Bombus sichelii latofasciatus", n.canonicalName());<a name="line.144"></a>
<span class="sourceLineNo">145</span>    }<a name="line.145"></a>
<span class="sourceLineNo">146</span><a name="line.146"></a>
<span class="sourceLineNo">147</span>    private boolean testAuthorship(String author) {<a name="line.147"></a>
<span class="sourceLineNo">148</span>        Matcher m = NormalisedNameParser.AUTHOR_TEAM_PATTERN.matcher(author);<a name="line.148"></a>
<span class="sourceLineNo">149</span>        if (m.find()) {<a name="line.149"></a>
<span class="sourceLineNo">150</span>            return true;<a name="line.150"></a>
<span class="sourceLineNo">151</span>        } else {<a name="line.151"></a>
<span class="sourceLineNo">152</span>            return false;<a name="line.152"></a>
<span class="sourceLineNo">153</span>        }<a name="line.153"></a>
<span class="sourceLineNo">154</span>    }<a name="line.154"></a>
<span class="sourceLineNo">155</span><a name="line.155"></a>
<span class="sourceLineNo">156</span>    /**<a name="line.156"></a>
<span class="sourceLineNo">157</span>     * Avoid NPEs and other exceptions for very short non names and other extremes found in occurrences.<a name="line.157"></a>
<span class="sourceLineNo">158</span>     */<a name="line.158"></a>
<span class="sourceLineNo">159</span>    @Test<a name="line.159"></a>
<span class="sourceLineNo">160</span>    public void testAvoidNPE() throws Exception {<a name="line.160"></a>
<span class="sourceLineNo">161</span>        allowUnparsable(null);<a name="line.161"></a>
<span class="sourceLineNo">162</span>        allowUnparsable(" ");<a name="line.162"></a>
<span class="sourceLineNo">163</span>        allowUnparsable("");<a name="line.163"></a>
<span class="sourceLineNo">164</span>        allowUnparsable("\"");<a name="line.164"></a>
<span class="sourceLineNo">165</span>        allowUnparsable("\\");<a name="line.165"></a>
<span class="sourceLineNo">166</span>        allowUnparsable(".");<a name="line.166"></a>
<span class="sourceLineNo">167</span>        allowUnparsable("a");<a name="line.167"></a>
<span class="sourceLineNo">168</span>        allowUnparsable("'");<a name="line.168"></a>
<span class="sourceLineNo">169</span>        allowUnparsable("von");<a name="line.169"></a>
<span class="sourceLineNo">170</span>        allowUnparsable("X");<a name="line.170"></a>
<span class="sourceLineNo">171</span>        allowUnparsable("@");<a name="line.171"></a>
<span class="sourceLineNo">172</span>        allowUnparsable("&amp;nbsp;");<a name="line.172"></a>
<span class="sourceLineNo">173</span>        allowUnparsable("\"? gryphoidis");<a name="line.173"></a>
<span class="sourceLineNo">174</span>    }<a name="line.174"></a>
<span class="sourceLineNo">175</span><a name="line.175"></a>
<span class="sourceLineNo">176</span>    @Test<a name="line.176"></a>
<span class="sourceLineNo">177</span>    public void testAuthorshipPattern() throws Exception {<a name="line.177"></a>
<span class="sourceLineNo">178</span>        assertTrue(this.testAuthorship("L."));<a name="line.178"></a>
<span class="sourceLineNo">179</span>        assertTrue(this.testAuthorship("Lin."));<a name="line.179"></a>
<span class="sourceLineNo">180</span>        assertTrue(this.testAuthorship("Linné"));<a name="line.180"></a>
<span class="sourceLineNo">181</span>        assertTrue(this.testAuthorship("DC."));<a name="line.181"></a>
<span class="sourceLineNo">182</span>        assertTrue(this.testAuthorship("de Chaudoir"));<a name="line.182"></a>
<span class="sourceLineNo">183</span>        assertTrue(this.testAuthorship("Hilaire"));<a name="line.183"></a>
<span class="sourceLineNo">184</span>        assertTrue(this.testAuthorship("St. Hilaire"));<a name="line.184"></a>
<span class="sourceLineNo">185</span>        assertTrue(this.testAuthorship("Geoffroy St. Hilaire"));<a name="line.185"></a>
<span class="sourceLineNo">186</span>        assertTrue(this.testAuthorship("Acev.-Rodr."));<a name="line.186"></a>
<span class="sourceLineNo">187</span>        assertTrue(this.testAuthorship("Steyerm., Aristeg. &amp; Wurdack"));<a name="line.187"></a>
<span class="sourceLineNo">188</span>        assertTrue(this.testAuthorship("Du Puy &amp; Labat"));<a name="line.188"></a>
<span class="sourceLineNo">189</span>        assertTrue(this.testAuthorship("Baum.-Bod."));<a name="line.189"></a>
<span class="sourceLineNo">190</span>        assertTrue(this.testAuthorship("Engl. &amp; v. Brehmer"));<a name="line.190"></a>
<span class="sourceLineNo">191</span>        assertTrue(this.testAuthorship("F. v. Muell."));<a name="line.191"></a>
<span class="sourceLineNo">192</span>        assertTrue(this.testAuthorship("W.J.de Wilde &amp; Duyfjes"));<a name="line.192"></a>
<span class="sourceLineNo">193</span>        assertTrue(this.testAuthorship("C.E.M.Bicudo"));<a name="line.193"></a>
<span class="sourceLineNo">194</span>        assertTrue(this.testAuthorship("Alves-da-Silva"));<a name="line.194"></a>
<span class="sourceLineNo">195</span>        assertTrue(this.testAuthorship("Alves-da-Silva &amp; C.E.M.Bicudo"));<a name="line.195"></a>
<span class="sourceLineNo">196</span>        assertTrue(this.testAuthorship("Kingdon-Ward"));<a name="line.196"></a>
<span class="sourceLineNo">197</span>        assertTrue(this.testAuthorship("Merr. &amp; L.M.Perry"));<a name="line.197"></a>
<span class="sourceLineNo">198</span>        assertTrue(this.testAuthorship("Calat., Nav.-Ros. &amp; Hafellner"));<a name="line.198"></a>
<span class="sourceLineNo">199</span>        assertTrue(this.testAuthorship("Barboza du Bocage"));<a name="line.199"></a>
<span class="sourceLineNo">200</span>        assertTrue(this.testAuthorship("Arv.-Touv. ex Dörfl."));<a name="line.200"></a>
<span class="sourceLineNo">201</span>        assertTrue(this.testAuthorship("Payri &amp; P.W.Gabrielson"));<a name="line.201"></a>
<span class="sourceLineNo">202</span>        assertTrue(this.testAuthorship("N'Yeurt, Payri &amp; P.W.Gabrielson"));<a name="line.202"></a>
<span class="sourceLineNo">203</span>        assertTrue(this.testAuthorship("VanLand."));<a name="line.203"></a>
<span class="sourceLineNo">204</span>        assertTrue(this.testAuthorship("MacLeish"));<a name="line.204"></a>
<span class="sourceLineNo">205</span>        assertTrue(this.testAuthorship("Monterosato ms."));<a name="line.205"></a>
<span class="sourceLineNo">206</span>        assertTrue(this.testAuthorship("Arn. ms., Grunow"));<a name="line.206"></a>
<span class="sourceLineNo">207</span>        assertTrue(this.testAuthorship("Mosely in Mosely &amp; Kimmins"));<a name="line.207"></a>
<span class="sourceLineNo">208</span>        assertTrue(this.testAuthorship("Choi,J.H.; Im,W.T.; Yoo,J.S.; Lee,S.M.; Moon,D.S.; Kim,H.J.; Rhee,S.K.; Roh,D.H."));<a name="line.208"></a>
<span class="sourceLineNo">209</span>        assertTrue(this.testAuthorship("da Costa Lima"));<a name="line.209"></a>
<span class="sourceLineNo">210</span>        assertTrue(this.testAuthorship("Krapov., W.C.Greg. &amp; C.E.Simpson"));<a name="line.210"></a>
<span class="sourceLineNo">211</span>        assertTrue(this.testAuthorship("de Jussieu"));<a name="line.211"></a>
<span class="sourceLineNo">212</span>        assertTrue(this.testAuthorship("Griseb. ex. Wedd."));<a name="line.212"></a>
<span class="sourceLineNo">213</span>        assertTrue(this.testAuthorship("van-der Land"));<a name="line.213"></a>
<span class="sourceLineNo">214</span>        assertTrue(this.testAuthorship("van der Land"));<a name="line.214"></a>
<span class="sourceLineNo">215</span>        assertTrue(this.testAuthorship("van Helmsick"));<a name="line.215"></a>
<span class="sourceLineNo">216</span>        assertTrue(this.testAuthorship("Xing, Yan &amp; Yin"));<a name="line.216"></a>
<span class="sourceLineNo">217</span>        assertTrue(this.testAuthorship("Xiao &amp; Knoll"));<a name="line.217"></a>
<span class="sourceLineNo">218</span>    }<a name="line.218"></a>
<span class="sourceLineNo">219</span><a name="line.219"></a>
<span class="sourceLineNo">220</span>    @Test<a name="line.220"></a>
<span class="sourceLineNo">221</span>    public void testNotNames() throws Exception {<a name="line.221"></a>
<span class="sourceLineNo">222</span>        ParsedName pn = parser.parse("Diatrypella favacea var. favacea (Fr.) Ces. &amp; De Not.", null);<a name="line.222"></a>
<span class="sourceLineNo">223</span>        assertEquals("Diatrypella", pn.getGenusOrAbove());<a name="line.223"></a>
<span class="sourceLineNo">224</span>        assertEquals("favacea", pn.getSpecificEpithet());<a name="line.224"></a>
<span class="sourceLineNo">225</span>        assertEquals("var.", pn.getRankMarker());<a name="line.225"></a>
<span class="sourceLineNo">226</span>        assertEquals("favacea", pn.getInfraSpecificEpithet());<a name="line.226"></a>
<span class="sourceLineNo">227</span>        assertEquals("Ces. &amp; De Not.", pn.getAuthorship());<a name="line.227"></a>
<span class="sourceLineNo">228</span>        assertEquals("Fr.", pn.getBracketAuthorship());<a name="line.228"></a>
<span class="sourceLineNo">229</span><a name="line.229"></a>
<span class="sourceLineNo">230</span>        pn = parser.parse("Protoventuria rosae (De Not.) Berl. &amp; Sacc.", null);<a name="line.230"></a>
<span class="sourceLineNo">231</span>        assertEquals("Protoventuria", pn.getGenusOrAbove());<a name="line.231"></a>
<span class="sourceLineNo">232</span>        assertEquals("rosae", pn.getSpecificEpithet());<a name="line.232"></a>
<span class="sourceLineNo">233</span>        assertEquals("Berl. &amp; Sacc.", pn.getAuthorship());<a name="line.233"></a>
<span class="sourceLineNo">234</span>        assertEquals("De Not.", pn.getBracketAuthorship());<a name="line.234"></a>
<span class="sourceLineNo">235</span><a name="line.235"></a>
<span class="sourceLineNo">236</span>        pn = parser.parse("Hormospora De Not.", null);<a name="line.236"></a>
<span class="sourceLineNo">237</span>        assertEquals("Hormospora", pn.getGenusOrAbove());<a name="line.237"></a>
<span class="sourceLineNo">238</span>        assertEquals("De Not.", pn.getAuthorship());<a name="line.238"></a>
<span class="sourceLineNo">239</span>    }<a name="line.239"></a>
<span class="sourceLineNo">240</span><a name="line.240"></a>
<span class="sourceLineNo">241</span>    @Test<a name="line.241"></a>
<span class="sourceLineNo">242</span>    public void testCanonNameParserSubgenera() throws Exception {<a name="line.242"></a>
<span class="sourceLineNo">243</span>        ParsedName pn = parser.parse("Polygonum subgen. Bistorta (L.) Zernov", null);<a name="line.243"></a>
<span class="sourceLineNo">244</span>        assertTrue(pn.getNotho() == null);<a name="line.244"></a>
<span class="sourceLineNo">245</span>        assertEquals("Polygonum", pn.getGenusOrAbove());<a name="line.245"></a>
<span class="sourceLineNo">246</span>        assertEquals("Bistorta", pn.getInfraGeneric());<a name="line.246"></a>
<span class="sourceLineNo">247</span>        assertEquals("subgen.", pn.getRankMarker());<a name="line.247"></a>
<span class="sourceLineNo">248</span>        assertEquals("Zernov", pn.getAuthorship());<a name="line.248"></a>
<span class="sourceLineNo">249</span>        assertEquals("L.", pn.getBracketAuthorship());<a name="line.249"></a>
<span class="sourceLineNo">250</span><a name="line.250"></a>
<span class="sourceLineNo">251</span>        ParsedName n = parser.parse("Arrhoges (Antarctohoges)", null);<a name="line.251"></a>
<span class="sourceLineNo">252</span>        assertEquals("Arrhoges", n.getGenusOrAbove());<a name="line.252"></a>
<span class="sourceLineNo">253</span>        assertEquals("Antarctohoges", n.getBracketAuthorship());<a name="line.253"></a>
<span class="sourceLineNo">254</span>        assertNull(n.getInfraGeneric());<a name="line.254"></a>
<span class="sourceLineNo">255</span>        assertNull(n.getRankMarker());<a name="line.255"></a>
<span class="sourceLineNo">256</span>        assertNull(n.getNotho());<a name="line.256"></a>
<span class="sourceLineNo">257</span><a name="line.257"></a>
<span class="sourceLineNo">258</span>        n = parser.parse("Arrhoges (Antarctohoges)", Rank.SUBGENUS);<a name="line.258"></a>
<span class="sourceLineNo">259</span>        assertEquals("Arrhoges", n.getGenusOrAbove());<a name="line.259"></a>
<span class="sourceLineNo">260</span>        assertEquals("Antarctohoges", n.getInfraGeneric());<a name="line.260"></a>
<span class="sourceLineNo">261</span>        assertTrue(n.getRankMarker() == Rank.SUBGENUS.getMarker());<a name="line.261"></a>
<span class="sourceLineNo">262</span>        assertTrue(n.getNotho() == null);<a name="line.262"></a>
<span class="sourceLineNo">263</span><a name="line.263"></a>
<span class="sourceLineNo">264</span>        pn = parser.parse("Festuca subg. Schedonorus (P. Beauv. ) Peterm.", null);<a name="line.264"></a>
<span class="sourceLineNo">265</span>        assertEquals("Festuca", pn.getGenusOrAbove());<a name="line.265"></a>
<span class="sourceLineNo">266</span>        assertEquals("Schedonorus", pn.getInfraGeneric());<a name="line.266"></a>
<span class="sourceLineNo">267</span>        assertEquals("subgen.", pn.getRankMarker());<a name="line.267"></a>
<span class="sourceLineNo">268</span>        assertEquals("Peterm.", pn.getAuthorship());<a name="line.268"></a>
<span class="sourceLineNo">269</span>        assertEquals("P. Beauv.", pn.getBracketAuthorship());<a name="line.269"></a>
<span class="sourceLineNo">270</span><a name="line.270"></a>
<span class="sourceLineNo">271</span>        n = parser.parse("Catapodium subg.Agropyropsis  Trab.", null);<a name="line.271"></a>
<span class="sourceLineNo">272</span>        assertEquals("Catapodium", n.getGenusOrAbove());<a name="line.272"></a>
<span class="sourceLineNo">273</span>        assertEquals("Agropyropsis", n.getInfraGeneric());<a name="line.273"></a>
<span class="sourceLineNo">274</span>        assertEquals("subgen.", n.getRankMarker());<a name="line.274"></a>
<span class="sourceLineNo">275</span><a name="line.275"></a>
<span class="sourceLineNo">276</span>        n = parser.parse(" Gnaphalium subg. Laphangium Hilliard &amp; B. L. Burtt", null);<a name="line.276"></a>
<span class="sourceLineNo">277</span>        assertEquals("Gnaphalium", n.getGenusOrAbove());<a name="line.277"></a>
<span class="sourceLineNo">278</span>        assertEquals("Laphangium", n.getInfraGeneric());<a name="line.278"></a>
<span class="sourceLineNo">279</span>        assertEquals("subgen.", n.getRankMarker());<a name="line.279"></a>
<span class="sourceLineNo">280</span><a name="line.280"></a>
<span class="sourceLineNo">281</span>        n = parser.parse("Woodsiaceae (Hooker) Herter", null);<a name="line.281"></a>
<span class="sourceLineNo">282</span>        assertEquals("Woodsiaceae", n.getGenusOrAbove());<a name="line.282"></a>
<span class="sourceLineNo">283</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.283"></a>
<span class="sourceLineNo">284</span>        assertTrue(n.getRankMarker() == null);<a name="line.284"></a>
<span class="sourceLineNo">285</span><a name="line.285"></a>
<span class="sourceLineNo">286</span>    }<a name="line.286"></a>
<span class="sourceLineNo">287</span><a name="line.287"></a>
<span class="sourceLineNo">288</span>    @Test<a name="line.288"></a>
<span class="sourceLineNo">289</span>    public void testClean1() throws Exception {<a name="line.289"></a>
<span class="sourceLineNo">290</span>        assertEquals("", NameParser.preClean(""));<a name="line.290"></a>
<span class="sourceLineNo">291</span>        assertEquals("Hallo Spencer", NameParser.preClean("Hallo Spencer "));<a name="line.291"></a>
<span class="sourceLineNo">292</span>        assertEquals("Hallo Spencer", NameParser.preClean("' 'Hallo Spencer"));<a name="line.292"></a>
<span class="sourceLineNo">293</span>        assertEquals("Hallo Spencer 1982", NameParser.preClean("'\" Hallo  Spencer 1982'"));<a name="line.293"></a>
<span class="sourceLineNo">294</span>    }<a name="line.294"></a>
<span class="sourceLineNo">295</span><a name="line.295"></a>
<span class="sourceLineNo">296</span>    private boolean testCultivar(String cultivar) {<a name="line.296"></a>
<span class="sourceLineNo">297</span>        Matcher m = NameParser.CULTIVAR.matcher(cultivar);<a name="line.297"></a>
<span class="sourceLineNo">298</span>        if (m.find()) {<a name="line.298"></a>
<span class="sourceLineNo">299</span>            return true;<a name="line.299"></a>
<span class="sourceLineNo">300</span>        } else {<a name="line.300"></a>
<span class="sourceLineNo">301</span>            return false;<a name="line.301"></a>
<span class="sourceLineNo">302</span>        }<a name="line.302"></a>
<span class="sourceLineNo">303</span>    }<a name="line.303"></a>
<span class="sourceLineNo">304</span><a name="line.304"></a>
<span class="sourceLineNo">305</span>    private ParsedName parseCandidatus(String name, String expectedGenus, String expectedSpecies, String expectedInfraSpecies)<a name="line.305"></a>
<span class="sourceLineNo">306</span>            throws UnparsableException {<a name="line.306"></a>
<span class="sourceLineNo">307</span>        ParsedName pn = parser.parse(name, null);<a name="line.307"></a>
<span class="sourceLineNo">308</span>        assertEquals(NameType.CANDIDATUS, pn.getType());<a name="line.308"></a>
<span class="sourceLineNo">309</span><a name="line.309"></a>
<span class="sourceLineNo">310</span>        assertEquals(Strings.nullToEmpty(expectedGenus), Strings.nullToEmpty(pn.getGenusOrAbove()));<a name="line.310"></a>
<span class="sourceLineNo">311</span>        assertEquals(Strings.nullToEmpty(expectedSpecies), Strings.nullToEmpty(pn.getSpecificEpithet()));<a name="line.311"></a>
<span class="sourceLineNo">312</span>        assertEquals(Strings.nullToEmpty(expectedInfraSpecies), Strings.nullToEmpty(pn.getInfraSpecificEpithet()));<a name="line.312"></a>
<span class="sourceLineNo">313</span><a name="line.313"></a>
<span class="sourceLineNo">314</span>        return pn;<a name="line.314"></a>
<span class="sourceLineNo">315</span>    }<a name="line.315"></a>
<span class="sourceLineNo">316</span><a name="line.316"></a>
<span class="sourceLineNo">317</span>    @Test<a name="line.317"></a>
<span class="sourceLineNo">318</span>    public void testCandidatus() throws Exception {<a name="line.318"></a>
<span class="sourceLineNo">319</span>        ParsedName pn = parseCandidatus("\"Candidatus Endowatersipora\" Anderson and Haygood, 2007", "Endowatersipora", null, null);<a name="line.319"></a>
<span class="sourceLineNo">320</span>        assertEquals("Anderson &amp; Haygood", pn.getAuthorship());<a name="line.320"></a>
<span class="sourceLineNo">321</span>        assertEquals("2007", pn.getYear());<a name="line.321"></a>
<span class="sourceLineNo">322</span><a name="line.322"></a>
<span class="sourceLineNo">323</span>        pn = parseCandidatus("Candidatus Phytoplasma allocasuarinae", "Phytoplasma", "allocasuarinae", null);<a name="line.323"></a>
<span class="sourceLineNo">324</span><a name="line.324"></a>
<span class="sourceLineNo">325</span>        pn = parseCandidatus("Ca. Phytoplasma allocasuarinae", "Phytoplasma", "allocasuarinae", null);<a name="line.325"></a>
<span class="sourceLineNo">326</span><a name="line.326"></a>
<span class="sourceLineNo">327</span>        pn = parseCandidatus("Candidatus Phytoplasma", "Phytoplasma", null, null);<a name="line.327"></a>
<span class="sourceLineNo">328</span>        pn = parseCandidatus("Ca. Phytoplasma", "Phytoplasma", null, null);<a name="line.328"></a>
<span class="sourceLineNo">329</span><a name="line.329"></a>
<span class="sourceLineNo">330</span>        pn = parseCandidatus("'Candidatus Nicolleia'", "Nicolleia", null, null);<a name="line.330"></a>
<span class="sourceLineNo">331</span><a name="line.331"></a>
<span class="sourceLineNo">332</span><a name="line.332"></a>
<span class="sourceLineNo">333</span>        pn = parseCandidatus("\"Candidatus Riegeria\" Gruber-Vodicka et al., 2011", "Riegeria", null, null);<a name="line.333"></a>
<span class="sourceLineNo">334</span>        assertEquals("Gruber-Vodicka et al.", pn.getAuthorship());<a name="line.334"></a>
<span class="sourceLineNo">335</span>        assertEquals("2011", pn.getYear());<a name="line.335"></a>
<span class="sourceLineNo">336</span><a name="line.336"></a>
<span class="sourceLineNo">337</span>        //TODO: parse strains<a name="line.337"></a>
<span class="sourceLineNo">338</span>        //pn = parseCandidatus("Candidatus Midichloria sp. ixholo1", "Midichloria", "ixholo1",null);<a name="line.338"></a>
<span class="sourceLineNo">339</span>        //pn = parseCandidatus("Candidatus Endobugula sp. JYr4", "Endobugula", "JYr4",null);<a name="line.339"></a>
<span class="sourceLineNo">340</span><a name="line.340"></a>
<span class="sourceLineNo">341</span>    }<a name="line.341"></a>
<span class="sourceLineNo">342</span><a name="line.342"></a>
<span class="sourceLineNo">343</span>    /**<a name="line.343"></a>
<span class="sourceLineNo">344</span>     * @see &lt;a href="http://dev.gbif.org/issues/browse/GBIFCOM-11"&gt;GBIFCOM-11&lt;/a&gt;<a name="line.344"></a>
<span class="sourceLineNo">345</span>     */<a name="line.345"></a>
<span class="sourceLineNo">346</span>    @Test<a name="line.346"></a>
<span class="sourceLineNo">347</span>    public void testExNames() throws Exception {<a name="line.347"></a>
<span class="sourceLineNo">348</span>        ParsedName pn = assertExAuthorName(parser.parse("Abies brevifolia cv. ex Dallim.", null));<a name="line.348"></a>
<span class="sourceLineNo">349</span>        pn = assertExAuthorName(parser.parse("Abies brevifolia hort. ex Dallim.", null));<a name="line.349"></a>
<span class="sourceLineNo">350</span>        pn = assertExAuthorName(parser.parse("Abutilon bastardioides Baker f. ex Rose", null));<a name="line.350"></a>
<span class="sourceLineNo">351</span>        pn = assertExAuthorName(parser.parse("Acacia truncata (Burm. f.) hort. ex Hoffmanns.", null));<a name="line.351"></a>
<span class="sourceLineNo">352</span>        pn = assertExAuthorName(parser.parse("Anoectocalyx ex Cogn. 'Triana'", null));<a name="line.352"></a>
<span class="sourceLineNo">353</span>        pn = assertExAuthorName(parser.parse("Anoectocalyx \"Triana\" ex Cogn.  ", null));<a name="line.353"></a>
<span class="sourceLineNo">354</span>        pn = assertExAuthorName(parser.parse("Aukuba ex Koehne 'Thunb'   ", null));<a name="line.354"></a>
<span class="sourceLineNo">355</span>        pn = assertExAuthorName(parser.parse("Crepinella subgen. Marchal ex Oliver  ", null));<a name="line.355"></a>
<span class="sourceLineNo">356</span>        pn = assertExAuthorName(parser.parse("Echinocereus sect. Triglochidiata ex Bravo", null));<a name="line.356"></a>
<span class="sourceLineNo">357</span>        pn = assertExAuthorName(parser.parse("Hadrolaelia sect. Sophronitis ex Chiron &amp; V.P.Castro", null));<a name="line.357"></a>
<span class="sourceLineNo">358</span><a name="line.358"></a>
<span class="sourceLineNo">359</span>        pn = assertExAuthorName(parser.parse("Abutilon ×hybridum cv. ex Voss", null));<a name="line.359"></a>
<span class="sourceLineNo">360</span>    }<a name="line.360"></a>
<span class="sourceLineNo">361</span><a name="line.361"></a>
<span class="sourceLineNo">362</span>    private ParsedName assertExAuthorName(ParsedName pn) {<a name="line.362"></a>
<span class="sourceLineNo">363</span>        assertFalse("ex".equalsIgnoreCase(pn.getSpecificEpithet()));<a name="line.363"></a>
<span class="sourceLineNo">364</span>        assertFalse("ex".equalsIgnoreCase(pn.getInfraSpecificEpithet()));<a name="line.364"></a>
<span class="sourceLineNo">365</span>        assertFalse("ex".equalsIgnoreCase(pn.getInfraGeneric()));<a name="line.365"></a>
<span class="sourceLineNo">366</span>        assertNotNull(pn.getGenusOrAbove());<a name="line.366"></a>
<span class="sourceLineNo">367</span>        return pn;<a name="line.367"></a>
<span class="sourceLineNo">368</span>    }<a name="line.368"></a>
<span class="sourceLineNo">369</span><a name="line.369"></a>
<span class="sourceLineNo">370</span>    @Test<a name="line.370"></a>
<span class="sourceLineNo">371</span>    public void testCultivarNames() throws Exception {<a name="line.371"></a>
<span class="sourceLineNo">372</span>        ParsedName pn = parser.parse("Abutilon 'Kentish Belle'", null);<a name="line.372"></a>
<span class="sourceLineNo">373</span>        assertEquals("Abutilon", pn.getGenusOrAbove());<a name="line.373"></a>
<span class="sourceLineNo">374</span>        assertEquals(NameType.CULTIVAR, pn.getType());<a name="line.374"></a>
<span class="sourceLineNo">375</span><a name="line.375"></a>
<span class="sourceLineNo">376</span>        pn = parser.parse("Abutilon 'Nabob'", null);<a name="line.376"></a>
<span class="sourceLineNo">377</span>        assertEquals("Abutilon", pn.getGenusOrAbove());<a name="line.377"></a>
<span class="sourceLineNo">378</span>        assertEquals(NameType.CULTIVAR, pn.getType());<a name="line.378"></a>
<span class="sourceLineNo">379</span><a name="line.379"></a>
<span class="sourceLineNo">380</span>        pn = parser.parse("Verpericola megasoma \"Dall\" Pils.", null);<a name="line.380"></a>
<span class="sourceLineNo">381</span>        assertEquals("Verpericola", pn.getGenusOrAbove());<a name="line.381"></a>
<span class="sourceLineNo">382</span>        assertEquals("megasoma", pn.getSpecificEpithet());<a name="line.382"></a>
<span class="sourceLineNo">383</span>        assertEquals(NameType.CULTIVAR, pn.getType());<a name="line.383"></a>
<span class="sourceLineNo">384</span><a name="line.384"></a>
<span class="sourceLineNo">385</span>        pn = parser.parse("Sorbus americana Marshall cv. 'Belmonte'", null);<a name="line.385"></a>
<span class="sourceLineNo">386</span>        assertEquals("Sorbus", pn.getGenusOrAbove());<a name="line.386"></a>
<span class="sourceLineNo">387</span>        assertEquals("americana", pn.getSpecificEpithet());<a name="line.387"></a>
<span class="sourceLineNo">388</span>        assertEquals(NameType.CULTIVAR, pn.getType());<a name="line.388"></a>
<span class="sourceLineNo">389</span><a name="line.389"></a>
<span class="sourceLineNo">390</span>        pn = parser.parse("Sorbus hupehensis C.K.Schneid. cv. 'November pink'", null);<a name="line.390"></a>
<span class="sourceLineNo">391</span>        assertEquals("Sorbus", pn.getGenusOrAbove());<a name="line.391"></a>
<span class="sourceLineNo">392</span>        assertEquals("hupehensis", pn.getSpecificEpithet());<a name="line.392"></a>
<span class="sourceLineNo">393</span>        assertEquals(NameType.CULTIVAR, pn.getType());<a name="line.393"></a>
<span class="sourceLineNo">394</span><a name="line.394"></a>
<span class="sourceLineNo">395</span>        pn = parser.parse("Symphoricarpos albus (L.) S.F.Blake cv. 'Turesson'", null);<a name="line.395"></a>
<span class="sourceLineNo">396</span>        assertEquals("Symphoricarpos", pn.getGenusOrAbove());<a name="line.396"></a>
<span class="sourceLineNo">397</span>        assertEquals("albus", pn.getSpecificEpithet());<a name="line.397"></a>
<span class="sourceLineNo">398</span>        assertEquals(NameType.CULTIVAR, pn.getType());<a name="line.398"></a>
<span class="sourceLineNo">399</span>        assertEquals(Rank.CULTIVAR, pn.getRank());<a name="line.399"></a>
<span class="sourceLineNo">400</span><a name="line.400"></a>
<span class="sourceLineNo">401</span>        pn = parser.parse("Symphoricarpos sp. cv. 'mother of pearl'", null);<a name="line.401"></a>
<span class="sourceLineNo">402</span>        assertEquals("Symphoricarpos", pn.getGenusOrAbove());<a name="line.402"></a>
<span class="sourceLineNo">403</span>        assertEquals(NameType.CULTIVAR, pn.getType());<a name="line.403"></a>
<span class="sourceLineNo">404</span>        assertEquals(Rank.CULTIVAR, pn.getRank());<a name="line.404"></a>
<span class="sourceLineNo">405</span><a name="line.405"></a>
<span class="sourceLineNo">406</span>    }<a name="line.406"></a>
<span class="sourceLineNo">407</span><a name="line.407"></a>
<span class="sourceLineNo">408</span>    @Test<a name="line.408"></a>
<span class="sourceLineNo">409</span>    public void testCultivarPattern() throws Exception {<a name="line.409"></a>
<span class="sourceLineNo">410</span>        assertTrue(this.testCultivar("'Kentish Belle'"));<a name="line.410"></a>
<span class="sourceLineNo">411</span>        assertTrue(this.testCultivar("'Nabob'"));<a name="line.411"></a>
<span class="sourceLineNo">412</span>        assertTrue(this.testCultivar("\"Dall\""));<a name="line.412"></a>
<span class="sourceLineNo">413</span>        assertTrue(this.testCultivar(" cv. 'Belmonte'"));<a name="line.413"></a>
<span class="sourceLineNo">414</span>        assertTrue(this.testCultivar("Sorbus hupehensis C.K.Schneid. cv. 'November pink'"));<a name="line.414"></a>
<span class="sourceLineNo">415</span>        assertTrue(this.testCultivar("Symphoricarpos albus (L.) S.F.Blake cv. 'Turesson'"));<a name="line.415"></a>
<span class="sourceLineNo">416</span>        assertTrue(this.testCultivar("Symphoricarpos sp. cv. 'mother of pearl'"));<a name="line.416"></a>
<span class="sourceLineNo">417</span><a name="line.417"></a>
<span class="sourceLineNo">418</span>    }<a name="line.418"></a>
<span class="sourceLineNo">419</span><a name="line.419"></a>
<span class="sourceLineNo">420</span>    @Test<a name="line.420"></a>
<span class="sourceLineNo">421</span>    public void testEscaping() throws Exception {<a name="line.421"></a>
<span class="sourceLineNo">422</span>        assertEquals("Caloplaca poliotera (Nyl.) J. Steiner",<a name="line.422"></a>
<span class="sourceLineNo">423</span>                parser.normalize("Caloplaca poliotera (Nyl.) J. Steiner\\r\\n\\r\\n"));<a name="line.423"></a>
<span class="sourceLineNo">424</span><a name="line.424"></a>
<span class="sourceLineNo">425</span>        ParsedName pn = parser.parse("Caloplaca poliotera (Nyl.) J. Steiner\\r\\n\\r\\n.", null);<a name="line.425"></a>
<span class="sourceLineNo">426</span>        assertTrue(pn.getNotho() == null);<a name="line.426"></a>
<span class="sourceLineNo">427</span>        assertEquals("Caloplaca", pn.getGenusOrAbove());<a name="line.427"></a>
<span class="sourceLineNo">428</span>        assertEquals("poliotera", pn.getSpecificEpithet());<a name="line.428"></a>
<span class="sourceLineNo">429</span>        assertEquals("Nyl.", pn.getBracketAuthorship());<a name="line.429"></a>
<span class="sourceLineNo">430</span>        assertEquals("J. Steiner", pn.getAuthorship());<a name="line.430"></a>
<span class="sourceLineNo">431</span>    }<a name="line.431"></a>
<span class="sourceLineNo">432</span><a name="line.432"></a>
<span class="sourceLineNo">433</span>    @Test<a name="line.433"></a>
<span class="sourceLineNo">434</span>    public void testHybridFormulas() throws Exception {<a name="line.434"></a>
<span class="sourceLineNo">435</span>        assertHybridFormula("Arthopyrenia hyalospora X Hydnellum scrobiculatum");<a name="line.435"></a>
<span class="sourceLineNo">436</span>        assertHybridFormula("Arthopyrenia hyalospora (Banker) D. Hall X Hydnellum scrobiculatum D.E. Stuntz");<a name="line.436"></a>
<span class="sourceLineNo">437</span>        assertHybridFormula("Arthopyrenia hyalospora × ? ");<a name="line.437"></a>
<span class="sourceLineNo">438</span>        assertHybridFormula("Agrostis L. × Polypogon Desf. ");<a name="line.438"></a>
<span class="sourceLineNo">439</span>        assertHybridFormula("Agrostis stolonifera L. × Polypogon monspeliensis (L.) Desf. ");<a name="line.439"></a>
<span class="sourceLineNo">440</span>        assertHybridFormula("Asplenium rhizophyllum X A. ruta-muraria E.L. Braun 1939");<a name="line.440"></a>
<span class="sourceLineNo">441</span>        assertHybridFormula("Asplenium rhizophyllum DC. x ruta-muraria E.L. Braun 1939");<a name="line.441"></a>
<span class="sourceLineNo">442</span>        assertHybridFormula("Asplenium rhizophyllum x ruta-muraria");<a name="line.442"></a>
<span class="sourceLineNo">443</span>        assertHybridFormula("Salix aurita L. × S. caprea L.");<a name="line.443"></a>
<span class="sourceLineNo">444</span>        assertHybridFormula("Mentha aquatica L. × M. arvensis L. × M. spicata L.");<a name="line.444"></a>
<span class="sourceLineNo">445</span>        assertHybridFormula("Polypodium vulgare subsp. prionodes (Asch.) Rothm. × subsp. vulgare");<a name="line.445"></a>
<span class="sourceLineNo">446</span>        assertHybridFormula("Tilletia caries (Bjerk.) Tul. × T. foetida (Wallr.) Liro.");<a name="line.446"></a>
<span class="sourceLineNo">447</span><a name="line.447"></a>
<span class="sourceLineNo">448</span>        assertEquals("Polypodium vulgare nothosubsp. mantoniae (Rothm.) Schidlay",<a name="line.448"></a>
<span class="sourceLineNo">449</span>                parser.parse("Polypodium  x vulgare nothosubsp. mantoniae (Rothm.) Schidlay ", null).fullName());<a name="line.449"></a>
<span class="sourceLineNo">450</span>        assertHybridName(parser.parse("Arthopyrenia hyalospora x ", null));<a name="line.450"></a>
<span class="sourceLineNo">451</span>    }<a name="line.451"></a>
<span class="sourceLineNo">452</span><a name="line.452"></a>
<span class="sourceLineNo">453</span>    @Test<a name="line.453"></a>
<span class="sourceLineNo">454</span>    public void testHybridAlikeNames() throws Exception {<a name="line.454"></a>
<span class="sourceLineNo">455</span>        ParsedName n = parser.parse("Huaiyuanella Xing, Yan &amp; Yin, 1984", null);<a name="line.455"></a>
<span class="sourceLineNo">456</span>        assertNull(n.getNotho());<a name="line.456"></a>
<span class="sourceLineNo">457</span>        assertEquals("Huaiyuanella", n.getGenusOrAbove());<a name="line.457"></a>
<span class="sourceLineNo">458</span>        assertNull(n.getSpecificEpithet());<a name="line.458"></a>
<span class="sourceLineNo">459</span>        assertEquals("Xing, Yan &amp; Yin", n.getAuthorship());<a name="line.459"></a>
<span class="sourceLineNo">460</span>        assertEquals("1984", n.getYear());<a name="line.460"></a>
<span class="sourceLineNo">461</span><a name="line.461"></a>
<span class="sourceLineNo">462</span>        n = parser.parse("Caveasphaera Xiao &amp; Knoll, 2000", null);<a name="line.462"></a>
<span class="sourceLineNo">463</span>        assertNull(n.getNotho());<a name="line.463"></a>
<span class="sourceLineNo">464</span>        assertEquals("Caveasphaera", n.getGenusOrAbove());<a name="line.464"></a>
<span class="sourceLineNo">465</span>        assertNull(n.getSpecificEpithet());<a name="line.465"></a>
<span class="sourceLineNo">466</span>        assertEquals("2000", n.getYear());<a name="line.466"></a>
<span class="sourceLineNo">467</span><a name="line.467"></a>
<span class="sourceLineNo">468</span>    }<a name="line.468"></a>
<span class="sourceLineNo">469</span><a name="line.469"></a>
<span class="sourceLineNo">470</span>    @Test<a name="line.470"></a>
<span class="sourceLineNo">471</span>    public void testHybridNames() throws Exception {<a name="line.471"></a>
<span class="sourceLineNo">472</span><a name="line.472"></a>
<span class="sourceLineNo">473</span>        ParsedName n = parser.parse("+ Pyrocrataegus willei L.L.Daniel", null);<a name="line.473"></a>
<span class="sourceLineNo">474</span>        assertEquals(NamePart.GENERIC, n.getNotho());<a name="line.474"></a>
<span class="sourceLineNo">475</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.475"></a>
<span class="sourceLineNo">476</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.476"></a>
<span class="sourceLineNo">477</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.477"></a>
<span class="sourceLineNo">478</span><a name="line.478"></a>
<span class="sourceLineNo">479</span>        n = parser.parse("×Pyrocrataegus willei L.L.Daniel", null);<a name="line.479"></a>
<span class="sourceLineNo">480</span>        assertEquals(NamePart.GENERIC, n.getNotho());<a name="line.480"></a>
<span class="sourceLineNo">481</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.481"></a>
<span class="sourceLineNo">482</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.482"></a>
<span class="sourceLineNo">483</span>        assertTrue(n.getInfraSpecificEpithet() == null);<a name="line.483"></a>
<span class="sourceLineNo">484</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.484"></a>
<span class="sourceLineNo">485</span><a name="line.485"></a>
<span class="sourceLineNo">486</span>        n = parser.parse(" × Pyrocrataegus willei L.L.Daniel", null);<a name="line.486"></a>
<span class="sourceLineNo">487</span>        assertEquals(NamePart.GENERIC, n.getNotho());<a name="line.487"></a>
<span class="sourceLineNo">488</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.488"></a>
<span class="sourceLineNo">489</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.489"></a>
<span class="sourceLineNo">490</span>        assertTrue(n.getInfraSpecificEpithet() == null);<a name="line.490"></a>
<span class="sourceLineNo">491</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.491"></a>
<span class="sourceLineNo">492</span><a name="line.492"></a>
<span class="sourceLineNo">493</span>        n = parser.parse(" X Pyrocrataegus willei L.L.Daniel", null);<a name="line.493"></a>
<span class="sourceLineNo">494</span>        assertEquals(NamePart.GENERIC, n.getNotho());<a name="line.494"></a>
<span class="sourceLineNo">495</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.495"></a>
<span class="sourceLineNo">496</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.496"></a>
<span class="sourceLineNo">497</span>        assertTrue(n.getInfraSpecificEpithet() == null);<a name="line.497"></a>
<span class="sourceLineNo">498</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.498"></a>
<span class="sourceLineNo">499</span><a name="line.499"></a>
<span class="sourceLineNo">500</span>        n = parser.parse("Pyrocrataegus ×willei L.L.Daniel", null);<a name="line.500"></a>
<span class="sourceLineNo">501</span>        assertEquals(NamePart.SPECIFIC, n.getNotho());<a name="line.501"></a>
<span class="sourceLineNo">502</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.502"></a>
<span class="sourceLineNo">503</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.503"></a>
<span class="sourceLineNo">504</span>        assertTrue(n.getInfraSpecificEpithet() == null);<a name="line.504"></a>
<span class="sourceLineNo">505</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.505"></a>
<span class="sourceLineNo">506</span><a name="line.506"></a>
<span class="sourceLineNo">507</span>        n = parser.parse("Pyrocrataegus × willei L.L.Daniel", null);<a name="line.507"></a>
<span class="sourceLineNo">508</span>        assertEquals(NamePart.SPECIFIC, n.getNotho());<a name="line.508"></a>
<span class="sourceLineNo">509</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.509"></a>
<span class="sourceLineNo">510</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.510"></a>
<span class="sourceLineNo">511</span>        assertTrue(n.getInfraSpecificEpithet() == null);<a name="line.511"></a>
<span class="sourceLineNo">512</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.512"></a>
<span class="sourceLineNo">513</span><a name="line.513"></a>
<span class="sourceLineNo">514</span>        n = parser.parse("Pyrocrataegus x willei L.L.Daniel", null);<a name="line.514"></a>
<span class="sourceLineNo">515</span>        assertEquals(NamePart.SPECIFIC, n.getNotho());<a name="line.515"></a>
<span class="sourceLineNo">516</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.516"></a>
<span class="sourceLineNo">517</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.517"></a>
<span class="sourceLineNo">518</span>        assertTrue(n.getInfraSpecificEpithet() == null);<a name="line.518"></a>
<span class="sourceLineNo">519</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.519"></a>
<span class="sourceLineNo">520</span><a name="line.520"></a>
<span class="sourceLineNo">521</span>        n = parser.parse("Pyrocrataegus X willei L.L.Daniel", null);<a name="line.521"></a>
<span class="sourceLineNo">522</span>        assertEquals(NamePart.SPECIFIC, n.getNotho());<a name="line.522"></a>
<span class="sourceLineNo">523</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.523"></a>
<span class="sourceLineNo">524</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.524"></a>
<span class="sourceLineNo">525</span>        assertTrue(n.getInfraSpecificEpithet() == null);<a name="line.525"></a>
<span class="sourceLineNo">526</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.526"></a>
<span class="sourceLineNo">527</span><a name="line.527"></a>
<span class="sourceLineNo">528</span>        n = parser.parse("Pyrocrataegus willei ×libidi L.L.Daniel", null);<a name="line.528"></a>
<span class="sourceLineNo">529</span>        assertEquals(NamePart.INFRASPECIFIC, n.getNotho());<a name="line.529"></a>
<span class="sourceLineNo">530</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.530"></a>
<span class="sourceLineNo">531</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.531"></a>
<span class="sourceLineNo">532</span>        assertEquals("libidi", n.getInfraSpecificEpithet());<a name="line.532"></a>
<span class="sourceLineNo">533</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.533"></a>
<span class="sourceLineNo">534</span><a name="line.534"></a>
<span class="sourceLineNo">535</span>        n = parser.parse("×Pyrocrataegus ×willei ×libidi L.L.Daniel", null);<a name="line.535"></a>
<span class="sourceLineNo">536</span>        assertEquals(NamePart.INFRASPECIFIC, n.getNotho());<a name="line.536"></a>
<span class="sourceLineNo">537</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.537"></a>
<span class="sourceLineNo">538</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.538"></a>
<span class="sourceLineNo">539</span>        assertEquals("libidi", n.getInfraSpecificEpithet());<a name="line.539"></a>
<span class="sourceLineNo">540</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.540"></a>
<span class="sourceLineNo">541</span><a name="line.541"></a>
<span class="sourceLineNo">542</span>        n = parser.parse("+ Pyrocrataegus willei ×libidi L.L.Daniel", null);<a name="line.542"></a>
<span class="sourceLineNo">543</span>        assertEquals(NamePart.INFRASPECIFIC, n.getNotho());<a name="line.543"></a>
<span class="sourceLineNo">544</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.544"></a>
<span class="sourceLineNo">545</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.545"></a>
<span class="sourceLineNo">546</span>        assertEquals("libidi", n.getInfraSpecificEpithet());<a name="line.546"></a>
<span class="sourceLineNo">547</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.547"></a>
<span class="sourceLineNo">548</span><a name="line.548"></a>
<span class="sourceLineNo">549</span>        n = parser.parse("Pyrocrataegus willei nothosubsp. libidi L.L.Daniel", null);<a name="line.549"></a>
<span class="sourceLineNo">550</span>        assertEquals(NamePart.INFRASPECIFIC, n.getNotho());<a name="line.550"></a>
<span class="sourceLineNo">551</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.551"></a>
<span class="sourceLineNo">552</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.552"></a>
<span class="sourceLineNo">553</span>        assertEquals("libidi", n.getInfraSpecificEpithet());<a name="line.553"></a>
<span class="sourceLineNo">554</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.554"></a>
<span class="sourceLineNo">555</span><a name="line.555"></a>
<span class="sourceLineNo">556</span>        n = parser.parse("+ Pyrocrataegus willei nothosubsp. libidi L.L.Daniel", null);<a name="line.556"></a>
<span class="sourceLineNo">557</span>        assertEquals(NamePart.INFRASPECIFIC, n.getNotho());<a name="line.557"></a>
<span class="sourceLineNo">558</span>        assertEquals("Pyrocrataegus", n.getGenusOrAbove());<a name="line.558"></a>
<span class="sourceLineNo">559</span>        assertEquals("willei", n.getSpecificEpithet());<a name="line.559"></a>
<span class="sourceLineNo">560</span>        assertEquals("libidi", n.getInfraSpecificEpithet());<a name="line.560"></a>
<span class="sourceLineNo">561</span>        assertEquals("L.L.Daniel", n.getAuthorship());<a name="line.561"></a>
<span class="sourceLineNo">562</span>    }<a name="line.562"></a>
<span class="sourceLineNo">563</span><a name="line.563"></a>
<span class="sourceLineNo">564</span>    @Test<a name="line.564"></a>
<span class="sourceLineNo">565</span>    public void testApostropheAuthors() throws Exception {<a name="line.565"></a>
<span class="sourceLineNo">566</span>        ParsedName pn = parser.parse("Cirsium creticum d'Urv.", null);<a name="line.566"></a>
<span class="sourceLineNo">567</span>        assertEquals("Cirsium", pn.getGenusOrAbove());<a name="line.567"></a>
<span class="sourceLineNo">568</span>        assertEquals("creticum", pn.getSpecificEpithet());<a name="line.568"></a>
<span class="sourceLineNo">569</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.569"></a>
<span class="sourceLineNo">570</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.570"></a>
<span class="sourceLineNo">571</span>        assertEquals("d'Urv.", pn.getAuthorship());<a name="line.571"></a>
<span class="sourceLineNo">572</span><a name="line.572"></a>
<span class="sourceLineNo">573</span>        pn = parser.parse("Cirsium creticum d'Urv. subsp. creticum", null);<a name="line.573"></a>
<span class="sourceLineNo">574</span>        assertEquals("Cirsium", pn.getGenusOrAbove());<a name="line.574"></a>
<span class="sourceLineNo">575</span>        assertEquals("creticum", pn.getSpecificEpithet());<a name="line.575"></a>
<span class="sourceLineNo">576</span>        assertEquals("creticum", pn.getInfraSpecificEpithet());<a name="line.576"></a>
<span class="sourceLineNo">577</span>        assertEquals(Rank.SUBSPECIES, pn.getRank());<a name="line.577"></a>
<span class="sourceLineNo">578</span>        assertNull(pn.getAuthorship());<a name="line.578"></a>
<span class="sourceLineNo">579</span>    }<a name="line.579"></a>
<span class="sourceLineNo">580</span><a name="line.580"></a>
<span class="sourceLineNo">581</span>    @Test<a name="line.581"></a>
<span class="sourceLineNo">582</span>    public void testApostropheEpithets() throws Exception {<a name="line.582"></a>
<span class="sourceLineNo">583</span>        ParsedName pn = parser.parse("Junellia o'donelli Moldenke, 1946", null);<a name="line.583"></a>
<span class="sourceLineNo">584</span>        assertEquals("Junellia", pn.getGenusOrAbove());<a name="line.584"></a>
<span class="sourceLineNo">585</span>        assertEquals("o'donelli", pn.getSpecificEpithet());<a name="line.585"></a>
<span class="sourceLineNo">586</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.586"></a>
<span class="sourceLineNo">587</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.587"></a>
<span class="sourceLineNo">588</span>        assertEquals("Moldenke", pn.getAuthorship());<a name="line.588"></a>
<span class="sourceLineNo">589</span>        assertEquals("1946", pn.getYear());<a name="line.589"></a>
<span class="sourceLineNo">590</span><a name="line.590"></a>
<span class="sourceLineNo">591</span>        pn = parser.parse("Trophon d'orbignyi Carcelles, 1946", null);<a name="line.591"></a>
<span class="sourceLineNo">592</span>        assertEquals("Trophon", pn.getGenusOrAbove());<a name="line.592"></a>
<span class="sourceLineNo">593</span>        assertEquals("d'orbignyi", pn.getSpecificEpithet());<a name="line.593"></a>
<span class="sourceLineNo">594</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.594"></a>
<span class="sourceLineNo">595</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.595"></a>
<span class="sourceLineNo">596</span>        assertEquals("Carcelles", pn.getAuthorship());<a name="line.596"></a>
<span class="sourceLineNo">597</span>        assertEquals("1946", pn.getYear());<a name="line.597"></a>
<span class="sourceLineNo">598</span><a name="line.598"></a>
<span class="sourceLineNo">599</span>        pn = parser.parse("Arca m'coyi Tenison-Woods, 1878", null);<a name="line.599"></a>
<span class="sourceLineNo">600</span>        assertEquals("Arca", pn.getGenusOrAbove());<a name="line.600"></a>
<span class="sourceLineNo">601</span>        assertEquals("m'coyi", pn.getSpecificEpithet());<a name="line.601"></a>
<span class="sourceLineNo">602</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.602"></a>
<span class="sourceLineNo">603</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.603"></a>
<span class="sourceLineNo">604</span>        assertEquals("Tenison-Woods", pn.getAuthorship());<a name="line.604"></a>
<span class="sourceLineNo">605</span>        assertEquals("1878", pn.getYear());<a name="line.605"></a>
<span class="sourceLineNo">606</span><a name="line.606"></a>
<span class="sourceLineNo">607</span>        pn = parser.parse("Nucula m'andrewii Hanley, 1860", null);<a name="line.607"></a>
<span class="sourceLineNo">608</span>        assertEquals("Nucula", pn.getGenusOrAbove());<a name="line.608"></a>
<span class="sourceLineNo">609</span>        assertEquals("m'andrewii", pn.getSpecificEpithet());<a name="line.609"></a>
<span class="sourceLineNo">610</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.610"></a>
<span class="sourceLineNo">611</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.611"></a>
<span class="sourceLineNo">612</span>        assertEquals("Hanley", pn.getAuthorship());<a name="line.612"></a>
<span class="sourceLineNo">613</span>        assertEquals("1860", pn.getYear());<a name="line.613"></a>
<span class="sourceLineNo">614</span><a name="line.614"></a>
<span class="sourceLineNo">615</span>        pn = parser.parse("Eristalis l'herminierii Macquart", null);<a name="line.615"></a>
<span class="sourceLineNo">616</span>        assertEquals("Eristalis", pn.getGenusOrAbove());<a name="line.616"></a>
<span class="sourceLineNo">617</span>        assertEquals("l'herminierii", pn.getSpecificEpithet());<a name="line.617"></a>
<span class="sourceLineNo">618</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.618"></a>
<span class="sourceLineNo">619</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.619"></a>
<span class="sourceLineNo">620</span>        assertEquals("Macquart", pn.getAuthorship());<a name="line.620"></a>
<span class="sourceLineNo">621</span><a name="line.621"></a>
<span class="sourceLineNo">622</span>        pn = parser.parse("Odynerus o'neili Cameron", null);<a name="line.622"></a>
<span class="sourceLineNo">623</span>        assertEquals("Odynerus", pn.getGenusOrAbove());<a name="line.623"></a>
<span class="sourceLineNo">624</span>        assertEquals("o'neili", pn.getSpecificEpithet());<a name="line.624"></a>
<span class="sourceLineNo">625</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.625"></a>
<span class="sourceLineNo">626</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.626"></a>
<span class="sourceLineNo">627</span>        assertEquals("Cameron", pn.getAuthorship());<a name="line.627"></a>
<span class="sourceLineNo">628</span><a name="line.628"></a>
<span class="sourceLineNo">629</span>        pn = parser.parse("Serjania meridionalis Cambess. var. o'donelli F.A. Barkley", null);<a name="line.629"></a>
<span class="sourceLineNo">630</span>        assertEquals("Serjania", pn.getGenusOrAbove());<a name="line.630"></a>
<span class="sourceLineNo">631</span>        assertEquals("meridionalis", pn.getSpecificEpithet());<a name="line.631"></a>
<span class="sourceLineNo">632</span>        assertEquals("o'donelli", pn.getInfraSpecificEpithet());<a name="line.632"></a>
<span class="sourceLineNo">633</span>        assertEquals(Rank.VARIETY, pn.getRank());<a name="line.633"></a>
<span class="sourceLineNo">634</span>        assertEquals("F.A. Barkley", pn.getAuthorship());<a name="line.634"></a>
<span class="sourceLineNo">635</span>    }<a name="line.635"></a>
<span class="sourceLineNo">636</span><a name="line.636"></a>
<span class="sourceLineNo">637</span>    @Test<a name="line.637"></a>
<span class="sourceLineNo">638</span>    public void testVirusNames() throws Exception {<a name="line.638"></a>
<span class="sourceLineNo">639</span>        ParsedName pn = parser.parse("Crassatellites janus Hedley, 1906", null);<a name="line.639"></a>
<span class="sourceLineNo">640</span>        assertEquals("Crassatellites", pn.getGenusOrAbove());<a name="line.640"></a>
<span class="sourceLineNo">641</span>        assertEquals("janus", pn.getSpecificEpithet());<a name="line.641"></a>
<span class="sourceLineNo">642</span>        assertEquals("Hedley", pn.getAuthorship());<a name="line.642"></a>
<span class="sourceLineNo">643</span>        assertEquals("1906", pn.getYear());<a name="line.643"></a>
<span class="sourceLineNo">644</span><a name="line.644"></a>
<span class="sourceLineNo">645</span>        pn = parser.parse("Ypsolophus satellitella", null);<a name="line.645"></a>
<span class="sourceLineNo">646</span>        assertEquals("Ypsolophus", pn.getGenusOrAbove());<a name="line.646"></a>
<span class="sourceLineNo">647</span>        assertEquals("satellitella", pn.getSpecificEpithet());<a name="line.647"></a>
<span class="sourceLineNo">648</span><a name="line.648"></a>
<span class="sourceLineNo">649</span>        pn = parser.parse("Nephodia satellites", null);<a name="line.649"></a>
<span class="sourceLineNo">650</span>        assertEquals("Nephodia", pn.getGenusOrAbove());<a name="line.650"></a>
<span class="sourceLineNo">651</span>        assertEquals("satellites", pn.getSpecificEpithet());<a name="line.651"></a>
<span class="sourceLineNo">652</span><a name="line.652"></a>
<span class="sourceLineNo">653</span>        Reader reader = FileUtils.getInputStreamReader(streamUtils.classpathStream("viruses.txt"));<a name="line.653"></a>
<span class="sourceLineNo">654</span>        LineIterator iter = new LineIterator(reader);<a name="line.654"></a>
<span class="sourceLineNo">655</span>        while (iter.hasNext()) {<a name="line.655"></a>
<span class="sourceLineNo">656</span>            String line = iter.nextLine();<a name="line.656"></a>
<span class="sourceLineNo">657</span>            if (line == null || line.startsWith("#") || line.trim().isEmpty()) {<a name="line.657"></a>
<span class="sourceLineNo">658</span>                continue;<a name="line.658"></a>
<span class="sourceLineNo">659</span>            }<a name="line.659"></a>
<span class="sourceLineNo">660</span>            assertUnparsableType(NameType.VIRUS, line);<a name="line.660"></a>
<span class="sourceLineNo">661</span>        }<a name="line.661"></a>
<span class="sourceLineNo">662</span>    }<a name="line.662"></a>
<span class="sourceLineNo">663</span><a name="line.663"></a>
<span class="sourceLineNo">664</span>    /**<a name="line.664"></a>
<span class="sourceLineNo">665</span>     * http://dev.gbif.org/issues/browse/POR-2459<a name="line.665"></a>
<span class="sourceLineNo">666</span>     */<a name="line.666"></a>
<span class="sourceLineNo">667</span>    @Test<a name="line.667"></a>
<span class="sourceLineNo">668</span>    public void testEbiUncultured() throws Exception {<a name="line.668"></a>
<span class="sourceLineNo">669</span>        assertUnparsableType(NameType.PLACEHOLDER, "uncultured Verrucomicrobiales bacterium");<a name="line.669"></a>
<span class="sourceLineNo">670</span>        assertUnparsableType(NameType.PLACEHOLDER, "uncultured Verrucomicrobium sp.");<a name="line.670"></a>
<span class="sourceLineNo">671</span>        assertUnparsableType(NameType.PLACEHOLDER, "uncultured Verrucomicrobia bacterium");<a name="line.671"></a>
<span class="sourceLineNo">672</span>        assertUnparsableType(NameType.PLACEHOLDER, "uncultured Vibrio sp.");<a name="line.672"></a>
<span class="sourceLineNo">673</span>        assertUnparsableType(NameType.PLACEHOLDER, "uncultured Wilcoxina");<a name="line.673"></a>
<span class="sourceLineNo">674</span>        assertUnparsableType(NameType.PLACEHOLDER, "uncultured zygomycete");<a name="line.674"></a>
<span class="sourceLineNo">675</span>        assertUnparsableType(NameType.PLACEHOLDER, "uncultured Yonghaparkia sp");<a name="line.675"></a>
<span class="sourceLineNo">676</span>        assertUnparsableType(NameType.PLACEHOLDER, "uncultured virus");<a name="line.676"></a>
<span class="sourceLineNo">677</span>    }<a name="line.677"></a>
<span class="sourceLineNo">678</span><a name="line.678"></a>
<span class="sourceLineNo">679</span>    @Test<a name="line.679"></a>
<span class="sourceLineNo">680</span>    public void testRNANames() throws Exception {<a name="line.680"></a>
<span class="sourceLineNo">681</span>        ParsedName pn = parser.parse("Calathus (Lindrothius) KURNAKOV 1961", null);<a name="line.681"></a>
<span class="sourceLineNo">682</span>        assertEquals("Calathus", pn.getGenusOrAbove());<a name="line.682"></a>
<span class="sourceLineNo">683</span>        assertEquals("Lindrothius", pn.getInfraGeneric());<a name="line.683"></a>
<span class="sourceLineNo">684</span>        assertNull(pn.getSpecificEpithet());<a name="line.684"></a>
<span class="sourceLineNo">685</span>        assertEquals("Kurnakov", pn.getAuthorship());<a name="line.685"></a>
<span class="sourceLineNo">686</span>        assertEquals("1961", pn.getYear());<a name="line.686"></a>
<span class="sourceLineNo">687</span><a name="line.687"></a>
<span class="sourceLineNo">688</span>        assertUnparsableType(NameType.VIRUS, "Cactus virus 2");<a name="line.688"></a>
<span class="sourceLineNo">689</span>        assertUnparsableType(NameType.VIRUS, "Ustilaginoidea virens RNA virus");<a name="line.689"></a>
<span class="sourceLineNo">690</span>        assertUnparsableType(NameType.VIRUS, "Rhizoctonia solani dsRNA virus 2");<a name="line.690"></a>
<span class="sourceLineNo">691</span><a name="line.691"></a>
<span class="sourceLineNo">692</span>        pn = parser.parse("Candida albicans RNA_CTR0-3", null);<a name="line.692"></a>
<span class="sourceLineNo">693</span>        assertEquals("Candida", pn.getGenusOrAbove());<a name="line.693"></a>
<span class="sourceLineNo">694</span>        assertEquals("albicans", pn.getSpecificEpithet());<a name="line.694"></a>
<span class="sourceLineNo">695</span>        assertEquals(NameType.INFORMAL, pn.getType());<a name="line.695"></a>
<span class="sourceLineNo">696</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.696"></a>
<span class="sourceLineNo">697</span>        assertNull(pn.getAuthorship());<a name="line.697"></a>
<span class="sourceLineNo">698</span><a name="line.698"></a>
<span class="sourceLineNo">699</span>        pn = parser.parse("Alpha proteobacterium RNA12", null);<a name="line.699"></a>
<span class="sourceLineNo">700</span>        assertEquals("Alpha", pn.getGenusOrAbove());<a name="line.700"></a>
<span class="sourceLineNo">701</span>        assertEquals("proteobacterium", pn.getSpecificEpithet());<a name="line.701"></a>
<span class="sourceLineNo">702</span>        assertEquals(NameType.INFORMAL, pn.getType());<a name="line.702"></a>
<span class="sourceLineNo">703</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.703"></a>
<span class="sourceLineNo">704</span>        assertNull(pn.getAuthorship());<a name="line.704"></a>
<span class="sourceLineNo">705</span><a name="line.705"></a>
<span class="sourceLineNo">706</span>        pn = parser.parse("Armillaria ostoyae RNA1", null);<a name="line.706"></a>
<span class="sourceLineNo">707</span>        assertEquals("Armillaria", pn.getGenusOrAbove());<a name="line.707"></a>
<span class="sourceLineNo">708</span>        assertEquals("ostoyae", pn.getSpecificEpithet());<a name="line.708"></a>
<span class="sourceLineNo">709</span>        assertEquals(NameType.INFORMAL, pn.getType());<a name="line.709"></a>
<span class="sourceLineNo">710</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.710"></a>
<span class="sourceLineNo">711</span>        assertNull(pn.getAuthorship());<a name="line.711"></a>
<span class="sourceLineNo">712</span><a name="line.712"></a>
<span class="sourceLineNo">713</span>        assertUnparsableType(NameType.DOUBTFUL, "siRNA");<a name="line.713"></a>
<span class="sourceLineNo">714</span>    }<a name="line.714"></a>
<span class="sourceLineNo">715</span><a name="line.715"></a>
<span class="sourceLineNo">716</span>    @Test<a name="line.716"></a>
<span class="sourceLineNo">717</span>    public void testIndetParsering() throws Exception {<a name="line.717"></a>
<span class="sourceLineNo">718</span>        ParsedName pn = parser.parse("Polygonum spec.", null);<a name="line.718"></a>
<span class="sourceLineNo">719</span>        assertEquals("Polygonum", pn.getGenusOrAbove());<a name="line.719"></a>
<span class="sourceLineNo">720</span>        assertNull(pn.getSpecificEpithet());<a name="line.720"></a>
<span class="sourceLineNo">721</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.721"></a>
<span class="sourceLineNo">722</span>        assertEquals(NameType.INFORMAL, pn.getType());<a name="line.722"></a>
<span class="sourceLineNo">723</span><a name="line.723"></a>
<span class="sourceLineNo">724</span>        pn = parser.parse("Polygonum vulgaris ssp.", null);<a name="line.724"></a>
<span class="sourceLineNo">725</span>        assertEquals("Polygonum", pn.getGenusOrAbove());<a name="line.725"></a>
<span class="sourceLineNo">726</span>        assertEquals("vulgaris", pn.getSpecificEpithet());<a name="line.726"></a>
<span class="sourceLineNo">727</span>        assertEquals(Rank.SUBSPECIES, pn.getRank());<a name="line.727"></a>
<span class="sourceLineNo">728</span>        assertEquals(NameType.INFORMAL, pn.getType());<a name="line.728"></a>
<span class="sourceLineNo">729</span><a name="line.729"></a>
<span class="sourceLineNo">730</span>        pn = parser.parse("Mesocricetus sp.", null);<a name="line.730"></a>
<span class="sourceLineNo">731</span>        assertEquals("Mesocricetus", pn.getGenusOrAbove());<a name="line.731"></a>
<span class="sourceLineNo">732</span>        assertNull(pn.getSpecificEpithet());<a name="line.732"></a>
<span class="sourceLineNo">733</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.733"></a>
<span class="sourceLineNo">734</span>        assertEquals(NameType.INFORMAL, pn.getType());<a name="line.734"></a>
<span class="sourceLineNo">735</span><a name="line.735"></a>
<span class="sourceLineNo">736</span>        // but dont treat these bacterial names as indets<a name="line.736"></a>
<span class="sourceLineNo">737</span>        pn = parser.parse("Bartonella sp. RN, 10623LA", null);<a name="line.737"></a>
<span class="sourceLineNo">738</span>        assertEquals("Bartonella", pn.getGenusOrAbove());<a name="line.738"></a>
<span class="sourceLineNo">739</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.739"></a>
<span class="sourceLineNo">740</span>        assertTrue(NameType.INFORMAL != pn.getType());<a name="line.740"></a>
<span class="sourceLineNo">741</span><a name="line.741"></a>
<span class="sourceLineNo">742</span>        // and dont treat these authorships as forms<a name="line.742"></a>
<span class="sourceLineNo">743</span>        pn = parser.parse("Dioscoreales Hooker f.", null);<a name="line.743"></a>
<span class="sourceLineNo">744</span>        assertEquals("Dioscoreales", pn.getGenusOrAbove());<a name="line.744"></a>
<span class="sourceLineNo">745</span>        assertEquals("Hooker f.", pn.getAuthorship());<a name="line.745"></a>
<span class="sourceLineNo">746</span>        assertEquals(Rank.ORDER, pn.getRank());<a name="line.746"></a>
<span class="sourceLineNo">747</span>        assertTrue(NameType.SCIENTIFIC == pn.getType());<a name="line.747"></a>
<span class="sourceLineNo">748</span><a name="line.748"></a>
<span class="sourceLineNo">749</span>        pn = parser.parse("Lepidoptera sp. JGP0404", null);<a name="line.749"></a>
<span class="sourceLineNo">750</span>        assertEquals("Lepidoptera", pn.getGenusOrAbove());<a name="line.750"></a>
<span class="sourceLineNo">751</span>        assertNull(pn.getSpecificEpithet());<a name="line.751"></a>
<span class="sourceLineNo">752</span>        assertNull(pn.getAuthorship());<a name="line.752"></a>
<span class="sourceLineNo">753</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.753"></a>
<span class="sourceLineNo">754</span>        assertTrue(NameType.INFORMAL == pn.getType());<a name="line.754"></a>
<span class="sourceLineNo">755</span><a name="line.755"></a>
<span class="sourceLineNo">756</span>        pn = parser.parse("Melastoma vacillans Blume var.", null);<a name="line.756"></a>
<span class="sourceLineNo">757</span>    }<a name="line.757"></a>
<span class="sourceLineNo">758</span><a name="line.758"></a>
<span class="sourceLineNo">759</span>    @Test<a name="line.759"></a>
<span class="sourceLineNo">760</span>    public void testTimeoutNameFile() throws Exception {<a name="line.760"></a>
<span class="sourceLineNo">761</span>        Reader reader = FileUtils.getInputStreamReader(streamUtils.classpathStream("timeout-names.txt"));<a name="line.761"></a>
<span class="sourceLineNo">762</span>        LineIterator iter = new LineIterator(reader);<a name="line.762"></a>
<span class="sourceLineNo">763</span>        while (iter.hasNext()) {<a name="line.763"></a>
<span class="sourceLineNo">764</span>            String line = iter.nextLine();<a name="line.764"></a>
<span class="sourceLineNo">765</span>            if (line == null || line.startsWith("#") || line.trim().isEmpty()) {<a name="line.765"></a>
<span class="sourceLineNo">766</span>                continue;<a name="line.766"></a>
<span class="sourceLineNo">767</span>            }<a name="line.767"></a>
<span class="sourceLineNo">768</span>            ParsedName n = parser.parse(line, null);<a name="line.768"></a>
<span class="sourceLineNo">769</span>        }<a name="line.769"></a>
<span class="sourceLineNo">770</span>    }<a name="line.770"></a>
<span class="sourceLineNo">771</span><a name="line.771"></a>
<span class="sourceLineNo">772</span>    @Test<a name="line.772"></a>
<span class="sourceLineNo">773</span>    public void testNameFile() throws Exception {<a name="line.773"></a>
<span class="sourceLineNo">774</span>        final int CURRENTLY_FAIL = 24;<a name="line.774"></a>
<span class="sourceLineNo">775</span>        final int CURRENTLY_FAIL_EXCL_AUTHORS = 19;<a name="line.775"></a>
<span class="sourceLineNo">776</span><a name="line.776"></a>
<span class="sourceLineNo">777</span>        LOG.info("\n\nSTARTING FULL PARSER\n");<a name="line.777"></a>
<span class="sourceLineNo">778</span>        Reader reader = FileUtils.getInputStreamReader(streamUtils.classpathStream("scientific_names.txt"));<a name="line.778"></a>
<span class="sourceLineNo">779</span>        LineIterator iter = new LineIterator(reader);<a name="line.779"></a>
<span class="sourceLineNo">780</span><a name="line.780"></a>
<span class="sourceLineNo">781</span>        int parseFails = 0;<a name="line.781"></a>
<span class="sourceLineNo">782</span>        int parseNoAuthors = 0;<a name="line.782"></a>
<span class="sourceLineNo">783</span>        int parseErrors = 0;<a name="line.783"></a>
<span class="sourceLineNo">784</span>        int cnt = 0;<a name="line.784"></a>
<span class="sourceLineNo">785</span>        int lineNum = 0;<a name="line.785"></a>
<span class="sourceLineNo">786</span>        long start = System.currentTimeMillis();<a name="line.786"></a>
<span class="sourceLineNo">787</span><a name="line.787"></a>
<span class="sourceLineNo">788</span>        Splitter tabSplit = Splitter.on('\t');<a name="line.788"></a>
<span class="sourceLineNo">789</span>        while (iter.hasNext()) {<a name="line.789"></a>
<span class="sourceLineNo">790</span>            lineNum++;<a name="line.790"></a>
<span class="sourceLineNo">791</span>            String line = iter.nextLine();<a name="line.791"></a>
<span class="sourceLineNo">792</span>            if (lineNum == 1 || line == null || line.startsWith("#") || line.trim().isEmpty()) {<a name="line.792"></a>
<span class="sourceLineNo">793</span>                continue;<a name="line.793"></a>
<span class="sourceLineNo">794</span>            }<a name="line.794"></a>
<span class="sourceLineNo">795</span>            cnt++;<a name="line.795"></a>
<span class="sourceLineNo">796</span><a name="line.796"></a>
<span class="sourceLineNo">797</span>            List&lt;String&gt; cols = tabSplit.splitToList(line);<a name="line.797"></a>
<span class="sourceLineNo">798</span>            String name = cols.get(0);<a name="line.798"></a>
<span class="sourceLineNo">799</span>            if (cols.size() &lt; 14) {<a name="line.799"></a>
<span class="sourceLineNo">800</span>                LOG.warn("Too short line in names test file:");<a name="line.800"></a>
<span class="sourceLineNo">801</span>                LOG.warn(line);<a name="line.801"></a>
<span class="sourceLineNo">802</span>            }<a name="line.802"></a>
<span class="sourceLineNo">803</span>            ParsedName expected = buildParsedNameFromTabRow(cols.toArray(new String[cols.size()]));<a name="line.803"></a>
<span class="sourceLineNo">804</span>            ParsedName n;<a name="line.804"></a>
<span class="sourceLineNo">805</span>            try {<a name="line.805"></a>
<span class="sourceLineNo">806</span>                n = parser.parse(name, null);<a name="line.806"></a>
<span class="sourceLineNo">807</span>                if (!n.isAuthorsParsed()) {<a name="line.807"></a>
<span class="sourceLineNo">808</span>                    parseNoAuthors++;<a name="line.808"></a>
<span class="sourceLineNo">809</span>                }<a name="line.809"></a>
<span class="sourceLineNo">810</span>                // copy scientific name, we dont wanna compare it, it might be slightly different<a name="line.810"></a>
<span class="sourceLineNo">811</span>                expected.setScientificName(n.getScientificName());<a name="line.811"></a>
<span class="sourceLineNo">812</span>                // remove SCIENTIFIC nametype as we only like to compare other values<a name="line.812"></a>
<span class="sourceLineNo">813</span>                if (NameType.SCIENTIFIC==n.getType()) {<a name="line.813"></a>
<span class="sourceLineNo">814</span>                    n.setType(null);<a name="line.814"></a>
<span class="sourceLineNo">815</span>                }<a name="line.815"></a>
<span class="sourceLineNo">816</span>                if (!n.equals(expected)) {<a name="line.816"></a>
<span class="sourceLineNo">817</span>                    parseErrors++;<a name="line.817"></a>
<span class="sourceLineNo">818</span>                    LOG.warn("WRONG\t " + name + "\n  EXPECTED: " + expected + "\n  PARSED  : " + n);<a name="line.818"></a>
<span class="sourceLineNo">819</span>                }<a name="line.819"></a>
<span class="sourceLineNo">820</span>            } catch (Exception e) {<a name="line.820"></a>
<span class="sourceLineNo">821</span>                parseFails++;<a name="line.821"></a>
<span class="sourceLineNo">822</span>                LOG.warn("FAIL\t " + name + "\nEXPECTED: " + expected);<a name="line.822"></a>
<span class="sourceLineNo">823</span>            }<a name="line.823"></a>
<span class="sourceLineNo">824</span>        }<a name="line.824"></a>
<span class="sourceLineNo">825</span>        long end = System.currentTimeMillis();<a name="line.825"></a>
<span class="sourceLineNo">826</span>        int successfulParses = cnt - parseFails - parseErrors;<a name="line.826"></a>
<span class="sourceLineNo">827</span>        LOG.info("\n\nNames tested: " + cnt);<a name="line.827"></a>
<span class="sourceLineNo">828</span>        LOG.info("Names success: " + successfulParses);<a name="line.828"></a>
<span class="sourceLineNo">829</span>        LOG.info("Names parse fail: " + parseFails);<a name="line.829"></a>
<span class="sourceLineNo">830</span>        LOG.info("Names parse errors: " + parseErrors);<a name="line.830"></a>
<span class="sourceLineNo">831</span>        LOG.info("Names ignoring authors: " + parseNoAuthors);<a name="line.831"></a>
<span class="sourceLineNo">832</span>        LOG.info("Total time: " + (end - start));<a name="line.832"></a>
<span class="sourceLineNo">833</span>        LOG.info("Average per name: " + (((double) end - start) / cnt));<a name="line.833"></a>
<span class="sourceLineNo">834</span><a name="line.834"></a>
<span class="sourceLineNo">835</span>        if ((parseFails + parseErrors) &gt; CURRENTLY_FAIL) {<a name="line.835"></a>
<span class="sourceLineNo">836</span>            TestCase.fail(<a name="line.836"></a>
<span class="sourceLineNo">837</span>                    "We are getting worse, not better. Currently failing: " + (parseFails + parseErrors) + ". We used to fail :"<a name="line.837"></a>
<span class="sourceLineNo">838</span>                            + CURRENTLY_FAIL);<a name="line.838"></a>
<span class="sourceLineNo">839</span>        } else if (parseFails + parseErrors &lt; CURRENTLY_FAIL) {<a name="line.839"></a>
<span class="sourceLineNo">840</span>            LOG.info("We are getting better! Used to fail : " + CURRENTLY_FAIL);<a name="line.840"></a>
<span class="sourceLineNo">841</span>        }<a name="line.841"></a>
<span class="sourceLineNo">842</span>        if ((parseFails + parseNoAuthors) &gt; CURRENTLY_FAIL_EXCL_AUTHORS) {<a name="line.842"></a>
<span class="sourceLineNo">843</span>            TestCase.fail(<a name="line.843"></a>
<span class="sourceLineNo">844</span>                    "We are getting worse, not better. Currently failing ignroing authors: " + (parseFails + parseNoAuthors)<a name="line.844"></a>
<span class="sourceLineNo">845</span>                            + ". Was passing:" + CURRENTLY_FAIL_EXCL_AUTHORS);<a name="line.845"></a>
<span class="sourceLineNo">846</span>        } else if (parseFails + parseNoAuthors &lt; CURRENTLY_FAIL_EXCL_AUTHORS) {<a name="line.846"></a>
<span class="sourceLineNo">847</span>            LOG.info("We are getting better! Used to fail without authors: " + CURRENTLY_FAIL_EXCL_AUTHORS);<a name="line.847"></a>
<span class="sourceLineNo">848</span>        }<a name="line.848"></a>
<span class="sourceLineNo">849</span><a name="line.849"></a>
<span class="sourceLineNo">850</span>    }<a name="line.850"></a>
<span class="sourceLineNo">851</span><a name="line.851"></a>
<span class="sourceLineNo">852</span>    @Test<a name="line.852"></a>
<span class="sourceLineNo">853</span>    public void testNameParserCanonical() throws Exception {<a name="line.853"></a>
<span class="sourceLineNo">854</span><a name="line.854"></a>
<span class="sourceLineNo">855</span>        assertEquals("Abelia grandifolia", parser.parseToCanonical("Abelia grandifolia Villarreal, 2000 Villarreal, 2000", null));<a name="line.855"></a>
<span class="sourceLineNo">856</span>        assertEquals("Abelia macrotera",<a name="line.856"></a>
<span class="sourceLineNo">857</span>                parser.parseToCanonical("Abelia macrotera (Graebn. &amp; Buchw.) Rehder (Graebn. et Buchw.) Rehder", null));<a name="line.857"></a>
<span class="sourceLineNo">858</span>        assertEquals("Abelia mexicana", parser.parseToCanonical("Abelia mexicana Villarreal, 2000 Villarreal, 2000", null));<a name="line.858"></a>
<span class="sourceLineNo">859</span>        assertEquals("Abelia serrata", parser.parseToCanonical("Abelia serrata Abelia serrata Siebold &amp; Zucc.", null));<a name="line.859"></a>
<span class="sourceLineNo">860</span>        assertEquals("Abelia spathulata colorata", parser.parseToCanonical(<a name="line.860"></a>
<span class="sourceLineNo">861</span>                "Abelia spathulata colorata (Hara &amp; Kurosawa) Hara &amp; Kurosawa (Hara et Kurosawa) Hara et Kurosawa", null));<a name="line.861"></a>
<span class="sourceLineNo">862</span>        assertEquals("Abelia tetrasepala",<a name="line.862"></a>
<span class="sourceLineNo">863</span>                parser.parseToCanonical("Abelia tetrasepala (Koidz.) H.Hara &amp; S.Kuros. (Koidz.) H.Hara et S.Kuros.", null));<a name="line.863"></a>
<span class="sourceLineNo">864</span>        assertEquals("Abelia tetrasepala",<a name="line.864"></a>
<span class="sourceLineNo">865</span>                parser.parseToCanonical("Abelia tetrasepala (Koidz.) Hara &amp; Kurosawa (Koidz.) Hara et Kurosawa", null));<a name="line.865"></a>
<span class="sourceLineNo">866</span>        assertEquals("Abelmoschus esculentus",<a name="line.866"></a>
<span class="sourceLineNo">867</span>                parser.parseToCanonical("Abelmoschus esculentus Abelmoschus esculentus (L.) Moench", null));<a name="line.867"></a>
<span class="sourceLineNo">868</span>        assertEquals("Abelmoschus moschatus",<a name="line.868"></a>
<span class="sourceLineNo">869</span>                parser.parseToCanonical("Abelmoschus moschatus Abelmoschus moschatus Medik.", null));<a name="line.869"></a>
<span class="sourceLineNo">870</span>        assertEquals("Abelmoschus moschatus tuberosus",<a name="line.870"></a>
<span class="sourceLineNo">871</span>                parser.parseToCanonical("Abelmoschus moschatus subsp. tuberosus (Span.) Borss.Waalk.", null));<a name="line.871"></a>
<span class="sourceLineNo">872</span>        assertEquals("Abia fasciata", parser.parseToCanonical("Abia fasciata (Linnaeus, 1758) (Linnaeus, 1758)", null));<a name="line.872"></a>
<span class="sourceLineNo">873</span>        assertEquals("Abia fasciata", parser.parseToCanonical("Abia fasciata Linnaeus, 1758 Linnaeus, 1758", null));<a name="line.873"></a>
<span class="sourceLineNo">874</span>        assertEquals("Abida secale", parser.parseToCanonical("Abida secale (Draparnaud, 1801) (Draparnaud) , 1801", null));<a name="line.874"></a>
<span class="sourceLineNo">875</span>        assertEquals("Abida secale brauniopsis", parser.parseToCanonical("Abida secale brauniopsis Bofill i Poch, Artur", null));<a name="line.875"></a>
<span class="sourceLineNo">876</span>        assertEquals("Abida secale inis", parser.parseToCanonical("Abida secale inis Bofill i Poch, Artur", null));<a name="line.876"></a>
<span class="sourceLineNo">877</span>        assertEquals("Abida secale meridionalis",<a name="line.877"></a>
<span class="sourceLineNo">878</span>                parser.parseToCanonical("Abida secale meridionalis Martínez Ortí, AlbertoGómez, BenjamínFaci, Guill", null));<a name="line.878"></a>
<span class="sourceLineNo">879</span>        assertEquals("Abies alba", parser.parseToCanonical("Abies alba Abies alba Mill.", null));<a name="line.879"></a>
<span class="sourceLineNo">880</span>        assertEquals("Abies alba", parser.parseToCanonical("Abies alba Abies alba Miller", null));<a name="line.880"></a>
<span class="sourceLineNo">881</span>        assertEquals("Abies alba", parser.parseToCanonical("Abies alba Mill. (species) : Mill.", null));<a name="line.881"></a>
<span class="sourceLineNo">882</span>        assertEquals("Abies amabilis",<a name="line.882"></a>
<span class="sourceLineNo">883</span>                parser.parseToCanonical("Abies amabilis Abies amabilis (Dougl. ex Loud.) Dougl. ex Forbes", null));<a name="line.883"></a>
<span class="sourceLineNo">884</span>        assertEquals("Abies amabilis", parser.parseToCanonical("Abies amabilis Abies amabilis Douglas ex Forbes", null));<a name="line.884"></a>
<span class="sourceLineNo">885</span>        assertEquals("Abies arizonica", parser.parseToCanonical("Abies arizonica Abies arizonica Merriam", null));<a name="line.885"></a>
<span class="sourceLineNo">886</span>        assertEquals("Abies balsamea", parser.parseToCanonical("Abies balsamea (L.) Mill. (species) : (L.) Mill.", null));<a name="line.886"></a>
<span class="sourceLineNo">887</span>        assertEquals("Abies balsamea", parser.parseToCanonical("Abies balsamea (L.) Mill. / Ledeb.", null));<a name="line.887"></a>
<span class="sourceLineNo">888</span>        assertEquals("Abies balsamea", parser.parseToCanonical("Abies balsamea Abies balsamea (L.) Mill.", null));<a name="line.888"></a>
<span class="sourceLineNo">889</span>        assertEquals("Abelia grandiflora", parser.parseToCanonical("Abelia grandiflora Rehd (species) : Rehd", null));<a name="line.889"></a>
<span class="sourceLineNo">890</span>    }<a name="line.890"></a>
<span class="sourceLineNo">891</span><a name="line.891"></a>
<span class="sourceLineNo">892</span>    /**<a name="line.892"></a>
<span class="sourceLineNo">893</span>     * http://dev.gbif.org/issues/browse/POR-101<a name="line.893"></a>
<span class="sourceLineNo">894</span>     */<a name="line.894"></a>
<span class="sourceLineNo">895</span>    @Test<a name="line.895"></a>
<span class="sourceLineNo">896</span>    public void testAuthorTroubles() throws Exception {<a name="line.896"></a>
<span class="sourceLineNo">897</span>        assertParsedParts("Cribbia pendula la Croix &amp; P.J.Cribb", NameType.SCIENTIFIC, "Cribbia", "pendula", null, null, "la Croix &amp; P.J.Cribb", null);<a name="line.897"></a>
<span class="sourceLineNo">898</span>        assertParsedParts("Cribbia pendula le Croix &amp; P.J.Cribb", NameType.SCIENTIFIC, "Cribbia", "pendula", null, null, "le Croix &amp; P.J.Cribb", null);<a name="line.898"></a>
<span class="sourceLineNo">899</span>        assertParsedParts("Cribbia pendula de la Croix &amp; le P.J.Cribb", NameType.SCIENTIFIC, "Cribbia", "pendula", null, null, "de la Croix &amp; le P.J.Cribb", null);<a name="line.899"></a>
<span class="sourceLineNo">900</span>        assertParsedParts("Cribbia pendula Croix &amp; de le P.J.Cribb", NameType.SCIENTIFIC, "Cribbia", "pendula", null, null, "Croix &amp; de le P.J.Cribb", null);<a name="line.900"></a>
<span class="sourceLineNo">901</span>    }<a name="line.901"></a>
<span class="sourceLineNo">902</span><a name="line.902"></a>
<span class="sourceLineNo">903</span>    /**<a name="line.903"></a>
<span class="sourceLineNo">904</span>     * http://dev.gbif.org/issues/browse/POR-159<a name="line.904"></a>
<span class="sourceLineNo">905</span>     */<a name="line.905"></a>
<span class="sourceLineNo">906</span>    @Test<a name="line.906"></a>
<span class="sourceLineNo">907</span>    public void testMicrobialRanks() throws Exception {<a name="line.907"></a>
<span class="sourceLineNo">908</span>        assertParsedMicrobial("Salmonella enterica serovar Typhimurium",<a name="line.908"></a>
<span class="sourceLineNo">909</span>                NameType.SCIENTIFIC, "Salmonella", "enterica", "Typhimurium", Rank.SEROVAR);<a name="line.909"></a>
<span class="sourceLineNo">910</span>        assertParsedMicrobial("Salmonella enterica serovar Dublin",<a name="line.910"></a>
<span class="sourceLineNo">911</span>                NameType.SCIENTIFIC, "Salmonella", "enterica", "Dublin", Rank.SEROVAR);<a name="line.911"></a>
<span class="sourceLineNo">912</span><a name="line.912"></a>
<span class="sourceLineNo">913</span>        assertParsedMicrobial("Yersinia pestis biovar Orientalis str. IP674",<a name="line.913"></a>
<span class="sourceLineNo">914</span>                NameType.INFORMAL, "Yersinia", "pestis", "Orientalis", Rank.BIOVAR, null, null, null, null, "IP674");<a name="line.914"></a>
<span class="sourceLineNo">915</span>        assertParsedMicrobial("Rhizobium leguminosarum biovar viciae",<a name="line.915"></a>
<span class="sourceLineNo">916</span>                NameType.SCIENTIFIC, "Rhizobium", "leguminosarum", "viciae", Rank.BIOVAR);<a name="line.916"></a>
<span class="sourceLineNo">917</span><a name="line.917"></a>
<span class="sourceLineNo">918</span>        assertParsedMicrobial("Thymus vulgaris ct. thymol",<a name="line.918"></a>
<span class="sourceLineNo">919</span>                NameType.SCIENTIFIC, "Thymus", "vulgaris", "thymol", Rank.CHEMOFORM);<a name="line.919"></a>
<span class="sourceLineNo">920</span><a name="line.920"></a>
<span class="sourceLineNo">921</span>        assertParsedMicrobial("Staphyloccocus aureus phagovar 42D",<a name="line.921"></a>
<span class="sourceLineNo">922</span>                NameType.SCIENTIFIC, "Staphyloccocus", "aureus", "42D", Rank.PHAGOVAR);<a name="line.922"></a>
<span class="sourceLineNo">923</span><a name="line.923"></a>
<span class="sourceLineNo">924</span>        assertParsedMicrobial("Pseudomonas syringae pv. lachrymans",<a name="line.924"></a>
<span class="sourceLineNo">925</span>                NameType.SCIENTIFIC, "Pseudomonas", "syringae", "lachrymans", Rank.PATHOVAR);<a name="line.925"></a>
<span class="sourceLineNo">926</span><a name="line.926"></a>
<span class="sourceLineNo">927</span>        assertParsedMicrobial("Pseudomonas syringae pv. aceris (Ark, 1939) Young, Dye &amp; Wilkie, 1978",<a name="line.927"></a>
<span class="sourceLineNo">928</span>                NameType.SCIENTIFIC, "Pseudomonas", "syringae", "aceris", Rank.PATHOVAR, "Young, Dye &amp; Wilkie", "1978", "Ark", "1939", null);<a name="line.928"></a>
<span class="sourceLineNo">929</span><a name="line.929"></a>
<span class="sourceLineNo">930</span>        assertParsedMicrobial("Acinetobacter junii morphovar I",<a name="line.930"></a>
<span class="sourceLineNo">931</span>                NameType.SCIENTIFIC, "Acinetobacter", "junii", "I", Rank.MORPHOVAR);<a name="line.931"></a>
<span class="sourceLineNo">932</span><a name="line.932"></a>
<span class="sourceLineNo">933</span>        assertParsedMicrobial("Puccinia graminis f. sp. avenae",<a name="line.933"></a>
<span class="sourceLineNo">934</span>                NameType.SCIENTIFIC, "Puccinia", "graminis", "avenae", Rank.FORMA_SPECIALIS);<a name="line.934"></a>
<span class="sourceLineNo">935</span><a name="line.935"></a>
<span class="sourceLineNo">936</span>        assertParsedMicrobial("Puccinia graminis f.sp. avenae",<a name="line.936"></a>
<span class="sourceLineNo">937</span>                NameType.SCIENTIFIC, "Puccinia", "graminis", "avenae", Rank.FORMA_SPECIALIS);<a name="line.937"></a>
<span class="sourceLineNo">938</span><a name="line.938"></a>
<span class="sourceLineNo">939</span>        assertParsedMicrobial("Bacillus thuringiensis serovar huazhongensis",<a name="line.939"></a>
<span class="sourceLineNo">940</span>                NameType.SCIENTIFIC, "Bacillus", "thuringiensis", "huazhongensis", Rank.SEROVAR);<a name="line.940"></a>
<span class="sourceLineNo">941</span><a name="line.941"></a>
<span class="sourceLineNo">942</span>        // informal indet name<a name="line.942"></a>
<span class="sourceLineNo">943</span>        assertParsedMicrobial("Bacillus thuringiensis serovar",<a name="line.943"></a>
<span class="sourceLineNo">944</span>                NameType.INFORMAL, "Bacillus", "thuringiensis", null, Rank.SEROVAR);<a name="line.944"></a>
<span class="sourceLineNo">945</span><a name="line.945"></a>
<span class="sourceLineNo">946</span>        // informal indet name<a name="line.946"></a>
<span class="sourceLineNo">947</span>        assertParsedMicrobial("Bacillus serovar",<a name="line.947"></a>
<span class="sourceLineNo">948</span>                NameType.INFORMAL, "Bacillus", null, null, Rank.SEROVAR);<a name="line.948"></a>
<span class="sourceLineNo">949</span><a name="line.949"></a>
<span class="sourceLineNo">950</span>        assertParsedMicrobial("Listeria monocytogenes serovar 4b",<a name="line.950"></a>
<span class="sourceLineNo">951</span>                NameType.SCIENTIFIC, "Listeria", "monocytogenes", "4b", Rank.SEROVAR);<a name="line.951"></a>
<span class="sourceLineNo">952</span><a name="line.952"></a>
<span class="sourceLineNo">953</span>        assertParsedMicrobial("Listeria monocytogenes serotype 4b",<a name="line.953"></a>
<span class="sourceLineNo">954</span>                NameType.SCIENTIFIC, "Listeria", "monocytogenes", "4b", Rank.SEROVAR);<a name="line.954"></a>
<span class="sourceLineNo">955</span>    }<a name="line.955"></a>
<span class="sourceLineNo">956</span><a name="line.956"></a>
<span class="sourceLineNo">957</span>    @Test<a name="line.957"></a>
<span class="sourceLineNo">958</span>    @Ignore("strains not yet well parsed, see http://dev.gbif.org/issues/browse/POR-2699")<a name="line.958"></a>
<span class="sourceLineNo">959</span>    public void testBacteriaStrains() throws Exception {<a name="line.959"></a>
<span class="sourceLineNo">960</span>        assertParsedMicrobial("Listeria monocytogenes serotype 4b str. F, 2365", NameType.INFORMAL, "Listeria",<a name="line.960"></a>
<span class="sourceLineNo">961</span>                "monocytogenes", "4b", Rank.SEROVAR, "F, 2365");<a name="line.961"></a>
<span class="sourceLineNo">962</span>    }<a name="line.962"></a>
<span class="sourceLineNo">963</span><a name="line.963"></a>
<span class="sourceLineNo">964</span>    @Test<a name="line.964"></a>
<span class="sourceLineNo">965</span>    public void testAutonyms() throws Exception {<a name="line.965"></a>
<span class="sourceLineNo">966</span>        assertParsedParts("Panthera leo leo (Linnaeus, 1758)", NameType.SCIENTIFIC, "Panthera", "leo", "leo", null, null, null, "Linnaeus",<a name="line.966"></a>
<span class="sourceLineNo">967</span>                "1758");<a name="line.967"></a>
<span class="sourceLineNo">968</span>        assertParsedParts("Abies alba subsp. alba L.", NameType.SCIENTIFIC, "Abies", "alba", "alba", "subsp.", "L.");<a name="line.968"></a>
<span class="sourceLineNo">969</span>        //TODO: improve nameparser to extract autonym authors, http://dev.gbif.org/issues/browse/GBIFCOM-10<a name="line.969"></a>
<span class="sourceLineNo">970</span>        //    assertParsedParts("Abies alba L. subsp. alba", "Abies", "alba", "alba", "subsp.", "L.");<a name="line.970"></a>
<span class="sourceLineNo">971</span>        // this is a wrong name! autonym authors are the species authors, so if both are given they must be the same!<a name="line.971"></a>
<span class="sourceLineNo">972</span>        //    assertParsedParts("Abies alba L. subsp. alba Mill.", "Abies", "alba", "alba", "subsp.", "L.");<a name="line.972"></a>
<span class="sourceLineNo">973</span>    }<a name="line.973"></a>
<span class="sourceLineNo">974</span><a name="line.974"></a>
<span class="sourceLineNo">975</span>    @Test<a name="line.975"></a>
<span class="sourceLineNo">976</span>    public void testNameParserFull() throws Exception {<a name="line.976"></a>
<span class="sourceLineNo">977</span>        assertParsedParts("Abies alba L.", NameType.SCIENTIFIC, "Abies", "alba", null, null, "L.");<a name="line.977"></a>
<span class="sourceLineNo">978</span>        assertParsedParts("Abies alba var. kosovo", "Abies", "alba", "kosovo", "var.");<a name="line.978"></a>
<span class="sourceLineNo">979</span>        assertParsedParts("Abies alba subsp. parafil", "Abies", "alba", "parafil", "subsp.");<a name="line.979"></a>
<span class="sourceLineNo">980</span>        assertParsedParts("Abies   alba L. ssp. parafil DC.", "Abies", "alba", "parafil", "subsp.", "DC.");<a name="line.980"></a>
<span class="sourceLineNo">981</span><a name="line.981"></a>
<span class="sourceLineNo">982</span>        assertParsedParts("Nuculoidea behrens var.christoph Williams &amp; Breger [1916]  ", NameType.DOUBTFUL, "Nuculoidea", "behrens",<a name="line.982"></a>
<span class="sourceLineNo">983</span>                "christoph", "var.", "Williams &amp; Breger", "1916");<a name="line.983"></a>
<span class="sourceLineNo">984</span>        assertParsedParts(" Nuculoidea Williams et  Breger 1916  ", NameType.SCIENTIFIC, "Nuculoidea", null, null, null, "Williams &amp; Breger", "1916");<a name="line.984"></a>
<span class="sourceLineNo">985</span><a name="line.985"></a>
<span class="sourceLineNo">986</span>        assertParsedParts("Nuculoidea behrens v.christoph Williams &amp; Breger [1916]  ", NameType.DOUBTFUL, "Nuculoidea", "behrens", "christoph",<a name="line.986"></a>
<span class="sourceLineNo">987</span>                "var.", "Williams &amp; Breger", "1916");<a name="line.987"></a>
<span class="sourceLineNo">988</span>        assertParsedParts("Nuculoidea behrens var.christoph Williams &amp; Breger [1916]  ", NameType.DOUBTFUL, "Nuculoidea", "behrens",<a name="line.988"></a>
<span class="sourceLineNo">989</span>                "christoph", "var.", "Williams &amp; Breger", "1916");<a name="line.989"></a>
<span class="sourceLineNo">990</span>        assertParsedParts(" Megacardita hornii  calafia", "Megacardita", "hornii", "calafia", null);<a name="line.990"></a>
<span class="sourceLineNo">991</span>        assertParsedParts(" Megacardita hornii  calafia", "Megacardita", "hornii", "calafia", null);<a name="line.991"></a>
<span class="sourceLineNo">992</span>        assertParsedParts(" A. anthophora acervorum", "A.", "anthophora", "acervorum", null);<a name="line.992"></a>
<span class="sourceLineNo">993</span>        assertParsedParts(" x Festulolium nilssonii Cugnac &amp; A. Camus", null, NameType.SCIENTIFIC, "Festulolium", null, "nilssonii", null, null,<a name="line.993"></a>
<span class="sourceLineNo">994</span>                NamePart.GENERIC, "Cugnac &amp; A. Camus", null, null, null, null, null);<a name="line.994"></a>
<span class="sourceLineNo">995</span>        assertParsedParts("x Festulolium nilssonii Cugnac &amp; A. Camus", null, NameType.SCIENTIFIC, "Festulolium", null, "nilssonii", null, null,<a name="line.995"></a>
<span class="sourceLineNo">996</span>                NamePart.GENERIC, "Cugnac &amp; A. Camus", null, null, null, null, null);<a name="line.996"></a>
<span class="sourceLineNo">997</span>        assertParsedParts("Festulolium x nilssonii Cugnac &amp; A. Camus", null, NameType.SCIENTIFIC, "Festulolium", null, "nilssonii", null, null,<a name="line.997"></a>
<span class="sourceLineNo">998</span>                NamePart.SPECIFIC, "Cugnac &amp; A. Camus", null, null, null, null, null);<a name="line.998"></a>
<span class="sourceLineNo">999</span><a name="line.999"></a>
<span class="sourceLineNo">1000</span>        assertParsedParts("Ges Klaus 1895", "Ges", null, null, null, "Klaus", "1895");<a name="line.1000"></a>
<span class="sourceLineNo">1001</span>        assertParsedParts("Ge Nicéville 1895", "Ge", null, null, null, "Nicéville", "1895");<a name="line.1001"></a>
<span class="sourceLineNo">1002</span>        assertParsedParts("Œdicnemus capensis", "Œdicnemus", "capensis", null, null, null);<a name="line.1002"></a>
<span class="sourceLineNo">1003</span>        assertParsedParts("Zophosis persis (Chatanay, 1914)", null, "Zophosis", "persis", null, null, null, null, "Chatanay",<a name="line.1003"></a>
<span class="sourceLineNo">1004</span>                "1914");<a name="line.1004"></a>
<span class="sourceLineNo">1005</span>        assertParsedParts("Caulerpa cupressoides forma nuda", "Caulerpa", "cupressoides", "nuda", "f.", null);<a name="line.1005"></a>
<span class="sourceLineNo">1006</span>        assertParsedParts("Agalinis purpurea (L.) Briton var. borealis (Berg.) Peterson 1987", null, "Agalinis", "purpurea",<a name="line.1006"></a>
<span class="sourceLineNo">1007</span>                "borealis", "var.", "Peterson", "1987", "Berg.", null);<a name="line.1007"></a>
<span class="sourceLineNo">1008</span>        assertParsedParts("Agaricus squamula Berk. &amp; M. A. Curtis 1860", null, "Agaricus", "squamula", null, null,<a name="line.1008"></a>
<span class="sourceLineNo">1009</span>                "Berk. &amp; M. A. Curtis", "1860", null, null);<a name="line.1009"></a>
<span class="sourceLineNo">1010</span>        assertParsedParts("Agaricus squamula Berk. &amp; M.A. Curtis 1860", null, "Agaricus", "squamula", null, null,<a name="line.1010"></a>
<span class="sourceLineNo">1011</span>                "Berk. &amp; M.A. Curtis", "1860", null, null);<a name="line.1011"></a>
<span class="sourceLineNo">1012</span>        assertParsedParts("Cladoniicola staurospora Diederich, van den Boom &amp; Aptroot 2001", "Cladoniicola", "staurospora",<a name="line.1012"></a>
<span class="sourceLineNo">1013</span>                null, null, "Diederich, van den Boom &amp; Aptroot", "2001");<a name="line.1013"></a>
<span class="sourceLineNo">1014</span>        assertParsedParts(" Pompeja psorica Herrich-Schöffer [1854]", "Pompeja", "psorica", null, null, "Herrich-Schöffer",<a name="line.1014"></a>
<span class="sourceLineNo">1015</span>                "1854");<a name="line.1015"></a>
<span class="sourceLineNo">1016</span>        assertParsedParts(" Gloveria sphingiformis Barnes &amp; McDunnough 1910", "Gloveria", "sphingiformis", null, null,<a name="line.1016"></a>
<span class="sourceLineNo">1017</span>                "Barnes &amp; McDunnough", "1910");<a name="line.1017"></a>
<span class="sourceLineNo">1018</span>        assertParsedParts("Gastromega badia Saalmüller 1877/78", "Gastromega", "badia", null, null, "Saalmüller", "1877/78");<a name="line.1018"></a>
<span class="sourceLineNo">1019</span>        assertParsedParts("Hasora coulteri Wood-Mason &amp; de Nicóville 1886", "Hasora", "coulteri", null, null,<a name="line.1019"></a>
<span class="sourceLineNo">1020</span>                "Wood-Mason &amp; de Nicóville", "1886");<a name="line.1020"></a>
<span class="sourceLineNo">1021</span>        assertParsedParts("Pithauria uma De Nicóville 1888", "Pithauria", "uma", null, null, "De Nicóville", "1888");<a name="line.1021"></a>
<span class="sourceLineNo">1022</span>        assertParsedParts(" Lepidostoma quila Bueno-Soria &amp; Padilla-Ramirez 1981", "Lepidostoma", "quila", null, null,<a name="line.1022"></a>
<span class="sourceLineNo">1023</span>                "Bueno-Soria &amp; Padilla-Ramirez", "1981");<a name="line.1023"></a>
<span class="sourceLineNo">1024</span>        assertParsedParts(" Dinarthrum inerme McLachlan 1878", "Dinarthrum", "inerme", null, null, "McLachlan", "1878");<a name="line.1024"></a>
<span class="sourceLineNo">1025</span><a name="line.1025"></a>
<span class="sourceLineNo">1026</span>        assertParsedParts(" Triplectides tambina Mosely in Mosely &amp; Kimmins 1953", "Triplectides", "tambina", null, null,<a name="line.1026"></a>
<span class="sourceLineNo">1027</span>                "Mosely in Mosely &amp; Kimmins", "1953");<a name="line.1027"></a>
<span class="sourceLineNo">1028</span>        assertParsedParts(" Oxyothespis sudanensis Giglio-Tos 1916", "Oxyothespis", "sudanensis", null, null, "Giglio-Tos",<a name="line.1028"></a>
<span class="sourceLineNo">1029</span>                "1916");<a name="line.1029"></a>
<span class="sourceLineNo">1030</span>        assertParsedParts(" Parastagmatoptera theresopolitana (Giglio-Tos 1914)", null, "Parastagmatoptera", "theresopolitana",<a name="line.1030"></a>
<span class="sourceLineNo">1031</span>                null, null, null, null, "Giglio-Tos", "1914");<a name="line.1031"></a>
<span class="sourceLineNo">1032</span>        assertParsedParts(" Oxyothespis nilotica nilotica Giglio-Tos 1916", "Oxyothespis", "nilotica", "nilotica", null,<a name="line.1032"></a>
<span class="sourceLineNo">1033</span>                "Giglio-Tos", "1916");<a name="line.1033"></a>
<span class="sourceLineNo">1034</span>        assertParsedParts(" Photina Cardioptera burmeisteri (Westwood 1889)", null, "Photina", "Cardioptera", "burmeisteri", null, null, null,<a name="line.1034"></a>
<span class="sourceLineNo">1035</span>                null, "Westwood", "1889");<a name="line.1035"></a>
<span class="sourceLineNo">1036</span><a name="line.1036"></a>
<span class="sourceLineNo">1037</span>        assertParsedParts(" Syngenes inquinatus (Gerstaecker, [1885])", null, "Syngenes", "inquinatus", null, null, null, null,<a name="line.1037"></a>
<span class="sourceLineNo">1038</span>                "Gerstaecker", "1885");<a name="line.1038"></a>
<span class="sourceLineNo">1039</span>        assertParsedParts(" Myrmeleon libelloides var. nigriventris A. Costa, [1855]", "Myrmeleon", "libelloides",<a name="line.1039"></a>
<span class="sourceLineNo">1040</span>                "nigriventris", "var.", "A. Costa", "1855");<a name="line.1040"></a>
<span class="sourceLineNo">1041</span>        assertParsedParts("Ascalaphus nigripes (van der Weele, [1909])", null, "Ascalaphus", "nigripes", null, null, null, null,<a name="line.1041"></a>
<span class="sourceLineNo">1042</span>                "van der Weele", "1909");<a name="line.1042"></a>
<span class="sourceLineNo">1043</span>        assertParsedParts(" Ascalaphus guttulatus A. Costa, [1855]", "Ascalaphus", "guttulatus", null, null, "A. Costa",<a name="line.1043"></a>
<span class="sourceLineNo">1044</span>                "1855");<a name="line.1044"></a>
<span class="sourceLineNo">1045</span>        assertParsedParts("Dichochrysa medogana (C.-K. Yang et al in Huang et al. 1988)", null, "Dichochrysa", "medogana", null,<a name="line.1045"></a>
<span class="sourceLineNo">1046</span>                null, null, null, "C.-K. Yang et al. in Huang et al.", "1988");<a name="line.1046"></a>
<span class="sourceLineNo">1047</span>        assertParsedParts(" Dichochrysa vitticlypea (C.-K. Yang &amp; X.-X. Wang 1990)", null, "Dichochrysa", "vitticlypea", null,<a name="line.1047"></a>
<span class="sourceLineNo">1048</span>                null, null, null, "C.-K. Yang &amp; X.-X. Wang", "1990");<a name="line.1048"></a>
<span class="sourceLineNo">1049</span>        assertParsedParts(" Dichochrysa qingchengshana (C.-K. Yang et al. 1992)", null, "Dichochrysa", "qingchengshana", null,<a name="line.1049"></a>
<span class="sourceLineNo">1050</span>                null, null, null, "C.-K. Yang et al.", "1992");<a name="line.1050"></a>
<span class="sourceLineNo">1051</span>        assertParsedParts(" Colomastix tridentata LeCroy 1995", "Colomastix", "tridentata", null, null, "LeCroy", "1995");<a name="line.1051"></a>
<span class="sourceLineNo">1052</span>        assertParsedParts(" Sunamphitoe pelagica (H. Milne Edwards 1830)", null, "Sunamphitoe", "pelagica", null, null, null,<a name="line.1052"></a>
<span class="sourceLineNo">1053</span>                null, "H. Milne Edwards", "1830");<a name="line.1053"></a>
<span class="sourceLineNo">1054</span><a name="line.1054"></a>
<span class="sourceLineNo">1055</span>        // TO BE CONTINUED<a name="line.1055"></a>
<span class="sourceLineNo">1056</span>        assertParsedParts(" Brotogeris jugularis (Statius Muller 1776)", null, "Brotogeris", "jugularis", null, null, null, null,<a name="line.1056"></a>
<span class="sourceLineNo">1057</span>                "Statius Muller", "1776");<a name="line.1057"></a>
<span class="sourceLineNo">1058</span>        assertParsedParts(" Coracopsis nigra sibilans Milne-Edwards &amp; OuStalet 1885", "Coracopsis", "nigra", "sibilans",<a name="line.1058"></a>
<span class="sourceLineNo">1059</span>                null, "Milne-Edwards &amp; OuStalet", "1885");<a name="line.1059"></a>
<span class="sourceLineNo">1060</span>        assertParsedParts(" Trichoglossus haematodus deplanchii J. Verreaux &amp; Des Murs 1860", "Trichoglossus", "haematodus",<a name="line.1060"></a>
<span class="sourceLineNo">1061</span>                "deplanchii", null, "J. Verreaux &amp; Des Murs", "1860");<a name="line.1061"></a>
<span class="sourceLineNo">1062</span>        assertParsedParts(" Nannopsittaca dachilleae O'Neill, Munn &amp; Franke 1991", "Nannopsittaca", "dachilleae", null,<a name="line.1062"></a>
<span class="sourceLineNo">1063</span>                null, "O'Neill, Munn &amp; Franke", "1991");<a name="line.1063"></a>
<span class="sourceLineNo">1064</span>        assertParsedParts(" Ramphastos brevis Meyer de Schauensee 1945", "Ramphastos", "brevis", null, null,<a name="line.1064"></a>
<span class="sourceLineNo">1065</span>                "Meyer de Schauensee", "1945");<a name="line.1065"></a>
<span class="sourceLineNo">1066</span>        assertParsedParts(" Touit melanonota (Wied-Neuwied 1820)", null, "Touit", "melanonota", null, null, null, null,<a name="line.1066"></a>
<span class="sourceLineNo">1067</span>                "Wied-Neuwied", "1820");<a name="line.1067"></a>
<span class="sourceLineNo">1068</span>        assertParsedParts(" Trachyphonus darnaudii (Prevost &amp; Des Murs 1847)", null, "Trachyphonus", "darnaudii", null, null,<a name="line.1068"></a>
<span class="sourceLineNo">1069</span>                null, null, "Prevost &amp; Des Murs", "1847");<a name="line.1069"></a>
<span class="sourceLineNo">1070</span>        assertParsedParts(" Anolis porcatus aracelyae PEREZ-BEATO 1996", "Anolis", "porcatus", "aracelyae", null,<a name="line.1070"></a>
<span class="sourceLineNo">1071</span>                "Perez-Beato", "1996");<a name="line.1071"></a>
<span class="sourceLineNo">1072</span>        assertParsedParts(" Luzonichthys taeniatus Randall &amp; McCosker 1992", "Luzonichthys", "taeniatus", null, null,<a name="line.1072"></a>
<span class="sourceLineNo">1073</span>                "Randall &amp; McCosker", "1992");<a name="line.1073"></a>
<span class="sourceLineNo">1074</span>        assertParsedParts("Actinia stellula Hemprich and Ehrenberg in Ehrenberg 1834", "Actinia", "stellula", null, null,<a name="line.1074"></a>
<span class="sourceLineNo">1075</span>                "Hemprich &amp; Ehrenberg in Ehrenberg", "1834");<a name="line.1075"></a>
<span class="sourceLineNo">1076</span>        assertParsedParts("Anemonia vagans (Less.) Milne Edw.", null, "Anemonia", "vagans", null, null, "Milne Edw.", null,<a name="line.1076"></a>
<span class="sourceLineNo">1077</span>                "Less.", null);<a name="line.1077"></a>
<span class="sourceLineNo">1078</span>        assertParsedParts("Epiactis fecunda (Verrill 1899b)", null, "Epiactis", "fecunda", null, null, null, null, "Verrill",<a name="line.1078"></a>
<span class="sourceLineNo">1079</span>                "1899b");<a name="line.1079"></a>
<span class="sourceLineNo">1080</span>        assertParsedParts(" Pseudocurimata Fernandez-Yepez 1948", "Pseudocurimata", null, null, null, "Fernandez-Yepez",<a name="line.1080"></a>
<span class="sourceLineNo">1081</span>                "1948");<a name="line.1081"></a>
<span class="sourceLineNo">1082</span>        assertParsedParts(" Hershkovitzia Guimarães &amp; d'Andretta 1957", "Hershkovitzia", null, null, null,<a name="line.1082"></a>
<span class="sourceLineNo">1083</span>                "Guimarães &amp; d'Andretta", "1957");<a name="line.1083"></a>
<span class="sourceLineNo">1084</span>        assertParsedParts(" Plectocolea (Mitten) Mitten in B.C. Seemann 1873", null, "Plectocolea", null, null, null,<a name="line.1084"></a>
<span class="sourceLineNo">1085</span>                "Mitten in B.C. Seemann", "1873", "Mitten", null);<a name="line.1085"></a>
<span class="sourceLineNo">1086</span>        assertParsedParts(" Discoporella d'Orbigny 1852", "Discoporella", null, null, null, "d'Orbigny", "1852");<a name="line.1086"></a>
<span class="sourceLineNo">1087</span>        assertParsedParts(" Acripeza Guérin-Ménéville 1838", "Acripeza", null, null, null, "Guérin-Ménéville", "1838");<a name="line.1087"></a>
<span class="sourceLineNo">1088</span>        assertParsedParts(" Subpeltonotus Swaraj Ghai, Kailash Chandra &amp; Ramamurthy 1988", "Subpeltonotus", null, null,<a name="line.1088"></a>
<span class="sourceLineNo">1089</span>                null, "Swaraj Ghai, Kailash Chandra &amp; Ramamurthy", "1988");<a name="line.1089"></a>
<span class="sourceLineNo">1090</span>        assertParsedParts(" Boettcherimima De Souza Lopes 1950", "Boettcherimima", null, null, null, "De Souza Lopes",<a name="line.1090"></a>
<span class="sourceLineNo">1091</span>                "1950");<a name="line.1091"></a>
<span class="sourceLineNo">1092</span>        assertParsedParts(" Surnicou Des Murs 1853", "Surnicou", null, null, null, "Des Murs", "1853");<a name="line.1092"></a>
<span class="sourceLineNo">1093</span>        assertParsedParts(" Cristocypridea Hou MS. 1977", "Cristocypridea", null, null, null, "Hou MS.", "1977");<a name="line.1093"></a>
<span class="sourceLineNo">1094</span>        assertParsedParts("Lecythis coriacea DC.", "Lecythis", "coriacea", null, null, "DC.");<a name="line.1094"></a>
<span class="sourceLineNo">1095</span>        assertParsedParts(" Anhuiphyllum Yu Xueguang 1991", "Anhuiphyllum", null, null, null, "Yu Xueguang", "1991");<a name="line.1095"></a>
<span class="sourceLineNo">1096</span>        assertParsedParts(" Zonosphaeridium minor Tian Chuanrong 1983", "Zonosphaeridium", "minor", null, null,<a name="line.1096"></a>
<span class="sourceLineNo">1097</span>                "Tian Chuanrong", "1983");<a name="line.1097"></a>
<span class="sourceLineNo">1098</span>        assertParsedParts(" Oscarella microlobata Muricy, Boury-Esnault, Bézac &amp; Vacelet 1996", "Oscarella", "microlobata",<a name="line.1098"></a>
<span class="sourceLineNo">1099</span>                null, null, "Muricy, Boury-Esnault, Bézac &amp; Vacelet", "1996");<a name="line.1099"></a>
<span class="sourceLineNo">1100</span>        assertParsedParts(" Neoarctus primigenius Grimaldi de Zio, D'Abbabbo Gallo &amp; Morone de Lucia 1992", "Neoarctus",<a name="line.1100"></a>
<span class="sourceLineNo">1101</span>                "primigenius", null, null, "Grimaldi de Zio, D'Abbabbo Gallo &amp; Morone de Lucia", "1992");<a name="line.1101"></a>
<span class="sourceLineNo">1102</span>        assertParsedParts(" Phaonia wenshuiensis Zhang, Zhao Bin &amp; Wu 1985", "Phaonia", "wenshuiensis", null, null,<a name="line.1102"></a>
<span class="sourceLineNo">1103</span>                "Zhang, Zhao Bin &amp; Wu", "1985");<a name="line.1103"></a>
<span class="sourceLineNo">1104</span>        assertParsedParts(" Heteronychia helanshanensis Han, Zhao-Gan &amp; Ye 1985", "Heteronychia", "helanshanensis", null,<a name="line.1104"></a>
<span class="sourceLineNo">1105</span>                null, "Han, Zhao-Gan &amp; Ye", "1985");<a name="line.1105"></a>
<span class="sourceLineNo">1106</span>        assertParsedParts(" Solanophila karisimbica ab. fulvicollis Mader 1941", "Solanophila", "karisimbica",<a name="line.1106"></a>
<span class="sourceLineNo">1107</span>                "fulvicollis", "ab.", "Mader", "1941");<a name="line.1107"></a>
<span class="sourceLineNo">1108</span>        assertParsedParts(" Tortrix Heterognomon aglossana Kennel 1899", NameType.SCIENTIFIC, "Tortrix", "Heterognomon", "aglossana", null, null, "Kennel",<a name="line.1108"></a>
<span class="sourceLineNo">1109</span>                "1899", null, null);<a name="line.1109"></a>
<span class="sourceLineNo">1110</span>        assertParsedParts(" Leptochilus (Neoleptochilus) beaumonti Giordani Soika 1953", NameType.SCIENTIFIC, "Leptochilus", "Neoleptochilus", "beaumonti", null,<a name="line.1110"></a>
<span class="sourceLineNo">1111</span>                null, "Giordani Soika", "1953", null, null);<a name="line.1111"></a>
<span class="sourceLineNo">1112</span>        assertParsedParts(" Lutzomyia (Helcocyrtomyia) rispaili Torres-Espejo, Caceres &amp; le Pont 1995", NameType.SCIENTIFIC, "Lutzomyia", "Helcocyrtomyia",<a name="line.1112"></a>
<span class="sourceLineNo">1113</span>                "rispaili", null, null, "Torres-Espejo, Caceres &amp; le Pont", "1995", null, null);<a name="line.1113"></a>
<span class="sourceLineNo">1114</span>        assertParsedParts("Gastropacha minima De Lajonquiére 1979", "Gastropacha", "minima", null, null, "De Lajonquiére",<a name="line.1114"></a>
<span class="sourceLineNo">1115</span>                "1979");<a name="line.1115"></a>
<span class="sourceLineNo">1116</span>        assertParsedParts("Lithobius elongipes Chamberlin (1952)", null, "Lithobius", "elongipes", null, null, null, null,<a name="line.1116"></a>
<span class="sourceLineNo">1117</span>                "Chamberlin", "1952");<a name="line.1117"></a>
<span class="sourceLineNo">1118</span>        assertParsedInfrageneric("Maxillaria sect. Multiflorae Christenson", null, "Maxillaria", "Multiflorae", "sect.", "Christenson", null, null, null);<a name="line.1118"></a>
<span class="sourceLineNo">1119</span><a name="line.1119"></a>
<span class="sourceLineNo">1120</span>        assertParsedParts("Maxillaria allenii L.O.Williams in Woodson &amp; Schery", "Maxillaria", "allenii", null, null,<a name="line.1120"></a>
<span class="sourceLineNo">1121</span>                "L.O.Williams in Woodson &amp; Schery");<a name="line.1121"></a>
<span class="sourceLineNo">1122</span>        assertParsedParts("Masdevallia strumosa P.Ortiz &amp; E.Calderón", "Masdevallia", "strumosa", null, null,<a name="line.1122"></a>
<span class="sourceLineNo">1123</span>                "P.Ortiz &amp; E.Calderón");<a name="line.1123"></a>
<span class="sourceLineNo">1124</span>        assertParsedParts("Neobisium (Neobisium) carcinoides balcanicum Hadži 1937", NameType.SCIENTIFIC, "Neobisium", "Neobisium",<a name="line.1124"></a>
<span class="sourceLineNo">1125</span>                "carcinoides", "balcanicum", null, "Hadži", "1937", null, null);<a name="line.1125"></a>
<span class="sourceLineNo">1126</span>        assertParsedParts("Nomascus concolor subsp. lu Delacour, 1951", "Nomascus", "concolor", "lu", "subsp.", "Delacour",<a name="line.1126"></a>
<span class="sourceLineNo">1127</span>                "1951");<a name="line.1127"></a>
<span class="sourceLineNo">1128</span>        assertParsedParts("Polygonum subgen. Bistorta (L.) Zernov", NameType.SCIENTIFIC, "Polygonum", "Bistorta",<a name="line.1128"></a>
<span class="sourceLineNo">1129</span>                null, null, "subgen.", "Zernov", null, "L.", null);<a name="line.1129"></a>
<span class="sourceLineNo">1130</span>        assertParsedParts("Stagonospora polyspora M.T. Lucas &amp; Sousa da Câmara, 1934", "Stagonospora", "polyspora", null,<a name="line.1130"></a>
<span class="sourceLineNo">1131</span>                null, "M.T. Lucas &amp; Sousa da Câmara", "1934");<a name="line.1131"></a>
<span class="sourceLineNo">1132</span><a name="line.1132"></a>
<span class="sourceLineNo">1133</span>        assertParsedParts("Euphorbiaceae de Jussieu, 1789", "Euphorbiaceae", null, null, null, "de Jussieu", "1789");<a name="line.1133"></a>
<span class="sourceLineNo">1134</span>        assertParsedParts("Leucanitis roda Herrich-Schäffer (1851) 1845", null, "Leucanitis", "roda", null, null, null, "1845",<a name="line.1134"></a>
<span class="sourceLineNo">1135</span>                "Herrich-Schäffer", "1851");<a name="line.1135"></a>
<span class="sourceLineNo">1136</span><a name="line.1136"></a>
<span class="sourceLineNo">1137</span>        ParsedName pn = parser.parse("Loranthus incanus Schumach. &amp; Thonn. subsp. sessilis Sprague", null);<a name="line.1137"></a>
<span class="sourceLineNo">1138</span>        assertEquals("Loranthus", pn.getGenusOrAbove());<a name="line.1138"></a>
<span class="sourceLineNo">1139</span>        assertEquals("incanus", pn.getSpecificEpithet());<a name="line.1139"></a>
<span class="sourceLineNo">1140</span>        assertEquals("sessilis", pn.getInfraSpecificEpithet());<a name="line.1140"></a>
<span class="sourceLineNo">1141</span>        assertEquals("Sprague", pn.getAuthorship());<a name="line.1141"></a>
<span class="sourceLineNo">1142</span><a name="line.1142"></a>
<span class="sourceLineNo">1143</span>        pn = parser.parse("Mascagnia brevifolia  var. paniculata Nied.,", null);<a name="line.1143"></a>
<span class="sourceLineNo">1144</span>        assertEquals("Mascagnia", pn.getGenusOrAbove());<a name="line.1144"></a>
<span class="sourceLineNo">1145</span>        assertEquals("brevifolia", pn.getSpecificEpithet());<a name="line.1145"></a>
<span class="sourceLineNo">1146</span>        assertEquals("paniculata", pn.getInfraSpecificEpithet());<a name="line.1146"></a>
<span class="sourceLineNo">1147</span>        assertEquals("Nied.", pn.getAuthorship());<a name="line.1147"></a>
<span class="sourceLineNo">1148</span>        assertEquals(Rank.VARIETY, pn.getRank());<a name="line.1148"></a>
<span class="sourceLineNo">1149</span><a name="line.1149"></a>
<span class="sourceLineNo">1150</span>        pn = parser.parse("Leveillula jaczewskii U. Braun (ined.)", null);<a name="line.1150"></a>
<span class="sourceLineNo">1151</span>        assertEquals("Leveillula", pn.getGenusOrAbove());<a name="line.1151"></a>
<span class="sourceLineNo">1152</span>        assertEquals("jaczewskii", pn.getSpecificEpithet());<a name="line.1152"></a>
<span class="sourceLineNo">1153</span>        assertEquals("U. Braun", pn.getAuthorship());<a name="line.1153"></a>
<span class="sourceLineNo">1154</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.1154"></a>
<span class="sourceLineNo">1155</span><a name="line.1155"></a>
<span class="sourceLineNo">1156</span>        pn = parser.parse("Heteropterys leschenaultiana fo. ovata Nied.", null);<a name="line.1156"></a>
<span class="sourceLineNo">1157</span>        assertEquals("Heteropterys", pn.getGenusOrAbove());<a name="line.1157"></a>
<span class="sourceLineNo">1158</span>        assertEquals("leschenaultiana", pn.getSpecificEpithet());<a name="line.1158"></a>
<span class="sourceLineNo">1159</span>        assertEquals("ovata", pn.getInfraSpecificEpithet());<a name="line.1159"></a>
<span class="sourceLineNo">1160</span>        assertEquals("Nied.", pn.getAuthorship());<a name="line.1160"></a>
<span class="sourceLineNo">1161</span>        assertEquals(Rank.FORM, pn.getRank());<a name="line.1161"></a>
<span class="sourceLineNo">1162</span><a name="line.1162"></a>
<span class="sourceLineNo">1163</span>        pn = parser.parse("Cymbella mendosa f. apiculata (Hust.) VanLand.", null);<a name="line.1163"></a>
<span class="sourceLineNo">1164</span>        assertEquals("Cymbella", pn.getGenusOrAbove());<a name="line.1164"></a>
<span class="sourceLineNo">1165</span>        assertEquals("mendosa", pn.getSpecificEpithet());<a name="line.1165"></a>
<span class="sourceLineNo">1166</span>        assertEquals("apiculata", pn.getInfraSpecificEpithet());<a name="line.1166"></a>
<span class="sourceLineNo">1167</span>        assertEquals("VanLand.", pn.getAuthorship());<a name="line.1167"></a>
<span class="sourceLineNo">1168</span>        assertEquals(Rank.FORM, pn.getRank());<a name="line.1168"></a>
<span class="sourceLineNo">1169</span><a name="line.1169"></a>
<span class="sourceLineNo">1170</span>        pn = parser.parse("Lasioglossum channelense McGinley, 1986", null);<a name="line.1170"></a>
<span class="sourceLineNo">1171</span>        assertEquals("Lasioglossum", pn.getGenusOrAbove());<a name="line.1171"></a>
<span class="sourceLineNo">1172</span>        assertEquals("channelense", pn.getSpecificEpithet());<a name="line.1172"></a>
<span class="sourceLineNo">1173</span>        assertEquals("McGinley", pn.getAuthorship());<a name="line.1173"></a>
<span class="sourceLineNo">1174</span>        assertEquals("1986", pn.getYear());<a name="line.1174"></a>
<span class="sourceLineNo">1175</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.1175"></a>
<span class="sourceLineNo">1176</span><a name="line.1176"></a>
<span class="sourceLineNo">1177</span>        pn = parser.parse("Liolaemus hermannunezi PINCHEIRA-DONOSO, SCOLARO &amp; SCHULTE 2007", null);<a name="line.1177"></a>
<span class="sourceLineNo">1178</span>        assertEquals("Liolaemus", pn.getGenusOrAbove());<a name="line.1178"></a>
<span class="sourceLineNo">1179</span>        assertEquals("hermannunezi", pn.getSpecificEpithet());<a name="line.1179"></a>
<span class="sourceLineNo">1180</span>        assertEquals("Pincheira-Donoso, Scolaro &amp; Schulte", pn.getAuthorship());<a name="line.1180"></a>
<span class="sourceLineNo">1181</span>        assertEquals("2007", pn.getYear());<a name="line.1181"></a>
<span class="sourceLineNo">1182</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.1182"></a>
<span class="sourceLineNo">1183</span><a name="line.1183"></a>
<span class="sourceLineNo">1184</span>        pn = parser.parse("Liolaemus hermannunezi Pincheira-Donoso, Scolaro &amp; Schulte, 2007", null);<a name="line.1184"></a>
<span class="sourceLineNo">1185</span>        assertEquals("Liolaemus", pn.getGenusOrAbove());<a name="line.1185"></a>
<span class="sourceLineNo">1186</span>        assertEquals("hermannunezi", pn.getSpecificEpithet());<a name="line.1186"></a>
<span class="sourceLineNo">1187</span>        assertEquals("Pincheira-Donoso, Scolaro &amp; Schulte", pn.getAuthorship());<a name="line.1187"></a>
<span class="sourceLineNo">1188</span>        assertEquals("2007", pn.getYear());<a name="line.1188"></a>
<span class="sourceLineNo">1189</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.1189"></a>
<span class="sourceLineNo">1190</span><a name="line.1190"></a>
<span class="sourceLineNo">1191</span>        pn = parser.parse("Pseudoeryx relictualis SCHARGEL, RIVAS-FUENMAYOR, BARROS &amp; P.FAUR 2007", null);<a name="line.1191"></a>
<span class="sourceLineNo">1192</span>        assertEquals("Pseudoeryx", pn.getGenusOrAbove());<a name="line.1192"></a>
<span class="sourceLineNo">1193</span>        assertEquals("relictualis", pn.getSpecificEpithet());<a name="line.1193"></a>
<span class="sourceLineNo">1194</span>        assertEquals("Schargel, Rivas-Fuenmayor, Barros &amp; P.Faur", pn.getAuthorship());<a name="line.1194"></a>
<span class="sourceLineNo">1195</span>        assertEquals("2007", pn.getYear());<a name="line.1195"></a>
<span class="sourceLineNo">1196</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.1196"></a>
<span class="sourceLineNo">1197</span><a name="line.1197"></a>
<span class="sourceLineNo">1198</span>        pn = parser.parse("Cyrtodactylus phongnhakebangensis ZIEGLER, RÖSLER, HERRMANN &amp; THANH 2003", null);<a name="line.1198"></a>
<span class="sourceLineNo">1199</span>        assertEquals("Cyrtodactylus", pn.getGenusOrAbove());<a name="line.1199"></a>
<span class="sourceLineNo">1200</span>        assertEquals("phongnhakebangensis", pn.getSpecificEpithet());<a name="line.1200"></a>
<span class="sourceLineNo">1201</span>        assertEquals("Ziegler, Rösler, Herrmann &amp; Thanh", pn.getAuthorship());<a name="line.1201"></a>
<span class="sourceLineNo">1202</span>        assertEquals("2003", pn.getYear());<a name="line.1202"></a>
<span class="sourceLineNo">1203</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.1203"></a>
<span class="sourceLineNo">1204</span><a name="line.1204"></a>
<span class="sourceLineNo">1205</span>        pn = parser.parse(<a name="line.1205"></a>
<span class="sourceLineNo">1206</span>                "Cnemidophorus mumbuca Colli, Caldwell, Costa, Gainsbury, Garda, Mesquita, Filho, Soares, Silva, Valdujo, Vieira, Vitt, Wer", null);<a name="line.1206"></a>
<span class="sourceLineNo">1207</span>        assertEquals("Cnemidophorus", pn.getGenusOrAbove());<a name="line.1207"></a>
<span class="sourceLineNo">1208</span>        assertEquals("mumbuca", pn.getSpecificEpithet());<a name="line.1208"></a>
<span class="sourceLineNo">1209</span>        assertEquals("Colli, Caldwell, Costa, Gainsbury, Garda, Mesquita, Filho, Soares, Silva, Valdujo, Vieira, Vitt, Wer",<a name="line.1209"></a>
<span class="sourceLineNo">1210</span>                pn.getAuthorship());<a name="line.1210"></a>
<span class="sourceLineNo">1211</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.1211"></a>
<span class="sourceLineNo">1212</span><a name="line.1212"></a>
<span class="sourceLineNo">1213</span>        pn = parser.parse(<a name="line.1213"></a>
<span class="sourceLineNo">1214</span>                "Cnemidophorus mumbuca COLLI, CALDWELL, COSTA, GAINSBURY, GARDA, MESQUITA, FILHO, SOARES, SILVA, VALDUJO, VIEIRA, VITT, WER", null);<a name="line.1214"></a>
<span class="sourceLineNo">1215</span>        assertEquals("Cnemidophorus", pn.getGenusOrAbove());<a name="line.1215"></a>
<span class="sourceLineNo">1216</span>        assertEquals("mumbuca", pn.getSpecificEpithet());<a name="line.1216"></a>
<span class="sourceLineNo">1217</span>        assertEquals("Colli, Caldwell, Costa, Gainsbury, Garda, Mesquita, Filho, Soares, Silva, Valdujo, Vieira, Vitt, Wer",<a name="line.1217"></a>
<span class="sourceLineNo">1218</span>                pn.getAuthorship());<a name="line.1218"></a>
<span class="sourceLineNo">1219</span>        assertEquals(Rank.SPECIES, pn.getRank());<a name="line.1219"></a>
<span class="sourceLineNo">1220</span><a name="line.1220"></a>
<span class="sourceLineNo">1221</span>        // TODO: fix this, da Costa Lima should be the author, no epithet<a name="line.1221"></a>
<span class="sourceLineNo">1222</span>        // assertParsedParts(" Pseudophorellia da Costa Lima 1934", "Pseudophorellia", null, null, null,<a name="line.1222"></a>
<span class="sourceLineNo">1223</span>        // "da Costa Lima","1934");<a name="line.1223"></a>
<span class="sourceLineNo">1224</span><a name="line.1224"></a>
<span class="sourceLineNo">1225</span>    }<a name="line.1225"></a>
<span class="sourceLineNo">1226</span><a name="line.1226"></a>
<span class="sourceLineNo">1227</span>    @Test<a name="line.1227"></a>
<span class="sourceLineNo">1228</span>    public void testUnsupportedAuthors() throws Exception {<a name="line.1228"></a>
<span class="sourceLineNo">1229</span>        // NOT YET COMPLETELY PARSING THE AUTHOR<a name="line.1229"></a>
<span class="sourceLineNo">1230</span>        assertParsedParts(" Anolis marmoratus girafus LAZELL 1964: 377", "Anolis", "marmoratus", "girafus", null);<a name="line.1230"></a>
<span class="sourceLineNo">1231</span>        assertParsedParts(" Chorististium maculatum (non Bloch 1790)", "Chorististium", "maculatum", null, null);<a name="line.1231"></a>
<span class="sourceLineNo">1232</span>        assertParsedParts(" Pikea lunulata (non Guichenot 1864)", "Pikea", "lunulata", null, null);<a name="line.1232"></a>
<span class="sourceLineNo">1233</span>        assertParsedParts(" Puntius stoliczkae (non Day 1871)", "Puntius", "stoliczkae", null, null);<a name="line.1233"></a>
<span class="sourceLineNo">1234</span>        assertParsedParts(" Puntius arulius subsp. tambraparniei (non Silas 1954)", "Puntius", "arulius", "tambraparniei",<a name="line.1234"></a>
<span class="sourceLineNo">1235</span>                "subsp.", null);<a name="line.1235"></a>
<span class="sourceLineNo">1236</span>    }<a name="line.1236"></a>
<span class="sourceLineNo">1237</span><a name="line.1237"></a>
<span class="sourceLineNo">1238</span>    /**<a name="line.1238"></a>
<span class="sourceLineNo">1239</span>     * http://dev.gbif.org/issues/browse/POR-2454<a name="line.1239"></a>
<span class="sourceLineNo">1240</span>     */<a name="line.1240"></a>
<span class="sourceLineNo">1241</span>    @Test<a name="line.1241"></a>
<span class="sourceLineNo">1242</span>    public void testFungusNames() throws Exception {<a name="line.1242"></a>
<span class="sourceLineNo">1243</span>        assertParsedParts("Merulius lacrimans (Wulfen : Fr.) Schum.", null, "Merulius", "lacrimans", null, null, "Schum.", null, "Wulfen : Fr.", null);<a name="line.1243"></a>
<span class="sourceLineNo">1244</span>        assertParsedParts("Aecidium berberidis Pers. ex J.F. Gmel.", null, "Aecidium", "berberidis", null, null, "Pers. ex J.F. Gmel.", null, null, null);<a name="line.1244"></a>
<span class="sourceLineNo">1245</span>        assertParsedParts("Roestelia penicillata (O.F. Müll.) Fr.", null, "Roestelia", "penicillata", null, null, "Fr.", null, "O.F. Müll.", null);<a name="line.1245"></a>
<span class="sourceLineNo">1246</span><a name="line.1246"></a>
<span class="sourceLineNo">1247</span>        assertParsedParts("Mycosphaerella eryngii (Fr. Duby) ex Oudem., 1897", null, "Mycosphaerella", "eryngii", null, null, "ex Oudem.", "1897", "Fr. Duby", null);<a name="line.1247"></a>
<span class="sourceLineNo">1248</span>        assertParsedParts("Mycosphaerella eryngii (Fr.ex Duby) ex Oudem. 1897", null, "Mycosphaerella", "eryngii", null, null, "ex Oudem.", "1897", "Fr.ex Duby", null);<a name="line.1248"></a>
<span class="sourceLineNo">1249</span>        assertParsedParts("Mycosphaerella eryngii (Fr. ex Duby) Johanson ex Oudem. 1897", null, "Mycosphaerella", "eryngii", null, null, "Johanson ex Oudem.", "1897", "Fr. ex Duby", null);<a name="line.1249"></a>
<span class="sourceLineNo">1250</span>    }<a name="line.1250"></a>
<span class="sourceLineNo">1251</span><a name="line.1251"></a>
<span class="sourceLineNo">1252</span>    /**<a name="line.1252"></a>
<span class="sourceLineNo">1253</span>     * http://dev.gbif.org/issues/browse/POR-2397<a name="line.1253"></a>
<span class="sourceLineNo">1254</span>     */<a name="line.1254"></a>
<span class="sourceLineNo">1255</span>    @Test<a name="line.1255"></a>
<span class="sourceLineNo">1256</span>    public void testStrainNames() throws Exception {<a name="line.1256"></a>
<span class="sourceLineNo">1257</span>        assertStrain("Candidatus Liberibacter solanacearum", NameType.CANDIDATUS, "Liberibacter", "solanacearum", null, null, null);<a name="line.1257"></a>
<span class="sourceLineNo">1258</span>        assertStrain("Methylocystis sp. M6", NameType.INFORMAL, "Methylocystis", null, null, "sp.", "M6");<a name="line.1258"></a>
<span class="sourceLineNo">1259</span>        assertStrain("Advenella kashmirensis W13003", NameType.INFORMAL, "Advenella", "kashmirensis", null, null, "W13003");<a name="line.1259"></a>
<span class="sourceLineNo">1260</span>        assertStrain("Garra cf. dampaensis M23", NameType.INFORMAL, "Garra", "dampaensis", null, null, "M23");<a name="line.1260"></a>
<span class="sourceLineNo">1261</span>        assertStrain("Sphingobium lucknowense F2", NameType.INFORMAL, "Sphingobium", "lucknowense", null, null, "F2");<a name="line.1261"></a>
<span class="sourceLineNo">1262</span>        assertStrain("Pseudomonas syringae pv. atrofaciens LMG 5095T", NameType.INFORMAL, "Pseudomonas", "syringae", "atrofaciens", "pv.", "LMG 5095T");<a name="line.1262"></a>
<span class="sourceLineNo">1263</span>    }<a name="line.1263"></a>
<span class="sourceLineNo">1264</span><a name="line.1264"></a>
<span class="sourceLineNo">1265</span>    @Test<a name="line.1265"></a>
<span class="sourceLineNo">1266</span>    public void testPathovars() throws Exception {<a name="line.1266"></a>
<span class="sourceLineNo">1267</span>        assertParsedParts("Xanthomonas campestris pv. citri (ex Hasse 1915) Dye 1978", NameType.SCIENTIFIC, "Xanthomonas", "campestris", "citri", "pv.", "Dye", "1978", "ex Hasse", "1915");<a name="line.1267"></a>
<span class="sourceLineNo">1268</span>        assertParsedParts("Xanthomonas campestris pv. oryzae (Xco)", NameType.SCIENTIFIC, "Xanthomonas", "campestris", "oryzae", "pv.", null, null, "Xco", null);<a name="line.1268"></a>
<span class="sourceLineNo">1269</span>        assertParsedParts("Streptococcus dysgalactiae (ex Diernhofer 1932) Garvie et al. 1983", NameType.SCIENTIFIC, "Streptococcus", "dysgalactiae", null, null, "Garvie et al.", "1983", "ex Diernhofer", "1932");<a name="line.1269"></a>
<span class="sourceLineNo">1270</span>    }<a name="line.1270"></a>
<span class="sourceLineNo">1271</span><a name="line.1271"></a>
<span class="sourceLineNo">1272</span>    @Test<a name="line.1272"></a>
<span class="sourceLineNo">1273</span>    public void testImprintYear() throws Exception {<a name="line.1273"></a>
<span class="sourceLineNo">1274</span>        assertParsedParts(" Pompeja psorica Herrich-Schöffer [1854]", NameType.DOUBTFUL, "Pompeja", "psorica", null, null, "Herrich-Schöffer", "1854", null, null);<a name="line.1274"></a>
<span class="sourceLineNo">1275</span>        assertParsedParts(" Syngenes inquinatus (Gerstaecker, [1885])", NameType.DOUBTFUL, "Syngenes", "inquinatus", null, null, null, null, "Gerstaecker", "1885");<a name="line.1275"></a>
<span class="sourceLineNo">1276</span>        assertParsedParts(" Myrmeleon libelloides var. nigriventris A. Costa, [1855]", NameType.DOUBTFUL, "Myrmeleon", "libelloides", "nigriventris", "var.", "A. Costa", "1855");<a name="line.1276"></a>
<span class="sourceLineNo">1277</span>        assertParsedParts("Ascalaphus nigripes (van der Weele, [1909])", NameType.DOUBTFUL, "Ascalaphus", "nigripes", null, null, null, null, "van der Weele", "1909");<a name="line.1277"></a>
<span class="sourceLineNo">1278</span>        assertParsedParts(" Ascalaphus guttulatus A. Costa, [1855]", NameType.DOUBTFUL, "Ascalaphus", "guttulatus", null, null, "A. Costa", "1855");<a name="line.1278"></a>
<span class="sourceLineNo">1279</span>    }<a name="line.1279"></a>
<span class="sourceLineNo">1280</span><a name="line.1280"></a>
<span class="sourceLineNo">1281</span>    @Test<a name="line.1281"></a>
<span class="sourceLineNo">1282</span>    public void testNameParserIssue() throws Exception {<a name="line.1282"></a>
<span class="sourceLineNo">1283</span>        // issue42<a name="line.1283"></a>
<span class="sourceLineNo">1284</span>        ParsedName pn = parser.parse("Abacetus laevicollis de Chaudoir, 1869", null);<a name="line.1284"></a>
<span class="sourceLineNo">1285</span>        assertEquals("Abacetus laevicollis", pn.canonicalNameWithMarker());<a name="line.1285"></a>
<span class="sourceLineNo">1286</span>        assertEquals("de Chaudoir", pn.getAuthorship());<a name="line.1286"></a>
<span class="sourceLineNo">1287</span>        assertEquals("1869", pn.getYear());<a name="line.1287"></a>
<span class="sourceLineNo">1288</span>        assertTrue(1869 == pn.getYearInt());<a name="line.1288"></a>
<span class="sourceLineNo">1289</span>        // issue50<a name="line.1289"></a>
<span class="sourceLineNo">1290</span>        pn = parser.parse("Deinococcus-Thermus", null);<a name="line.1290"></a>
<span class="sourceLineNo">1291</span>        assertEquals("Deinococcus-Thermus", pn.canonicalNameWithMarker());<a name="line.1291"></a>
<span class="sourceLineNo">1292</span>        assertTrue(pn.getAuthorship() == null);<a name="line.1292"></a>
<span class="sourceLineNo">1293</span>        assertTrue(pn.getYear() == null);<a name="line.1293"></a>
<span class="sourceLineNo">1294</span>        // issue51<a name="line.1294"></a>
<span class="sourceLineNo">1295</span>        pn = parser.parse("Alectis alexandrinus (Geoffroy St. Hilaire, 1817)", null);<a name="line.1295"></a>
<span class="sourceLineNo">1296</span>        assertEquals("Alectis alexandrinus", pn.canonicalNameWithMarker());<a name="line.1296"></a>
<span class="sourceLineNo">1297</span>        assertEquals("Geoffroy St. Hilaire", pn.getBracketAuthorship());<a name="line.1297"></a>
<span class="sourceLineNo">1298</span>        assertEquals("1817", pn.getBracketYear());<a name="line.1298"></a>
<span class="sourceLineNo">1299</span>        assertTrue(1817 == pn.getBracketYearInt());<a name="line.1299"></a>
<span class="sourceLineNo">1300</span>        // issue60<a name="line.1300"></a>
<span class="sourceLineNo">1301</span>        pn = parser.parse("Euphorbiaceae de Jussieu, 1789", null);<a name="line.1301"></a>
<span class="sourceLineNo">1302</span>        assertEquals("Euphorbiaceae", pn.canonicalName());<a name="line.1302"></a>
<span class="sourceLineNo">1303</span>        assertEquals("Euphorbiaceae", pn.getGenusOrAbove());<a name="line.1303"></a>
<span class="sourceLineNo">1304</span>        assertEquals("de Jussieu", pn.getAuthorship());<a name="line.1304"></a>
<span class="sourceLineNo">1305</span>        assertEquals("1789", pn.getYear());<a name="line.1305"></a>
<span class="sourceLineNo">1306</span>    }<a name="line.1306"></a>
<span class="sourceLineNo">1307</span><a name="line.1307"></a>
<span class="sourceLineNo">1308</span>    @Test<a name="line.1308"></a>
<span class="sourceLineNo">1309</span>    public void testNameParserRankMarker() throws Exception {<a name="line.1309"></a>
<span class="sourceLineNo">1310</span>        assertEquals(Rank.SUBSPECIES, parser.parse("Coccyzuz americanus ssp.", null).getRank());<a name="line.1310"></a>
<span class="sourceLineNo">1311</span>        assertEquals(Rank.SUBSPECIES, parser.parse("Coccyzuz ssp", null).getRank());<a name="line.1311"></a>
<span class="sourceLineNo">1312</span>        assertEquals(Rank.SPECIES, parser.parse("Asteraceae spec.", null).getRank());<a name="line.1312"></a>
<span class="sourceLineNo">1313</span><a name="line.1313"></a>
<span class="sourceLineNo">1314</span>        ParsedName cn = parser.parse("Asteraceae spec.", null);<a name="line.1314"></a>
<span class="sourceLineNo">1315</span>        assertEquals(Rank.SPECIES, cn.getRank());<a name="line.1315"></a>
<span class="sourceLineNo">1316</span>        assertEquals("sp.", cn.getRankMarker());<a name="line.1316"></a>
<span class="sourceLineNo">1317</span><a name="line.1317"></a>
<span class="sourceLineNo">1318</span>        cn = parser.parse("Callideriphus flavicollis morph. reductus Fuchs 1961", null);<a name="line.1318"></a>
<span class="sourceLineNo">1319</span>        assertEquals(Rank.INFRASUBSPECIFIC_NAME, cn.getRank());<a name="line.1319"></a>
<span class="sourceLineNo">1320</span>        assertEquals("morph.", cn.getRankMarker());<a name="line.1320"></a>
<span class="sourceLineNo">1321</span><a name="line.1321"></a>
<span class="sourceLineNo">1322</span>        ParsedName pn = parser.parse("Euphrasia rostkoviana Hayne subvar. campestris (Jord.) Hartl", null);<a name="line.1322"></a>
<span class="sourceLineNo">1323</span>        assertEquals(Rank.INFRASUBSPECIFIC_NAME, cn.getRank());<a name="line.1323"></a>
<span class="sourceLineNo">1324</span>        assertEquals("subvar.", pn.getRankMarker());<a name="line.1324"></a>
<span class="sourceLineNo">1325</span>        assertEquals("Euphrasia", pn.getGenusOrAbove());<a name="line.1325"></a>
<span class="sourceLineNo">1326</span>        assertEquals("rostkoviana", pn.getSpecificEpithet());<a name="line.1326"></a>
<span class="sourceLineNo">1327</span>        assertEquals("campestris", pn.getInfraSpecificEpithet());<a name="line.1327"></a>
<span class="sourceLineNo">1328</span>        assertEquals("Hartl", pn.getAuthorship());<a name="line.1328"></a>
<span class="sourceLineNo">1329</span>        assertEquals("Jord.", pn.getBracketAuthorship());<a name="line.1329"></a>
<span class="sourceLineNo">1330</span><a name="line.1330"></a>
<span class="sourceLineNo">1331</span>    }<a name="line.1331"></a>
<span class="sourceLineNo">1332</span><a name="line.1332"></a>
<span class="sourceLineNo">1333</span>    /**<a name="line.1333"></a>
<span class="sourceLineNo">1334</span>     * test true bad occurrence names<a name="line.1334"></a>
<span class="sourceLineNo">1335</span>     */<a name="line.1335"></a>
<span class="sourceLineNo">1336</span>    @Test<a name="line.1336"></a>
<span class="sourceLineNo">1337</span>    public void testNameParserSingleDirty() throws Exception {<a name="line.1337"></a>
<span class="sourceLineNo">1338</span>        assertEquals("Verrucaria foveolata", parser.parseToCanonical("Verrucaria foveolata /Flörke) A. Massal.", null));<a name="line.1338"></a>
<span class="sourceLineNo">1339</span>        assertEquals("Limatula gwyni", parser.parse("LImatula gwyni     (Sykes, 1903)", null).canonicalNameWithMarker());<a name="line.1339"></a>
<span class="sourceLineNo">1340</span>        assertEquals("×Fatshedera lizei", parser.parse("× fatshedera lizei", null).canonicalNameWithMarker());<a name="line.1340"></a>
<span class="sourceLineNo">1341</span>        assertEquals("Fatshedera lizei", parser.parse("fatshedera lizei ", null).canonicalNameWithMarker());<a name="line.1341"></a>
<span class="sourceLineNo">1342</span>    }<a name="line.1342"></a>
<span class="sourceLineNo">1343</span><a name="line.1343"></a>
<span class="sourceLineNo">1344</span>    private ParsedName assertParsedInfrageneric(String name, Rank rank, String genus, String infrageneric, String rankMarker, String basAuthor, String basYear) throws UnparsableException {<a name="line.1344"></a>
<span class="sourceLineNo">1345</span>        return assertParsedParts(name, rank, null, genus, infrageneric, null, null, rankMarker, null, null, null, basAuthor, basYear, null, null);<a name="line.1345"></a>
<span class="sourceLineNo">1346</span>    }<a name="line.1346"></a>
<span class="sourceLineNo">1347</span><a name="line.1347"></a>
<span class="sourceLineNo">1348</span>    private ParsedName assertParsedInfrageneric(String name, Rank rank, String genus, String infrageneric, String rankMarker, String author, String year, String basAuthor, String basYear) throws UnparsableException {<a name="line.1348"></a>
<span class="sourceLineNo">1349</span>        return assertParsedParts(name, rank, null, genus, infrageneric, null, null, rankMarker, null, author, year, basAuthor, basYear, null, null);<a name="line.1349"></a>
<span class="sourceLineNo">1350</span>    }<a name="line.1350"></a>
<span class="sourceLineNo">1351</span><a name="line.1351"></a>
<span class="sourceLineNo">1352</span>    private ParsedName assertParsedParts(String name, String genus, String infrageneric, String epithet, String infraepithet,<a name="line.1352"></a>
<span class="sourceLineNo">1353</span>                                         String rank, NamePart notho, String author, String year, String basAuthor, String basYear, String nomStatus) throws UnparsableException {<a name="line.1353"></a>
<span class="sourceLineNo">1354</span>        return assertParsedParts(name, null, null, genus, infrageneric, epithet, infraepithet, rank, notho, author, year, basAuthor, basYear, nomStatus, null);<a name="line.1354"></a>
<span class="sourceLineNo">1355</span>    }<a name="line.1355"></a>
<span class="sourceLineNo">1356</span><a name="line.1356"></a>
<span class="sourceLineNo">1357</span>    private ParsedName assertParsedParts(String name, Rank rank, NameType type, String genus, String infrageneric, String epithet, String infraepithet,<a name="line.1357"></a>
<span class="sourceLineNo">1358</span>                                         String rankMarker, NamePart notho, String author, String year, String basAuthor, String basYear, String nomStatus, String strain)<a name="line.1358"></a>
<span class="sourceLineNo">1359</span>            throws UnparsableException {<a name="line.1359"></a>
<span class="sourceLineNo">1360</span>        ParsedName pn = parser.parse(name, rank);<a name="line.1360"></a>
<span class="sourceLineNo">1361</span>        if (type != null) {<a name="line.1361"></a>
<span class="sourceLineNo">1362</span>            assertEquals(type, pn.getType());<a name="line.1362"></a>
<span class="sourceLineNo">1363</span>        }<a name="line.1363"></a>
<span class="sourceLineNo">1364</span>        assertEquals(genus, pn.getGenusOrAbove());<a name="line.1364"></a>
<span class="sourceLineNo">1365</span>        assertEquals(infrageneric, pn.getInfraGeneric());<a name="line.1365"></a>
<span class="sourceLineNo">1366</span>        assertEquals(epithet, pn.getSpecificEpithet());<a name="line.1366"></a>
<span class="sourceLineNo">1367</span>        assertEquals(infraepithet, pn.getInfraSpecificEpithet());<a name="line.1367"></a>
<span class="sourceLineNo">1368</span>        assertEquals(rankMarker, pn.getRankMarker());<a name="line.1368"></a>
<span class="sourceLineNo">1369</span>        assertEquals(notho, pn.getNotho());<a name="line.1369"></a>
<span class="sourceLineNo">1370</span>        assertEquals(author, pn.getAuthorship());<a name="line.1370"></a>
<span class="sourceLineNo">1371</span>        assertEquals(year, pn.getYear());<a name="line.1371"></a>
<span class="sourceLineNo">1372</span>        assertEquals(basAuthor, pn.getBracketAuthorship());<a name="line.1372"></a>
<span class="sourceLineNo">1373</span>        assertEquals(basYear, pn.getBracketYear());<a name="line.1373"></a>
<span class="sourceLineNo">1374</span>        assertEquals(nomStatus, pn.getNomStatus());<a name="line.1374"></a>
<span class="sourceLineNo">1375</span>        assertEquals(strain, pn.getStrain());<a name="line.1375"></a>
<span class="sourceLineNo">1376</span><a name="line.1376"></a>
<span class="sourceLineNo">1377</span>        return pn;<a name="line.1377"></a>
<span class="sourceLineNo">1378</span>    }<a name="line.1378"></a>
<span class="sourceLineNo">1379</span><a name="line.1379"></a>
<span class="sourceLineNo">1380</span>    private ParsedName assertParsedMicrobial(String name, NameType type, String genus, String epithet, String infraepithet,<a name="line.1380"></a>
<span class="sourceLineNo">1381</span>                                             Rank rank, String strain) throws UnparsableException {<a name="line.1381"></a>
<span class="sourceLineNo">1382</span>        return assertParsedMicrobial(name, type, genus, epithet, infraepithet, rank, null, null, null, null, strain);<a name="line.1382"></a>
<span class="sourceLineNo">1383</span>    }<a name="line.1383"></a>
<span class="sourceLineNo">1384</span><a name="line.1384"></a>
<span class="sourceLineNo">1385</span>    private ParsedName assertParsedMicrobial(String name, NameType type, String genus, String epithet, String infraepithet,<a name="line.1385"></a>
<span class="sourceLineNo">1386</span>                                             Rank rank) throws UnparsableException {<a name="line.1386"></a>
<span class="sourceLineNo">1387</span>        return assertParsedMicrobial(name, type, genus, epithet, infraepithet, rank, null, null, null, null, null);<a name="line.1387"></a>
<span class="sourceLineNo">1388</span>    }<a name="line.1388"></a>
<span class="sourceLineNo">1389</span><a name="line.1389"></a>
<span class="sourceLineNo">1390</span>    private ParsedName assertParsedMicrobial(String name, NameType type, String genus, String epithet, String infraepithet,<a name="line.1390"></a>
<span class="sourceLineNo">1391</span>                                             Rank rank, String author, String year, String basAuthor, String basYear, String strain)<a name="line.1391"></a>
<span class="sourceLineNo">1392</span>            throws UnparsableException {<a name="line.1392"></a>
<span class="sourceLineNo">1393</span>        ParsedName pn = parser.parse(name, null);<a name="line.1393"></a>
<span class="sourceLineNo">1394</span>        assertEquals(genus, pn.getGenusOrAbove());<a name="line.1394"></a>
<span class="sourceLineNo">1395</span>        assertEquals(epithet, pn.getSpecificEpithet());<a name="line.1395"></a>
<span class="sourceLineNo">1396</span>        assertEquals(infraepithet, pn.getInfraSpecificEpithet());<a name="line.1396"></a>
<span class="sourceLineNo">1397</span>        assertEquals(rank, pn.getRank());<a name="line.1397"></a>
<span class="sourceLineNo">1398</span>        assertEquals(author, pn.getAuthorship());<a name="line.1398"></a>
<span class="sourceLineNo">1399</span>        assertEquals(year, pn.getYear());<a name="line.1399"></a>
<span class="sourceLineNo">1400</span>        assertEquals(basAuthor, pn.getBracketAuthorship());<a name="line.1400"></a>
<span class="sourceLineNo">1401</span>        assertEquals(basYear, pn.getBracketYear());<a name="line.1401"></a>
<span class="sourceLineNo">1402</span>        assertEquals(strain, pn.getStrain());<a name="line.1402"></a>
<span class="sourceLineNo">1403</span>        if (type != null) {<a name="line.1403"></a>
<span class="sourceLineNo">1404</span>            assertEquals(type, pn.getType());<a name="line.1404"></a>
<span class="sourceLineNo">1405</span>        }<a name="line.1405"></a>
<span class="sourceLineNo">1406</span>        assertNull(pn.getNomStatus());<a name="line.1406"></a>
<span class="sourceLineNo">1407</span>        assertNull(pn.getNotho());<a name="line.1407"></a>
<span class="sourceLineNo">1408</span>        return pn;<a name="line.1408"></a>
<span class="sourceLineNo">1409</span>    }<a name="line.1409"></a>
<span class="sourceLineNo">1410</span><a name="line.1410"></a>
<span class="sourceLineNo">1411</span>    private ParsedName assertParsedName(String name, NameType type, String genus, String epithet, String infraepithet, String rank) {<a name="line.1411"></a>
<span class="sourceLineNo">1412</span>        ParsedName pn = null;<a name="line.1412"></a>
<span class="sourceLineNo">1413</span>        try {<a name="line.1413"></a>
<span class="sourceLineNo">1414</span>            pn = assertParsedParts(name, null, type, genus, null, epithet, infraepithet, rank, null, null, null, null, null, null, null);<a name="line.1414"></a>
<span class="sourceLineNo">1415</span>            assertEquals("Wrong name type", type, pn.getType());<a name="line.1415"></a>
<span class="sourceLineNo">1416</span>        } catch (UnparsableException e) {<a name="line.1416"></a>
<span class="sourceLineNo">1417</span>            assertEquals("Wrong name type", type, e.type);<a name="line.1417"></a>
<span class="sourceLineNo">1418</span>        }<a name="line.1418"></a>
<span class="sourceLineNo">1419</span>        return pn;<a name="line.1419"></a>
<span class="sourceLineNo">1420</span>    }<a name="line.1420"></a>
<span class="sourceLineNo">1421</span><a name="line.1421"></a>
<span class="sourceLineNo">1422</span>    private void assertParsedParts(String name, NameType type, String genus, String infrageneric, String epithet, String infraepithet, String rank, String author, String year, String basAuthor, String basYear) throws UnparsableException {<a name="line.1422"></a>
<span class="sourceLineNo">1423</span>        assertParsedParts(name, null, type, genus, infrageneric, epithet, infraepithet, rank, null, author, year, basAuthor, basYear, null, null);<a name="line.1423"></a>
<span class="sourceLineNo">1424</span>    }<a name="line.1424"></a>
<span class="sourceLineNo">1425</span><a name="line.1425"></a>
<span class="sourceLineNo">1426</span>    private void assertParsedParts(String name, NameType type, String genus, String epithet, String infraepithet, String rank, String author, String year, String basAuthor, String basYear) throws UnparsableException {<a name="line.1426"></a>
<span class="sourceLineNo">1427</span>        assertParsedParts(name, null, type, genus, null, epithet, infraepithet, rank, null, author, year, basAuthor, basYear, null, null);<a name="line.1427"></a>
<span class="sourceLineNo">1428</span>    }<a name="line.1428"></a>
<span class="sourceLineNo">1429</span><a name="line.1429"></a>
<span class="sourceLineNo">1430</span>    private void assertParsedParts(String name, String genus, String epithet, String infraepithet, String rank)<a name="line.1430"></a>
<span class="sourceLineNo">1431</span>            throws UnparsableException {<a name="line.1431"></a>
<span class="sourceLineNo">1432</span>        assertParsedParts(name, null, genus, null, epithet, infraepithet, rank, null, null, null, null);<a name="line.1432"></a>
<span class="sourceLineNo">1433</span>    }<a name="line.1433"></a>
<span class="sourceLineNo">1434</span><a name="line.1434"></a>
<span class="sourceLineNo">1435</span>    private void assertParsedParts(String name, String genus, String epithet, String infraepithet, String rank, String author) throws UnparsableException {<a name="line.1435"></a>
<span class="sourceLineNo">1436</span>        assertParsedParts(name, null, genus, null, epithet, infraepithet, rank, author, null, null, null);<a name="line.1436"></a>
<span class="sourceLineNo">1437</span>    }<a name="line.1437"></a>
<span class="sourceLineNo">1438</span><a name="line.1438"></a>
<span class="sourceLineNo">1439</span>    private void assertParsedParts(String name, NameType type, String genus, String epithet, String infraepithet, String rank, String author) throws UnparsableException {<a name="line.1439"></a>
<span class="sourceLineNo">1440</span>        assertParsedParts(name, type, genus, null, epithet, infraepithet, rank, author, null, null, null);<a name="line.1440"></a>
<span class="sourceLineNo">1441</span>    }<a name="line.1441"></a>
<span class="sourceLineNo">1442</span><a name="line.1442"></a>
<span class="sourceLineNo">1443</span>    private void assertParsedParts(String name, String genus, String epithet, String infraepithet, String rank, String author, String year) throws UnparsableException {<a name="line.1443"></a>
<span class="sourceLineNo">1444</span>        assertParsedParts(name, null, genus, null, epithet, infraepithet, rank, author, year, null, null);<a name="line.1444"></a>
<span class="sourceLineNo">1445</span>    }<a name="line.1445"></a>
<span class="sourceLineNo">1446</span><a name="line.1446"></a>
<span class="sourceLineNo">1447</span>    private void assertParsedParts(String name, String genus, String epithet, String infraepithet, NamePart notho, String rank, String author, String year) throws UnparsableException {<a name="line.1447"></a>
<span class="sourceLineNo">1448</span>        assertParsedParts(name, null, null, genus, null, epithet, infraepithet, rank, notho, author, year, null, null, null, null);<a name="line.1448"></a>
<span class="sourceLineNo">1449</span>    }<a name="line.1449"></a>
<span class="sourceLineNo">1450</span><a name="line.1450"></a>
<span class="sourceLineNo">1451</span>    private void assertParsedParts(String name, NameType type, String genus, String epithet, String infraepithet, String rank, String author, String year) throws UnparsableException {<a name="line.1451"></a>
<span class="sourceLineNo">1452</span>        assertParsedParts(name, type, genus, null, epithet, infraepithet, rank, author, year, null, null);<a name="line.1452"></a>
<span class="sourceLineNo">1453</span>    }<a name="line.1453"></a>
<span class="sourceLineNo">1454</span><a name="line.1454"></a>
<span class="sourceLineNo">1455</span>    private void assertStrain(String name, NameType type, String genus, String epithet, String infraepithet, String rank, String strain) throws UnparsableException {<a name="line.1455"></a>
<span class="sourceLineNo">1456</span>        assertParsedParts(name, null, type, genus, null, epithet, infraepithet, rank, null, null, null, null, null, null, strain);<a name="line.1456"></a>
<span class="sourceLineNo">1457</span>    }<a name="line.1457"></a>
<span class="sourceLineNo">1458</span><a name="line.1458"></a>
<span class="sourceLineNo">1459</span>    @Test<a name="line.1459"></a>
<span class="sourceLineNo">1460</span>    public void testInfragenericRanks() throws Exception {<a name="line.1460"></a>
<span class="sourceLineNo">1461</span>        assertParsedInfrageneric("Bodotria (Vertebrata)", Rank.SUBGENUS, "Bodotria", "Vertebrata", "subgen.", null, null);<a name="line.1461"></a>
<span class="sourceLineNo">1462</span><a name="line.1462"></a>
<span class="sourceLineNo">1463</span>        assertParsedInfrageneric("Bodotria (Goodsir)", null, "Bodotria", null, null, "Goodsir", null);<a name="line.1463"></a>
<span class="sourceLineNo">1464</span>        assertParsedInfrageneric("Bodotria (Goodsir)", Rank.SUBGENUS, "Bodotria", "Goodsir", "subgen.", null, null);<a name="line.1464"></a>
<span class="sourceLineNo">1465</span>        assertParsedInfrageneric("Bodotria (J.Goodsir)", Rank.SUBGENUS, "Bodotria", null, "subgen.", "J.Goodsir", null);<a name="line.1465"></a>
<span class="sourceLineNo">1466</span><a name="line.1466"></a>
<span class="sourceLineNo">1467</span>        assertParsedInfrageneric("Latrunculia (Biannulata)", Rank.SUBGENUS, "Latrunculia", "Biannulata", "subgen.", null, null);<a name="line.1467"></a>
<span class="sourceLineNo">1468</span><a name="line.1468"></a>
<span class="sourceLineNo">1469</span>        assertParsedParts("Saperda (Saperda) candida m. bipunctata Breuning, 1952", null, NameType.SCIENTIFIC, "Saperda", "Saperda", "candida",<a name="line.1469"></a>
<span class="sourceLineNo">1470</span>                "bipunctata", "m.", null, "Breuning", "1952", null, null, null, null);<a name="line.1470"></a>
<span class="sourceLineNo">1471</span><a name="line.1471"></a>
<span class="sourceLineNo">1472</span>        assertParsedParts("Carex section Acrocystis", null, NameType.SCIENTIFIC, "Carex", "Acrocystis", null, null, "sect.", null, null, null, null, null, null, null);<a name="line.1472"></a>
<span class="sourceLineNo">1473</span><a name="line.1473"></a>
<span class="sourceLineNo">1474</span>        assertParsedParts("Juncus subgenus Alpini", null, NameType.SCIENTIFIC, "Juncus", "Alpini", null, null, "subgen.", null, null, null, null, null, null, null);<a name="line.1474"></a>
<span class="sourceLineNo">1475</span><a name="line.1475"></a>
<span class="sourceLineNo">1476</span>        assertParsedParts("Solidago subsection Triplinervae", null, NameType.SCIENTIFIC, "Solidago", "Triplinervae", null, null, "subsect.", null, null, null, null, null, null, null);<a name="line.1476"></a>
<span class="sourceLineNo">1477</span><a name="line.1477"></a>
<span class="sourceLineNo">1478</span>        assertParsedParts("Eleocharis series Maculosae", null, NameType.SCIENTIFIC, "Eleocharis", "Maculosae", null, null, "ser.", null, null, null, null, null, null, null);<a name="line.1478"></a>
<span class="sourceLineNo">1479</span><a name="line.1479"></a>
<span class="sourceLineNo">1480</span>        assertParsedParts("Hylaeus (Alfkenylaeus) Snelling, 1985", Rank.SECTION, NameType.SCIENTIFIC, "Hylaeus", "Alfkenylaeus", null, null, "sect.", null, "Snelling", "1985", null, null, null, null);<a name="line.1480"></a>
<span class="sourceLineNo">1481</span>    }<a name="line.1481"></a>
<span class="sourceLineNo">1482</span><a name="line.1482"></a>
<span class="sourceLineNo">1483</span>    @Test<a name="line.1483"></a>
<span class="sourceLineNo">1484</span>    public void testInfragenericRanks2() throws Exception {<a name="line.1484"></a>
<span class="sourceLineNo">1485</span>        assertParsedInfrageneric("Bodotria (Vertebrata)", null, "Bodotria", "Vertebrata", null, null, null);<a name="line.1485"></a>
<span class="sourceLineNo">1486</span><a name="line.1486"></a>
<span class="sourceLineNo">1487</span>        assertParsedInfrageneric("Bodotria (Goodsir)", null, "Bodotria", null, null, "Goodsir", null);<a name="line.1487"></a>
<span class="sourceLineNo">1488</span>        assertParsedInfrageneric("Bodotria (J.Goodsir)", null, "Bodotria", null, null, "J.Goodsir", null);<a name="line.1488"></a>
<span class="sourceLineNo">1489</span><a name="line.1489"></a>
<span class="sourceLineNo">1490</span>        assertParsedInfrageneric("Latrunculia (Biannulata)", null, "Latrunculia", "Biannulata", null, null, null);<a name="line.1490"></a>
<span class="sourceLineNo">1491</span><a name="line.1491"></a>
<span class="sourceLineNo">1492</span>        assertParsedParts("Saperda (Saperda) candida m. bipunctata Breuning, 1952", null, NameType.SCIENTIFIC, "Saperda", "Saperda", "candida",<a name="line.1492"></a>
<span class="sourceLineNo">1493</span>                "bipunctata", "m.", null, "Breuning", "1952", null, null, null, null);<a name="line.1493"></a>
<span class="sourceLineNo">1494</span><a name="line.1494"></a>
<span class="sourceLineNo">1495</span>        assertParsedParts("Carex section Acrocystis", null, NameType.SCIENTIFIC, "Carex", "Acrocystis", null, null, "sect.", null, null, null, null, null, null, null);<a name="line.1495"></a>
<span class="sourceLineNo">1496</span><a name="line.1496"></a>
<span class="sourceLineNo">1497</span>        assertParsedParts("Juncus subgenus Alpini", null, NameType.SCIENTIFIC, "Juncus", "Alpini", null, null, "subgen.", null, null, null, null, null, null, null);<a name="line.1497"></a>
<span class="sourceLineNo">1498</span><a name="line.1498"></a>
<span class="sourceLineNo">1499</span>        assertParsedParts("Solidago subsection Triplinervae", null, NameType.SCIENTIFIC, "Solidago", "Triplinervae", null, null, "subsect.", null, null, null, null, null, null, null);<a name="line.1499"></a>
<span class="sourceLineNo">1500</span><a name="line.1500"></a>
<span class="sourceLineNo">1501</span>        assertParsedParts("Eleocharis series Maculosae", null, NameType.SCIENTIFIC, "Eleocharis", "Maculosae", null, null, "ser.", null, null, null, null, null, null, null);<a name="line.1501"></a>
<span class="sourceLineNo">1502</span><a name="line.1502"></a>
<span class="sourceLineNo">1503</span>        assertParsedParts("Hylaeus (Alfkenylaeus) Snelling, 1985", null, NameType.SCIENTIFIC, "Hylaeus", "Alfkenylaeus", null, null, null, null, "Snelling", "1985", null, null, null, null);<a name="line.1503"></a>
<span class="sourceLineNo">1504</span>    }<a name="line.1504"></a>
<span class="sourceLineNo">1505</span><a name="line.1505"></a>
<span class="sourceLineNo">1506</span>    @Test<a name="line.1506"></a>
<span class="sourceLineNo">1507</span>    public void testBlacklisted() throws Exception {<a name="line.1507"></a>
<span class="sourceLineNo">1508</span>        assertNoName("143");<a name="line.1508"></a>
<span class="sourceLineNo">1509</span>        assertNoName("321-432");<a name="line.1509"></a>
<span class="sourceLineNo">1510</span>        assertNoName("-,.#");<a name="line.1510"></a>
<span class="sourceLineNo">1511</span>        assertNoName("");<a name="line.1511"></a>
<span class="sourceLineNo">1512</span>        assertNoName(" ");<a name="line.1512"></a>
<span class="sourceLineNo">1513</span>        assertNoName(" .");<a name="line.1513"></a>
<span class="sourceLineNo">1514</span>    }<a name="line.1514"></a>
<span class="sourceLineNo">1515</span><a name="line.1515"></a>
<span class="sourceLineNo">1516</span>    @Test<a name="line.1516"></a>
<span class="sourceLineNo">1517</span>    public void testUnparsables() throws Exception {<a name="line.1517"></a>
<span class="sourceLineNo">1518</span>        assertUnparsableDoubtful("pilosa 1986 ?");<a name="line.1518"></a>
<span class="sourceLineNo">1519</span>        assertUnparsableDoubtful("H4N2 subtype");<a name="line.1519"></a>
<span class="sourceLineNo">1520</span>        assertUnparsableDoubtful("endosymbiont 'C3 71' of Calyptogena sp. JS, 2002");<a name="line.1520"></a>
<span class="sourceLineNo">1521</span>    }<a name="line.1521"></a>
<span class="sourceLineNo">1522</span><a name="line.1522"></a>
<span class="sourceLineNo">1523</span>    @Test<a name="line.1523"></a>
<span class="sourceLineNo">1524</span>    public void testBadAmpersands() throws Exception {<a name="line.1524"></a>
<span class="sourceLineNo">1525</span>        assertParsedParts("Salix taiwanalpina var. chingshuishanensis (S.S.Ying) F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; Y.H.Tseng ", null, "Salix", "taiwanalpina", "chingshuishanensis", "var.", "F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; Y.H.Tseng", null, "S.S.Ying", null);<a name="line.1525"></a>
<span class="sourceLineNo">1526</span>        assertParsedParts("Salix taiwanalpina var. chingshuishanensis (S.S.Ying) F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; amp  Y.H.Tseng ", null, "Salix", "taiwanalpina", "chingshuishanensis", "var.", "F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; Y.H.Tseng", null, "S.S.Ying", null);<a name="line.1526"></a>
<span class="sourceLineNo">1527</span>        assertParsedParts("Salix morrisonicola var. takasagoalpina (Koidz.) F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; amp; Y.H.Tseng", null, "Salix", "morrisonicola", "takasagoalpina", "var.", "F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; Y.H.Tseng", null, "Koidz.", null);<a name="line.1527"></a>
<span class="sourceLineNo">1528</span>        assertParsedParts("Ficus ernanii Carauta, Pederneir., P.P.Souza, A.F.P.Machado, M.D.M.Vianna &amp; amp; Romaniuc", "Ficus", "ernanii", null, null, "Carauta, Pederneir., P.P.Souza, A.F.P.Machado, M.D.M.Vianna &amp; Romaniuc");<a name="line.1528"></a>
<span class="sourceLineNo">1529</span>    }<a name="line.1529"></a>
<span class="sourceLineNo">1530</span><a name="line.1530"></a>
<span class="sourceLineNo">1531</span>    @Test<a name="line.1531"></a>
<span class="sourceLineNo">1532</span>    public void testCommonPlaceholders() throws Exception {<a name="line.1532"></a>
<span class="sourceLineNo">1533</span>        assertUnparsableType(NameType.PLACEHOLDER, "Salix taiwanalpina unassigned");<a name="line.1533"></a>
<span class="sourceLineNo">1534</span>        assertUnparsableType(NameType.PLACEHOLDER, "Salix taiwanalpina alpina UNKNOWN ");<a name="line.1534"></a>
<span class="sourceLineNo">1535</span>        assertUnparsableType(NameType.PLACEHOLDER, "unknown Plantanus");<a name="line.1535"></a>
<span class="sourceLineNo">1536</span>        assertUnparsableType(NameType.PLACEHOLDER, "Asteracea (awaiting allocation)");<a name="line.1536"></a>
<span class="sourceLineNo">1537</span>        assertUnparsableType(NameType.PLACEHOLDER, "Macrodasyida incertae sedis");<a name="line.1537"></a>
<span class="sourceLineNo">1538</span>        assertUnparsableType(NameType.PLACEHOLDER, " uncertain Plantanus");<a name="line.1538"></a>
<span class="sourceLineNo">1539</span>        assertUnparsableType(NameType.PLACEHOLDER, "Unknown Cyanobacteria");<a name="line.1539"></a>
<span class="sourceLineNo">1540</span>        assertUnparsableType(NameType.PLACEHOLDER, "Unknown methanomicrobium (strain EBac)");<a name="line.1540"></a>
<span class="sourceLineNo">1541</span>        assertUnparsableType(NameType.PLACEHOLDER, "Demospongiae incertae sedis");<a name="line.1541"></a>
<span class="sourceLineNo">1542</span>        assertUnparsableType(NameType.PLACEHOLDER, "Unallocated Demospongiae");<a name="line.1542"></a>
<span class="sourceLineNo">1543</span>    }<a name="line.1543"></a>
<span class="sourceLineNo">1544</span><a name="line.1544"></a>
<span class="sourceLineNo">1545</span>    @Test<a name="line.1545"></a>
<span class="sourceLineNo">1546</span>    public void testMissingSpeciesEpithet() throws Exception {<a name="line.1546"></a>
<span class="sourceLineNo">1547</span>        ParsedName pn = parser.parse("Navicula var. fasciata", null);<a name="line.1547"></a>
<span class="sourceLineNo">1548</span>        assertEquals("Navicula", pn.getGenusOrAbove());<a name="line.1548"></a>
<span class="sourceLineNo">1549</span>        assertEquals("fasciata", pn.getInfraSpecificEpithet());<a name="line.1549"></a>
<span class="sourceLineNo">1550</span>        assertEquals("var.", pn.getRankMarker());<a name="line.1550"></a>
<span class="sourceLineNo">1551</span>        assertNull(pn.getSpecificEpithet());<a name="line.1551"></a>
<span class="sourceLineNo">1552</span>    }<a name="line.1552"></a>
<span class="sourceLineNo">1553</span><a name="line.1553"></a>
<span class="sourceLineNo">1554</span>    @Test<a name="line.1554"></a>
<span class="sourceLineNo">1555</span>    public void testStringIndexOutOfBoundsException() throws Exception {<a name="line.1555"></a>
<span class="sourceLineNo">1556</span>        parser.parse("Amblyomma americanum (Linnaeus, 1758)", null);<a name="line.1556"></a>
<span class="sourceLineNo">1557</span>        parser.parse("Salix taiwanalpina var. chingshuishanensis (S.S.Ying) F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; Y.H.Tseng ", null);<a name="line.1557"></a>
<span class="sourceLineNo">1558</span>        parser.parse("Salix taiwanalpina var. chingshuishanensis (S.S.Ying) F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; amp  Y.H.Tseng ", null);<a name="line.1558"></a>
<span class="sourceLineNo">1559</span>        parser.parse("Salix morrisonicola var. takasagoalpina (Koidz.) F.Y.Lu, C.H.Ou, Y.C.Chen, Y.S.Chi, K.C.Lu &amp; amp; Y.H.Tseng", null);<a name="line.1559"></a>
<span class="sourceLineNo">1560</span>        parser.parse("Ficus ernanii Carauta, Pederneir., P.P.Souza, A.F.P.Machado, M.D.M.Vianna &amp; amp; Romaniuc", null);<a name="line.1560"></a>
<span class="sourceLineNo">1561</span>    }<a name="line.1561"></a>
<span class="sourceLineNo">1562</span><a name="line.1562"></a>
<span class="sourceLineNo">1563</span>    @Test<a name="line.1563"></a>
<span class="sourceLineNo">1564</span>    public void testNameType() throws Exception {<a name="line.1564"></a>
<span class="sourceLineNo">1565</span>        assertUnparsableType(NameType.HYBRID, "Asplenium rhizophyllum DC. x ruta-muraria E.L. Braun 1939");<a name="line.1565"></a>
<span class="sourceLineNo">1566</span>        assertUnparsableType(NameType.HYBRID, "Agrostis L. × Polypogon Desf. ");<a name="line.1566"></a>
<span class="sourceLineNo">1567</span><a name="line.1567"></a>
<span class="sourceLineNo">1568</span>        assertUnparsableType(NameType.VIRUS, "Cactus virus 2");<a name="line.1568"></a>
<span class="sourceLineNo">1569</span><a name="line.1569"></a>
<span class="sourceLineNo">1570</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("Neobisium carcinoides subsp. balcanicum Hadži, 1937", null).getType());<a name="line.1570"></a>
<span class="sourceLineNo">1571</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("Festulolium nilssonii Cugnac &amp; A. Camus", null).getType());<a name="line.1571"></a>
<span class="sourceLineNo">1572</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("Coccyzuz americanus", null).getType());<a name="line.1572"></a>
<span class="sourceLineNo">1573</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("Tavila indeterminata Walker, 1869", null).getType());<a name="line.1573"></a>
<span class="sourceLineNo">1574</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("Phyllodonta indeterminata Schaus, 1901", null).getType());<a name="line.1574"></a>
<span class="sourceLineNo">1575</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("×Festulolium nilssonii Cugnac &amp; A. Camus", null).getType());<a name="line.1575"></a>
<span class="sourceLineNo">1576</span><a name="line.1576"></a>
<span class="sourceLineNo">1577</span>        // not using the multiplication sign, but an simple x<a name="line.1577"></a>
<span class="sourceLineNo">1578</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("x Festulolium nilssonii Cugnac &amp; A. Camus", null).getType());<a name="line.1578"></a>
<span class="sourceLineNo">1579</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("xFestulolium nilssonii Cugnac &amp; A. Camus", null).getType());<a name="line.1579"></a>
<span class="sourceLineNo">1580</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("nuculoidea behrens subsp. behrens var.christoph", null).getType());<a name="line.1580"></a>
<span class="sourceLineNo">1581</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("Neobisium (Neobisium) carcinoides balcanicum Hadži 1937", null).getType());<a name="line.1581"></a>
<span class="sourceLineNo">1582</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("Neobisium carcinoides ssp. balcanicum Hadži, 1937", null).getType());<a name="line.1582"></a>
<span class="sourceLineNo">1583</span>        assertEquals(NameType.SCIENTIFIC,<a name="line.1583"></a>
<span class="sourceLineNo">1584</span>                parser.parse("Valsa hypodermia sensu Berkeley &amp; Broome (Not. Brit. Fungi no., 862)", null).getType());<a name="line.1584"></a>
<span class="sourceLineNo">1585</span>        assertEquals(NameType.SCIENTIFIC, parser.parse("Solanum aculeatissimum auct. not Jacq.", null).getType());<a name="line.1585"></a>
<span class="sourceLineNo">1586</span><a name="line.1586"></a>
<span class="sourceLineNo">1587</span>        assertEquals(NameType.INFORMAL, parser.parse("Coccyzuz cf americanus", null).getType());<a name="line.1587"></a>
<span class="sourceLineNo">1588</span>        assertEquals(NameType.INFORMAL, parser.parse("Coccyzuz americanus ssp.", null).getType());<a name="line.1588"></a>
<span class="sourceLineNo">1589</span>        assertEquals(NameType.INFORMAL, parser.parse("Asteraceae spec", null).getType());<a name="line.1589"></a>
<span class="sourceLineNo">1590</span><a name="line.1590"></a>
<span class="sourceLineNo">1591</span>        assertEquals(NameType.DOUBTFUL, parser.parse("Callitrichia pilosa (Jocqu¿ &amp; Scharff, 1986)", null).getType());<a name="line.1591"></a>
<span class="sourceLineNo">1592</span>        assertEquals(NameType.DOUBTFUL, parser.parse("Sinopoda exspectata J¿ger &amp; Ono, 2001", null).getType());<a name="line.1592"></a>
<span class="sourceLineNo">1593</span>        assertEquals(NameType.DOUBTFUL, parser.parse("Callitrichia pilosa 1986 ?", null).getType());<a name="line.1593"></a>
<span class="sourceLineNo">1594</span>        assertEquals(NameType.DOUBTFUL,<a name="line.1594"></a>
<span class="sourceLineNo">1595</span>                parser.parse("Scaphytopius acutus delongi Young, 1952c:, 248 [n.sp. , not nom. nov.]", null).getType());<a name="line.1595"></a>
<span class="sourceLineNo">1596</span><a name="line.1596"></a>
<span class="sourceLineNo">1597</span>    }<a name="line.1597"></a>
<span class="sourceLineNo">1598</span><a name="line.1598"></a>
<span class="sourceLineNo">1599</span>    @Test<a name="line.1599"></a>
<span class="sourceLineNo">1600</span>    public void testLowerCaseMonomials() throws Exception {<a name="line.1600"></a>
<span class="sourceLineNo">1601</span>        assertUnparsableDoubtful("tree");<a name="line.1601"></a>
<span class="sourceLineNo">1602</span>        assertUnparsableDoubtful(" tree");<a name="line.1602"></a>
<span class="sourceLineNo">1603</span>        assertUnparsableDoubtful("tim");<a name="line.1603"></a>
<span class="sourceLineNo">1604</span>        assertUnparsableDoubtful("abies");<a name="line.1604"></a>
<span class="sourceLineNo">1605</span>        assertUnparsableDoubtful("abies (Thats it)");<a name="line.1605"></a>
<span class="sourceLineNo">1606</span>    }<a name="line.1606"></a>
<span class="sourceLineNo">1607</span><a name="line.1607"></a>
<span class="sourceLineNo">1608</span>    @Test<a name="line.1608"></a>
<span class="sourceLineNo">1609</span>    public void testSensuParsing() throws Exception {<a name="line.1609"></a>
<span class="sourceLineNo">1610</span>        assertEquals("sensu Baker f.", parser.parse("Trifolium repens sensu Baker f.", null).getSensu());<a name="line.1610"></a>
<span class="sourceLineNo">1611</span>        assertEquals("sensu latu", parser.parse("Achillea millefolium sensu latu", null).getSensu());<a name="line.1611"></a>
<span class="sourceLineNo">1612</span>        assertEquals("sec. Greuter, 2009", parser.parse("Achillea millefolium sec. Greuter 2009", null).getSensu());<a name="line.1612"></a>
<span class="sourceLineNo">1613</span>    }<a name="line.1613"></a>
<span class="sourceLineNo">1614</span><a name="line.1614"></a>
<span class="sourceLineNo">1615</span>    @Test<a name="line.1615"></a>
<span class="sourceLineNo">1616</span>    public void testNomenclaturalNotesPattern() throws Exception {<a name="line.1616"></a>
<span class="sourceLineNo">1617</span>        assertEquals("nom. illeg.", extractNomNote("Vaucheria longicaulis var. bengalensis Islam, nom. illeg."));<a name="line.1617"></a>
<span class="sourceLineNo">1618</span>        assertEquals("nom. correct", extractNomNote("Dorataspidae nom. correct"));<a name="line.1618"></a>
<span class="sourceLineNo">1619</span>        assertEquals("nom. transf.", extractNomNote("Ethmosphaeridae nom. transf."));<a name="line.1619"></a>
<span class="sourceLineNo">1620</span>        assertEquals("nom. ambig.", extractNomNote("Fucus ramosissimus Oeder, nom. ambig."));<a name="line.1620"></a>
<span class="sourceLineNo">1621</span>        assertEquals("nom. nov.", extractNomNote("Myrionema majus Foslie, nom. nov."));<a name="line.1621"></a>
<span class="sourceLineNo">1622</span>        assertEquals("nom. utique rej.", extractNomNote("Corydalis bulbosa (L.) DC., nom. utique rej."));<a name="line.1622"></a>
<span class="sourceLineNo">1623</span>        assertEquals("nom. cons. prop.", extractNomNote("Anthoceros agrestis var. agrestis Paton nom. cons. prop."));<a name="line.1623"></a>
<span class="sourceLineNo">1624</span>        assertEquals("nom. superfl.",<a name="line.1624"></a>
<span class="sourceLineNo">1625</span>                extractNomNote("Lithothamnion glaciale forma verrucosum (Foslie) Foslie, nom. superfl."));<a name="line.1625"></a>
<span class="sourceLineNo">1626</span>        assertEquals("nom.rejic.",<a name="line.1626"></a>
<span class="sourceLineNo">1627</span>                extractNomNote("Pithecellobium montanum var. subfalcatum (Zoll. &amp; Moritzi)Miq., nom.rejic."));<a name="line.1627"></a>
<span class="sourceLineNo">1628</span>        assertEquals("nom. inval",<a name="line.1628"></a>
<span class="sourceLineNo">1629</span>                extractNomNote("Fucus vesiculosus forma volubilis (Goodenough &amp; Woodward) H.T. Powell, nom. inval"));<a name="line.1629"></a>
<span class="sourceLineNo">1630</span>        assertEquals("nom. nud.", extractNomNote("Sao hispanica R. &amp; E. Richter nom. nud. in Sampelayo 1935"));<a name="line.1630"></a>
<span class="sourceLineNo">1631</span>        assertEquals("nom.illeg.", extractNomNote("Hallo (nom.illeg.)"));<a name="line.1631"></a>
<span class="sourceLineNo">1632</span>        assertEquals("nom. super.", extractNomNote("Calamagrostis cinnoides W. Bart. nom. super."));<a name="line.1632"></a>
<span class="sourceLineNo">1633</span>        assertEquals("nom. nud.", extractNomNote("Iridaea undulosa var. papillosa Bory de Saint-Vincent, nom. nud."));<a name="line.1633"></a>
<span class="sourceLineNo">1634</span>        assertEquals("nom. inval",<a name="line.1634"></a>
<span class="sourceLineNo">1635</span>                extractNomNote("Sargassum angustifolium forma filiforme V. Krishnamurthy &amp; H. Joshi, nom. inval"));<a name="line.1635"></a>
<span class="sourceLineNo">1636</span>        assertEquals("nomen nudum", extractNomNote("Solanum bifidum Vell. ex Dunal, nomen nudum"));<a name="line.1636"></a>
<span class="sourceLineNo">1637</span>        assertEquals("nomen invalid.",<a name="line.1637"></a>
<span class="sourceLineNo">1638</span>                extractNomNote("Schoenoplectus ×scheuchzeri (Bruegger) Palla ex Janchen, nomen invalid."));<a name="line.1638"></a>
<span class="sourceLineNo">1639</span>        assertEquals("nom. nud.",<a name="line.1639"></a>
<span class="sourceLineNo">1640</span>                extractNomNote("Cryptomys \"Kasama\" Kawalika et al., 2001, nom. nud. (Kasama, Zambia) ."));<a name="line.1640"></a>
<span class="sourceLineNo">1641</span>        assertEquals("nom. super.", extractNomNote("Calamagrostis cinnoides W. Bart. nom. super."));<a name="line.1641"></a>
<span class="sourceLineNo">1642</span>        assertEquals("nom. dub.", extractNomNote("Pandanus odorifer (Forssk.) Kuntze, nom. dub."));<a name="line.1642"></a>
<span class="sourceLineNo">1643</span>        assertEquals("nom. rejic.", extractNomNote("non Clarisia Abat, 1792, nom. rejic."));<a name="line.1643"></a>
<span class="sourceLineNo">1644</span>        assertEquals("nom. cons", extractNomNote(<a name="line.1644"></a>
<span class="sourceLineNo">1645</span>                "Yersinia pestis (Lehmann and Neumann, 1896) van Loghem, 1944 (Approved Lists, 1980) , nom. cons"));<a name="line.1645"></a>
<span class="sourceLineNo">1646</span>        assertEquals("nom. rejic.",<a name="line.1646"></a>
<span class="sourceLineNo">1647</span>                extractNomNote("\"Pseudomonas denitrificans\" (Christensen, 1903) Bergey et al., 1923, nom. rejic."));<a name="line.1647"></a>
<span class="sourceLineNo">1648</span>        assertEquals("nom. nov.", extractNomNote("Tipula rubiginosa Loew, 1863, nom. nov."));<a name="line.1648"></a>
<span class="sourceLineNo">1649</span>        assertEquals("nom. prov.", extractNomNote("Amanita pruittii A.H.Sm. ex Tulloss &amp; J.Lindgr., nom. prov."));<a name="line.1649"></a>
<span class="sourceLineNo">1650</span>        assertEquals("nom. cons.", extractNomNote("Ramonda Rich., nom. cons."));<a name="line.1650"></a>
<span class="sourceLineNo">1651</span>        assertEquals("nom. cons.", extractNomNote(<a name="line.1651"></a>
<span class="sourceLineNo">1652</span>                "Kluyver and van Niel, 1936 emend. Barker, 1956 (Approved Lists, 1980) , nom. cons., emend. Mah and Kuhn, 1984"));<a name="line.1652"></a>
<span class="sourceLineNo">1653</span>        assertEquals("nom. superfl.", extractNomNote("Coccocypselum tontanea (Aubl.) Kunth, nom. superfl."));<a name="line.1653"></a>
<span class="sourceLineNo">1654</span>        assertEquals("nom. ambig.", extractNomNote("Lespedeza bicolor var. intermedia Maxim. , nom. ambig."));<a name="line.1654"></a>
<span class="sourceLineNo">1655</span>        assertEquals("nom. praeoccup.", extractNomNote("Erebia aethiops uralensis Goltz, 1930 nom. praeoccup."));<a name="line.1655"></a>
<span class="sourceLineNo">1656</span><a name="line.1656"></a>
<span class="sourceLineNo">1657</span>        assertEquals("comb. nov. ined.", extractNomNote("Ipomopsis tridactyla (Rydb.) Wilken, comb. nov. ined."));<a name="line.1657"></a>
<span class="sourceLineNo">1658</span>        assertEquals("sp. nov. ined.", extractNomNote("Orobanche riparia Collins, sp. nov. ined."));<a name="line.1658"></a>
<span class="sourceLineNo">1659</span>        assertEquals("gen. nov.", extractNomNote("Anchimolgidae gen. nov. New Caledonia-Rjh-, 2004"));<a name="line.1659"></a>
<span class="sourceLineNo">1660</span>        assertEquals("gen. nov. ined.", extractNomNote("Stebbinsoseris gen. nov. ined."));<a name="line.1660"></a>
<span class="sourceLineNo">1661</span>        assertEquals("var. nov.", extractNomNote("Euphorbia rossiana var. nov. Steinmann, 1199"));<a name="line.1661"></a>
<span class="sourceLineNo">1662</span><a name="line.1662"></a>
<span class="sourceLineNo">1663</span>    }<a name="line.1663"></a>
<span class="sourceLineNo">1664</span><a name="line.1664"></a>
<span class="sourceLineNo">1665</span>    /**<a name="line.1665"></a>
<span class="sourceLineNo">1666</span>     * http://dev.gbif.org/issues/browse/POR-2508<a name="line.1666"></a>
<span class="sourceLineNo">1667</span>     */<a name="line.1667"></a>
<span class="sourceLineNo">1668</span>    @Test<a name="line.1668"></a>
<span class="sourceLineNo">1669</span>    public void testNovNames() throws Exception {<a name="line.1669"></a>
<span class="sourceLineNo">1670</span><a name="line.1670"></a>
<span class="sourceLineNo">1671</span>        ParsedName pn = parser.parse("Euphorbia rossiana var. nov. Steinmann, 1899", null);<a name="line.1671"></a>
<span class="sourceLineNo">1672</span>        assertEquals("Euphorbia", pn.getGenusOrAbove());<a name="line.1672"></a>
<span class="sourceLineNo">1673</span>        assertEquals("rossiana", pn.getSpecificEpithet());<a name="line.1673"></a>
<span class="sourceLineNo">1674</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.1674"></a>
<span class="sourceLineNo">1675</span>        assertEquals("Steinmann", pn.getAuthorship());<a name="line.1675"></a>
<span class="sourceLineNo">1676</span>        assertEquals("1899", pn.getYear());<a name="line.1676"></a>
<span class="sourceLineNo">1677</span>        assertEquals("var. nov.", pn.getNomStatus());<a name="line.1677"></a>
<span class="sourceLineNo">1678</span>        assertEquals("var.", pn.getRankMarker());<a name="line.1678"></a>
<span class="sourceLineNo">1679</span><a name="line.1679"></a>
<span class="sourceLineNo">1680</span>        pn = parser.parse("Ipomopsis tridactyla (Rydb.) Wilken, comb. nov. ined.", null);<a name="line.1680"></a>
<span class="sourceLineNo">1681</span>        assertEquals("Ipomopsis", pn.getGenusOrAbove());<a name="line.1681"></a>
<span class="sourceLineNo">1682</span>        assertEquals("tridactyla", pn.getSpecificEpithet());<a name="line.1682"></a>
<span class="sourceLineNo">1683</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.1683"></a>
<span class="sourceLineNo">1684</span>        assertEquals("Rydb.", pn.getBracketAuthorship());<a name="line.1684"></a>
<span class="sourceLineNo">1685</span>        assertEquals("Wilken", pn.getAuthorship());<a name="line.1685"></a>
<span class="sourceLineNo">1686</span>        assertNull(pn.getYear());<a name="line.1686"></a>
<span class="sourceLineNo">1687</span>        assertEquals("comb. nov. ined.", pn.getNomStatus());<a name="line.1687"></a>
<span class="sourceLineNo">1688</span><a name="line.1688"></a>
<span class="sourceLineNo">1689</span>        pn = parser.parse("Orobanche riparia Collins, sp. nov. ined.", null);<a name="line.1689"></a>
<span class="sourceLineNo">1690</span>        assertEquals("Orobanche", pn.getGenusOrAbove());<a name="line.1690"></a>
<span class="sourceLineNo">1691</span>        assertEquals("riparia", pn.getSpecificEpithet());<a name="line.1691"></a>
<span class="sourceLineNo">1692</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.1692"></a>
<span class="sourceLineNo">1693</span>        assertEquals("Collins", pn.getAuthorship());<a name="line.1693"></a>
<span class="sourceLineNo">1694</span>        assertNull(pn.getYear());<a name="line.1694"></a>
<span class="sourceLineNo">1695</span>        assertEquals("sp.", pn.getRankMarker());<a name="line.1695"></a>
<span class="sourceLineNo">1696</span>        assertEquals("sp. nov. ined.", pn.getNomStatus());<a name="line.1696"></a>
<span class="sourceLineNo">1697</span><a name="line.1697"></a>
<span class="sourceLineNo">1698</span>        pn = parser.parse("Stebbinsoseris gen. nov.", null);<a name="line.1698"></a>
<span class="sourceLineNo">1699</span>        assertEquals("Stebbinsoseris", pn.getGenusOrAbove());<a name="line.1699"></a>
<span class="sourceLineNo">1700</span>        assertNull(pn.getSpecificEpithet());<a name="line.1700"></a>
<span class="sourceLineNo">1701</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.1701"></a>
<span class="sourceLineNo">1702</span>        assertNull(pn.getAuthorship());<a name="line.1702"></a>
<span class="sourceLineNo">1703</span>        assertNull(pn.getYear());<a name="line.1703"></a>
<span class="sourceLineNo">1704</span>        assertEquals("gen.", pn.getRankMarker());<a name="line.1704"></a>
<span class="sourceLineNo">1705</span>        assertEquals("gen. nov.", pn.getNomStatus());<a name="line.1705"></a>
<span class="sourceLineNo">1706</span><a name="line.1706"></a>
<span class="sourceLineNo">1707</span>        pn = parser.parse("Astelia alpina var. novae-hollandiae", null);<a name="line.1707"></a>
<span class="sourceLineNo">1708</span>        assertEquals("Astelia", pn.getGenusOrAbove());<a name="line.1708"></a>
<span class="sourceLineNo">1709</span>        assertEquals("alpina", pn.getSpecificEpithet());<a name="line.1709"></a>
<span class="sourceLineNo">1710</span>        assertEquals("novae-hollandiae", pn.getInfraSpecificEpithet());<a name="line.1710"></a>
<span class="sourceLineNo">1711</span>        assertNull(pn.getAuthorship());<a name="line.1711"></a>
<span class="sourceLineNo">1712</span>        assertNull(pn.getYear());<a name="line.1712"></a>
<span class="sourceLineNo">1713</span>        assertEquals("var.", pn.getRankMarker());<a name="line.1713"></a>
<span class="sourceLineNo">1714</span>        assertNull(pn.getNomStatus());<a name="line.1714"></a>
<span class="sourceLineNo">1715</span><a name="line.1715"></a>
<span class="sourceLineNo">1716</span>        pn = parser.parse("Astelia alpina var. november ", null);<a name="line.1716"></a>
<span class="sourceLineNo">1717</span>        assertEquals("Astelia", pn.getGenusOrAbove());<a name="line.1717"></a>
<span class="sourceLineNo">1718</span>        assertEquals("alpina", pn.getSpecificEpithet());<a name="line.1718"></a>
<span class="sourceLineNo">1719</span>        assertEquals("november", pn.getInfraSpecificEpithet());<a name="line.1719"></a>
<span class="sourceLineNo">1720</span>        assertNull(pn.getAuthorship());<a name="line.1720"></a>
<span class="sourceLineNo">1721</span>        assertNull(pn.getYear());<a name="line.1721"></a>
<span class="sourceLineNo">1722</span>        assertEquals("var.", pn.getRankMarker());<a name="line.1722"></a>
<span class="sourceLineNo">1723</span>        assertNull(pn.getNomStatus());<a name="line.1723"></a>
<span class="sourceLineNo">1724</span><a name="line.1724"></a>
<span class="sourceLineNo">1725</span>        pn = parser.parse("Astelia alpina subsp. november ", null);<a name="line.1725"></a>
<span class="sourceLineNo">1726</span>        assertEquals("Astelia", pn.getGenusOrAbove());<a name="line.1726"></a>
<span class="sourceLineNo">1727</span>        assertEquals("alpina", pn.getSpecificEpithet());<a name="line.1727"></a>
<span class="sourceLineNo">1728</span>        assertEquals("november", pn.getInfraSpecificEpithet());<a name="line.1728"></a>
<span class="sourceLineNo">1729</span>        assertNull(pn.getAuthorship());<a name="line.1729"></a>
<span class="sourceLineNo">1730</span>        assertNull(pn.getYear());<a name="line.1730"></a>
<span class="sourceLineNo">1731</span>        assertEquals("subsp.", pn.getRankMarker());<a name="line.1731"></a>
<span class="sourceLineNo">1732</span>        assertNull(pn.getNomStatus());<a name="line.1732"></a>
<span class="sourceLineNo">1733</span><a name="line.1733"></a>
<span class="sourceLineNo">1734</span>        pn = parser.parse("Astelia alpina november ", null);<a name="line.1734"></a>
<span class="sourceLineNo">1735</span>        assertEquals("Astelia", pn.getGenusOrAbove());<a name="line.1735"></a>
<span class="sourceLineNo">1736</span>        assertEquals("alpina", pn.getSpecificEpithet());<a name="line.1736"></a>
<span class="sourceLineNo">1737</span>        assertEquals("november", pn.getInfraSpecificEpithet());<a name="line.1737"></a>
<span class="sourceLineNo">1738</span>        assertNull(pn.getAuthorship());<a name="line.1738"></a>
<span class="sourceLineNo">1739</span>        assertNull(pn.getYear());<a name="line.1739"></a>
<span class="sourceLineNo">1740</span>        assertNull(pn.getRankMarker());<a name="line.1740"></a>
<span class="sourceLineNo">1741</span>        assertNull(pn.getNomStatus());<a name="line.1741"></a>
<span class="sourceLineNo">1742</span><a name="line.1742"></a>
<span class="sourceLineNo">1743</span>        pn = parser.parse("Myrionema majus Foslie, nom. nov.", null);<a name="line.1743"></a>
<span class="sourceLineNo">1744</span>        assertEquals("Myrionema", pn.getGenusOrAbove());<a name="line.1744"></a>
<span class="sourceLineNo">1745</span>        assertEquals("majus", pn.getSpecificEpithet());<a name="line.1745"></a>
<span class="sourceLineNo">1746</span>        assertNull(pn.getInfraSpecificEpithet());<a name="line.1746"></a>
<span class="sourceLineNo">1747</span>        assertEquals("Foslie", pn.getAuthorship());<a name="line.1747"></a>
<span class="sourceLineNo">1748</span>        assertNull(pn.getYear());<a name="line.1748"></a>
<span class="sourceLineNo">1749</span>        assertNull(pn.getRankMarker());<a name="line.1749"></a>
<span class="sourceLineNo">1750</span>        assertEquals("nom. nov.", pn.getNomStatus());<a name="line.1750"></a>
<span class="sourceLineNo">1751</span><a name="line.1751"></a>
<span class="sourceLineNo">1752</span>    }<a name="line.1752"></a>
<span class="sourceLineNo">1753</span><a name="line.1753"></a>
<span class="sourceLineNo">1754</span>    @Test<a name="line.1754"></a>
<span class="sourceLineNo">1755</span>    public void testNormalizeName() {<a name="line.1755"></a>
<span class="sourceLineNo">1756</span>        assertEquals("Nuculoidea Williams et Breger, 1916", NameParser.normalize("Nuculoidea Williams et  Breger 1916  "));<a name="line.1756"></a>
<span class="sourceLineNo">1757</span>        assertEquals("Nuculoidea behrens var. christoph Williams &amp; Breger [1916]",<a name="line.1757"></a>
<span class="sourceLineNo">1758</span>                NameParser.normalize("Nuculoidea behrens var.christoph Williams &amp; Breger [1916]  "));<a name="line.1758"></a>
<span class="sourceLineNo">1759</span>        assertEquals("Nuculoidea behrens var. christoph Williams &amp; Breger [1916]",<a name="line.1759"></a>
<span class="sourceLineNo">1760</span>                NameParser.normalize("Nuculoidea behrens var.christoph Williams &amp; Breger [1916]  "));<a name="line.1760"></a>
<span class="sourceLineNo">1761</span>        assertEquals(NameParser.normalize("Nuculoidea Williams &amp; Breger, 1916  "),<a name="line.1761"></a>
<span class="sourceLineNo">1762</span>                NameParser.normalize("Nuculoidea   Williams&amp; Breger, 1916"));<a name="line.1762"></a>
<span class="sourceLineNo">1763</span>        assertEquals("Asplenium ×inexpectatum (E.L. Braun, 1940) Morton (1956)",<a name="line.1763"></a>
<span class="sourceLineNo">1764</span>                NameParser.normalize("Asplenium X inexpectatum (E.L. Braun 1940)Morton (1956) "));<a name="line.1764"></a>
<span class="sourceLineNo">1765</span>        assertEquals("×Agropogon", NameParser.normalize(" × Agropogon"));<a name="line.1765"></a>
<span class="sourceLineNo">1766</span>        assertEquals("Salix ×capreola Andersson", NameParser.normalize("Salix × capreola Andersson"));<a name="line.1766"></a>
<span class="sourceLineNo">1767</span>        assertEquals("Leucanitis roda Herrich-Schäffer (1851), 1845",<a name="line.1767"></a>
<span class="sourceLineNo">1768</span>                NameParser.normalize("Leucanitis roda Herrich-Schäffer (1851) 1845"));<a name="line.1768"></a>
<span class="sourceLineNo">1769</span><a name="line.1769"></a>
<span class="sourceLineNo">1770</span>        assertEquals("Huaiyuanella Xing, Yan &amp; Yin, 1984", NameParser.normalize("Huaiyuanella Xing, Yan&amp;Yin, 1984"));<a name="line.1770"></a>
<span class="sourceLineNo">1771</span><a name="line.1771"></a>
<span class="sourceLineNo">1772</span>    }<a name="line.1772"></a>
<span class="sourceLineNo">1773</span><a name="line.1773"></a>
<span class="sourceLineNo">1774</span>    @Test<a name="line.1774"></a>
<span class="sourceLineNo">1775</span>    public void testNormalizeStrongName() {<a name="line.1775"></a>
<span class="sourceLineNo">1776</span>        assertEquals("Nuculoidea Williams &amp; Breger, 1916",<a name="line.1776"></a>
<span class="sourceLineNo">1777</span>                NameParser.normalizeStrong("Nuculoidea Williams et  Breger 1916  "));<a name="line.1777"></a>
<span class="sourceLineNo">1778</span>        assertEquals("Nuculoidea behrens var. christoph Williams &amp; Breger, 1916",<a name="line.1778"></a>
<span class="sourceLineNo">1779</span>                NameParser.normalizeStrong("Nuculoidea behrens var.christoph Williams &amp; Breger [1916]  "));<a name="line.1779"></a>
<span class="sourceLineNo">1780</span>        assertEquals("N. behrens Williams &amp; Breger, 1916",<a name="line.1780"></a>
<span class="sourceLineNo">1781</span>                NameParser.normalizeStrong("  N.behrens Williams &amp;amp;  Breger , 1916  "));<a name="line.1781"></a>
<span class="sourceLineNo">1782</span>        assertEquals("Nuculoidea Williams &amp; Breger, 1916",<a name="line.1782"></a>
<span class="sourceLineNo">1783</span>                NameParser.normalizeStrong(" 'Nuculoidea Williams &amp; Breger, 1916'"));<a name="line.1783"></a>
<span class="sourceLineNo">1784</span>        assertEquals("Malacocarpus schumannianus (Nicolai, 1893) Britton &amp; Rose",<a name="line.1784"></a>
<span class="sourceLineNo">1785</span>                NameParser.normalizeStrong("Malacocarpus schumannianus (Nicolai (1893)) Britton &amp; Rose"));<a name="line.1785"></a>
<span class="sourceLineNo">1786</span>        assertEquals("Photina (Cardioptera) burmeisteri (Westwood, 1889)",<a name="line.1786"></a>
<span class="sourceLineNo">1787</span>                NameParser.normalizeStrong("Photina Cardioptera burmeisteri (Westwood 1889)"));<a name="line.1787"></a>
<span class="sourceLineNo">1788</span>        assertEquals("Suaeda forsskahlei Schweinf.",<a name="line.1788"></a>
<span class="sourceLineNo">1789</span>                NameParser.normalizeStrong("Suaeda forsskahlei Schweinf. ms."));<a name="line.1789"></a>
<span class="sourceLineNo">1790</span>        assertEquals("Acacia bicolor Bojer", NameParser.normalizeStrong("Acacia bicolor Bojer ms."));<a name="line.1790"></a>
<span class="sourceLineNo">1791</span>        assertEquals("Leucanitis roda (Herrich-Schäffer, 1851), 1845",<a name="line.1791"></a>
<span class="sourceLineNo">1792</span>                NameParser.normalizeStrong("Leucanitis roda Herrich-Schäffer (1851) 1845"));<a name="line.1792"></a>
<span class="sourceLineNo">1793</span>        assertEquals("Astelia alpina var. novae-hollandiae",<a name="line.1793"></a>
<span class="sourceLineNo">1794</span>                NameParser.normalizeStrong("Astelia alpina var. novae-hollandiae"));<a name="line.1794"></a>
<span class="sourceLineNo">1795</span><a name="line.1795"></a>
<span class="sourceLineNo">1796</span>    }<a name="line.1796"></a>
<span class="sourceLineNo">1797</span><a name="line.1797"></a>
<span class="sourceLineNo">1798</span>    @Test<a name="line.1798"></a>
<span class="sourceLineNo">1799</span>    public void testOccNameFile() throws Exception {<a name="line.1799"></a>
<span class="sourceLineNo">1800</span>        Reader reader = FileUtils.getInputStreamReader(streamUtils.classpathStream("parseNull.txt"));<a name="line.1800"></a>
<span class="sourceLineNo">1801</span>        LineIterator iter = new LineIterator(reader);<a name="line.1801"></a>
<span class="sourceLineNo">1802</span><a name="line.1802"></a>
<span class="sourceLineNo">1803</span>        int parseFails = 0;<a name="line.1803"></a>
<span class="sourceLineNo">1804</span>        int parseAuthorless = 0;<a name="line.1804"></a>
<span class="sourceLineNo">1805</span>        int lineNum = 0;<a name="line.1805"></a>
<span class="sourceLineNo">1806</span>        long start = System.currentTimeMillis();<a name="line.1806"></a>
<span class="sourceLineNo">1807</span><a name="line.1807"></a>
<span class="sourceLineNo">1808</span>        while (iter.hasNext()) {<a name="line.1808"></a>
<span class="sourceLineNo">1809</span>            lineNum++;<a name="line.1809"></a>
<span class="sourceLineNo">1810</span>            String name = iter.nextLine();<a name="line.1810"></a>
<span class="sourceLineNo">1811</span>            ParsedName n;<a name="line.1811"></a>
<span class="sourceLineNo">1812</span>            try {<a name="line.1812"></a>
<span class="sourceLineNo">1813</span>                n = parser.parse(name, null);<a name="line.1813"></a>
<span class="sourceLineNo">1814</span>                if (!n.isAuthorsParsed()) {<a name="line.1814"></a>
<span class="sourceLineNo">1815</span>                    parseAuthorless++;<a name="line.1815"></a>
<span class="sourceLineNo">1816</span>                    LOG.warn("NO AUTHORS\t " + name);<a name="line.1816"></a>
<span class="sourceLineNo">1817</span>                }<a name="line.1817"></a>
<span class="sourceLineNo">1818</span>            } catch (UnparsableException e) {<a name="line.1818"></a>
<span class="sourceLineNo">1819</span>                parseFails++;<a name="line.1819"></a>
<span class="sourceLineNo">1820</span>                LOG.warn("FAIL\t " + name);<a name="line.1820"></a>
<span class="sourceLineNo">1821</span>            }<a name="line.1821"></a>
<span class="sourceLineNo">1822</span>        }<a name="line.1822"></a>
<span class="sourceLineNo">1823</span>        long end = System.currentTimeMillis();<a name="line.1823"></a>
<span class="sourceLineNo">1824</span>        LOG.info("\n\nNames tested: " + lineNum);<a name="line.1824"></a>
<span class="sourceLineNo">1825</span>        LOG.info("Names parse fail: " + parseFails);<a name="line.1825"></a>
<span class="sourceLineNo">1826</span>        LOG.info("Names parse no authors: " + parseAuthorless);<a name="line.1826"></a>
<span class="sourceLineNo">1827</span>        LOG.info("Total time: " + (end - start));<a name="line.1827"></a>
<span class="sourceLineNo">1828</span>        LOG.info("Average per name: " + (((double) end - start) / lineNum));<a name="line.1828"></a>
<span class="sourceLineNo">1829</span><a name="line.1829"></a>
<span class="sourceLineNo">1830</span>        int currFail = 2;<a name="line.1830"></a>
<span class="sourceLineNo">1831</span>        if ((parseFails) &gt; currFail) {<a name="line.1831"></a>
<span class="sourceLineNo">1832</span>            fail("We are getting worse, not better. Currently failing: " + (parseFails) + ". Was passing:" + currFail);<a name="line.1832"></a>
<span class="sourceLineNo">1833</span>        }<a name="line.1833"></a>
<span class="sourceLineNo">1834</span>        int currNoAuthors = 109;<a name="line.1834"></a>
<span class="sourceLineNo">1835</span>        if ((parseAuthorless) &gt; currNoAuthors) {<a name="line.1835"></a>
<span class="sourceLineNo">1836</span>            fail(<a name="line.1836"></a>
<span class="sourceLineNo">1837</span>                    "We are getting worse, not better. Currently without authors: " + (parseAuthorless) + ". Was:" + currNoAuthors);<a name="line.1837"></a>
<span class="sourceLineNo">1838</span>        }<a name="line.1838"></a>
<span class="sourceLineNo">1839</span>    }<a name="line.1839"></a>
<span class="sourceLineNo">1840</span><a name="line.1840"></a>
<span class="sourceLineNo">1841</span>    @Test<a name="line.1841"></a>
<span class="sourceLineNo">1842</span>    public void testPeterDesmetNPE() throws Exception {<a name="line.1842"></a>
<span class="sourceLineNo">1843</span>        ParsedName n = null;<a name="line.1843"></a>
<span class="sourceLineNo">1844</span>        boolean parsed = false;<a name="line.1844"></a>
<span class="sourceLineNo">1845</span>        try {<a name="line.1845"></a>
<span class="sourceLineNo">1846</span>            n = parser.parse("(1-SFS) Aster lowrieanus Porter", null);<a name="line.1846"></a>
<span class="sourceLineNo">1847</span>            parsed = true;<a name="line.1847"></a>
<span class="sourceLineNo">1848</span>        } catch (UnparsableException e) {<a name="line.1848"></a>
<span class="sourceLineNo">1849</span>            // nothing, expected to fail<a name="line.1849"></a>
<span class="sourceLineNo">1850</span>        }<a name="line.1850"></a>
<span class="sourceLineNo">1851</span>        try {<a name="line.1851"></a>
<span class="sourceLineNo">1852</span>            n = parser.parse("(1-SFS)%20Aster%20lowrieanus%20Porter", null);<a name="line.1852"></a>
<span class="sourceLineNo">1853</span>            parsed = true;<a name="line.1853"></a>
<span class="sourceLineNo">1854</span>        } catch (UnparsableException e) {<a name="line.1854"></a>
<span class="sourceLineNo">1855</span>            // nothing, expected to fail<a name="line.1855"></a>
<span class="sourceLineNo">1856</span>        }<a name="line.1856"></a>
<span class="sourceLineNo">1857</span>    }<a name="line.1857"></a>
<span class="sourceLineNo">1858</span><a name="line.1858"></a>
<span class="sourceLineNo">1859</span>    /**<a name="line.1859"></a>
<span class="sourceLineNo">1860</span>     * These names have been parsing extremely slowely before.<a name="line.1860"></a>
<span class="sourceLineNo">1861</span>     * Verify all these names parse correctly before reaching a parsing timeout.<a name="line.1861"></a>
<span class="sourceLineNo">1862</span>     */<a name="line.1862"></a>
<span class="sourceLineNo">1863</span>    @Test<a name="line.1863"></a>
<span class="sourceLineNo">1864</span>    public void testSlowNames() throws Exception {<a name="line.1864"></a>
<span class="sourceLineNo">1865</span>        assertParsedParts("\"Acetobacter aceti var. muciparum\" (sic) (Hoyer) Frateur, 1950", "Acetobacter", "aceti", "muciparum", "var.");<a name="line.1865"></a>
<span class="sourceLineNo">1866</span>        assertParsedParts("\"Acetobacter melanogenum (sic) var. malto-saccharovorans\" Frateur, 1950", "Acetobacter", "melanogenum", "malto-saccharovorans", "var.");<a name="line.1866"></a>
<span class="sourceLineNo">1867</span>        assertParsedParts("\"Acetobacter melanogenum (sic) var. maltovorans\" Frateur, 1950", "Acetobacter", "melanogenum", "maltovorans", "var.");<a name="line.1867"></a>
<span class="sourceLineNo">1868</span>        assertParsedParts("'Abelmoschus esculentus' bunchy top phytoplasma", "Abelmoschus", "esculentus", null, null);<a name="line.1868"></a>
<span class="sourceLineNo">1869</span>        assertParsedParts("Argyropelecus d'Urvillei Valenciennes, 1849", "Argyropelecus", null, null, null, "d'Urvillei Valenciennes", "1849");<a name="line.1869"></a>
<span class="sourceLineNo">1870</span>        assertParsedParts("Batillipes africanus Morone De Lucia, D'Addabbo Gallo and Grimaldi de Zio, 1988", "Batillipes", "africanus", null, null, "Morone De Lucia, D'Addabbo Gallo &amp; Grimaldi de Zio", "1988");<a name="line.1870"></a>
<span class="sourceLineNo">1871</span>        assertParsedParts("Abrotanellinae H.Rob., G.D.Carr, R.M.King &amp; A.M.Powell", "Abrotanellinae", null, null, null, "H.Rob., G.D.Carr, R.M.King &amp; A.M.Powell");<a name="line.1871"></a>
<span class="sourceLineNo">1872</span>        assertParsedParts("Acidomyces B.J. Baker, M.A. Lutz, S.C. Dawson, P.L. Bond &amp; Banfield", "Acidomyces", null, null, null, "B.J. Baker, M.A. Lutz, S.C. Dawson, P.L. Bond &amp; Banfield");<a name="line.1872"></a>
<span class="sourceLineNo">1873</span>        assertParsedParts("Acidomyces richmondensis B.J. Baker, M.A. Lutz, S.C. Dawson, P.L. Bond &amp; Banfield, 2004", "Acidomyces", "richmondensis", null, null, "B.J. Baker, M.A. Lutz, S.C. Dawson, P.L. Bond &amp; Banfield", "2004");<a name="line.1873"></a>
<span class="sourceLineNo">1874</span>        assertParsedParts("Acrodictys liputii L. Cai, K.Q. Zhang, McKenzie, W.H. Ho &amp; K.D. Hyde", "Acrodictys", "liputii", null, null, "L. Cai, K.Q. Zhang, McKenzie, W.H. Ho &amp; K.D. Hyde");<a name="line.1874"></a>
<span class="sourceLineNo">1875</span>        assertParsedParts("×Attabignya minarum M.J.Balick, A.B.Anderson &amp; J.T.de Medeiros-Costa", "Attabignya", "minarum", null, NamePart.GENERIC, null, "M.J.Balick, A.B.Anderson &amp; J.T.de Medeiros-Costa", null);<a name="line.1875"></a>
<span class="sourceLineNo">1876</span>        assertParsedParts("Paenibacillus donghaensis Choi,J.H.; Im,W.T.; Yoo,J.S.; Lee,S.M.; Moon,D.S.; Kim,H.J.; Rhee,S.K.; Roh,D.H.", "Paenibacillus", "donghaensis", null, null, "Choi, J.H.; Im, W.T.; Yoo, J.S.; Lee, S.M.; Moon, D.S.; Kim, H.J.; Rhee, S.K.; Roh, D.H.");<a name="line.1876"></a>
<span class="sourceLineNo">1877</span>        assertParsedParts("Yamatocallis obscura (Ghosh, M.R., A.K. Ghosh &amp; D.N. Raychaudhuri, 1971", "Yamatocallis", "obscura", null, null, null);<a name="line.1877"></a>
<span class="sourceLineNo">1878</span>        assertParsedParts("Xanthotrogus tadzhikorum Nikolajev, 2008", "Xanthotrogus", "tadzhikorum", null, null, "Nikolajev", "2008");<a name="line.1878"></a>
<span class="sourceLineNo">1879</span>        assertParsedParts("Xylothamia G.L. Nesom, Y.B. Suh, D.R. Morgan &amp; B.B. Simpson, 1990", "Xylothamia", null, null, null, "G.L. Nesom, Y.B. Suh, D.R. Morgan &amp; B.B. Simpson", "1990");<a name="line.1879"></a>
<span class="sourceLineNo">1880</span>        assertParsedParts("Virginianthus E.M. Friis, H. Eklund, K.R. Pedersen &amp; P.R. Crane, 1994", "Virginianthus", null, null, null, "E.M. Friis, H. Eklund, K.R. Pedersen &amp; P.R. Crane", "1994");<a name="line.1880"></a>
<span class="sourceLineNo">1881</span>        assertParsedParts("Equicapillimyces hongkongensis S.S.Y. Wong, A.H.Y. Ngan, Riggs, J.L.L. Teng, G.K.Y. Choi, R.W.S. Poon, J.J.Y. Hui, F.J. Low, Luk", "Equicapillimyces", "hongkongensis", null, null, "S.S.Y. Wong, A.H.Y. Ngan, Riggs, J.L.L. Teng, G.K.Y. Choi, R.W.S. Poon, J.J.Y. Hui, F.J. Low, Luk");<a name="line.1881"></a>
<span class="sourceLineNo">1882</span><a name="line.1882"></a>
<span class="sourceLineNo">1883</span>        // these timeout so no author is parsed! Make sure canonical parsing works!<a name="line.1883"></a>
<span class="sourceLineNo">1884</span>        assertParsedParts("Oreocharis aurea var. cordato-ovata (C.Y. Wu ex H.W. Li) K.Y. Pan, A.L. Weitzman, &amp; L.E. Skog", "Oreocharis", "aurea", "cordato-ovata", "var.", null);<a name="line.1884"></a>
<span class="sourceLineNo">1885</span>        assertParsedParts("Candida mesorugosa G.M. Chaves, G.R. Terçarioli, A.C.B. Padovan, R. Rosas, R.C. Ferreira, A.S.A. Melo &amp; A.L. Colombo 20", "Candida", "mesorugosa", null, null);<a name="line.1885"></a>
<span class="sourceLineNo">1886</span>        assertParsedParts("Torulopsis deparaffina H.T. Gao, C.J. Mu, R.H. Li, L.G. Wei, W.Y. Tan, Yue Y. Li, Zhong Q. Li, X.Z. Zhang &amp; J.E. Wang 1979", "Torulopsis", "deparaffina", null, null);<a name="line.1886"></a>
<span class="sourceLineNo">1887</span>        assertParsedParts("Ophiocordyceps mrciensis (Aung, J.C. Kang, Z.Q. Liang, Soytong &amp; K.D. Hyde) G.H. Sung, J.M. Sung, Hywel-Jones &amp; Spatafora 200", "Ophiocordyceps", "mrciensis", null, null);<a name="line.1887"></a>
<span class="sourceLineNo">1888</span>        assertParsedParts("Paecilomyces hepiali Q.T. Chen &amp; R.Q. Dai ex R.Q. Dai, X.M. Li, A.J. Shao, Shu F. Lin, J.L. Lan, Wei H. Chen &amp; C.Y. Shen", "Paecilomyces", "hepiali", null, null);<a name="line.1888"></a>
<span class="sourceLineNo">1889</span>        assertParsedParts("Fusarium mexicanum Otero-Colina, Rodr.-Alvar., Fern.-Pavía, M. Maymon, R.C. Ploetz, T. Aoki, O'Donnell &amp; S. Freeman 201", "Fusarium", "mexicanum", null, null);<a name="line.1889"></a>
<span class="sourceLineNo">1890</span>        assertParsedParts("Cyrtodactylus bintangrendah Grismer, Wood Jr,  Quah, Anuar, Muin, Sumontha, Ahmad, Bauer, Wangkulangkul, Grismer9 &amp; Pauwels, 201", "Cyrtodactylus", "bintangrendah", null, null);<a name="line.1890"></a>
<span class="sourceLineNo">1891</span><a name="line.1891"></a>
<span class="sourceLineNo">1892</span>        // unparsables<a name="line.1892"></a>
<span class="sourceLineNo">1893</span>        assertUnparsableType(NameType.DOUBTFUL, "'38/89' designation is probably a typo");<a name="line.1893"></a>
<span class="sourceLineNo">1894</span>        assertUnparsableType(NameType.VIRUS, "Blainville's beaked whale gammaherpesvirus");<a name="line.1894"></a>
<span class="sourceLineNo">1895</span>    }<a name="line.1895"></a>
<span class="sourceLineNo">1896</span><a name="line.1896"></a>
<span class="sourceLineNo">1897</span>    @Test<a name="line.1897"></a>
<span class="sourceLineNo">1898</span>    public void testSpacelessAuthors() throws Exception {<a name="line.1898"></a>
<span class="sourceLineNo">1899</span><a name="line.1899"></a>
<span class="sourceLineNo">1900</span>        ParsedName pn = parser.parse("Abelmoschus moschatus Medik. subsp. tuberosus (Span.) Borss.Waalk.", null);<a name="line.1900"></a>
<span class="sourceLineNo">1901</span>        assertEquals("Abelmoschus", pn.getGenusOrAbove());<a name="line.1901"></a>
<span class="sourceLineNo">1902</span>        assertEquals("moschatus", pn.getSpecificEpithet());<a name="line.1902"></a>
<span class="sourceLineNo">1903</span>        assertEquals("tuberosus", pn.getInfraSpecificEpithet());<a name="line.1903"></a>
<span class="sourceLineNo">1904</span>        assertEquals("Borss.Waalk.", pn.getAuthorship());<a name="line.1904"></a>
<span class="sourceLineNo">1905</span>        assertEquals("Span.", pn.getBracketAuthorship());<a name="line.1905"></a>
<span class="sourceLineNo">1906</span>        assertEquals(NameType.SCIENTIFIC, pn.getType());<a name="line.1906"></a>
<span class="sourceLineNo">1907</span><a name="line.1907"></a>
<span class="sourceLineNo">1908</span>        pn = parser.parse("Acalypha hochstetteriana Müll.Arg.", null);<a name="line.1908"></a>
<span class="sourceLineNo">1909</span>        assertEquals("Acalypha", pn.getGenusOrAbove());<a name="line.1909"></a>
<span class="sourceLineNo">1910</span>        assertEquals("hochstetteriana", pn.getSpecificEpithet());<a name="line.1910"></a>
<span class="sourceLineNo">1911</span>        assertEquals("Müll.Arg.", pn.getAuthorship());<a name="line.1911"></a>
<span class="sourceLineNo">1912</span>        assertEquals(NameType.SCIENTIFIC, pn.getType());<a name="line.1912"></a>
<span class="sourceLineNo">1913</span><a name="line.1913"></a>
<span class="sourceLineNo">1914</span>        pn = parser.parse("Caloplaca variabilis (Pers.) Müll.Arg.", null);<a name="line.1914"></a>
<span class="sourceLineNo">1915</span>        assertEquals("Caloplaca", pn.getGenusOrAbove());<a name="line.1915"></a>
<span class="sourceLineNo">1916</span>        assertEquals("variabilis", pn.getSpecificEpithet());<a name="line.1916"></a>
<span class="sourceLineNo">1917</span>        assertEquals("Müll.Arg.", pn.getAuthorship());<a name="line.1917"></a>
<span class="sourceLineNo">1918</span>        assertEquals("Pers.", pn.getBracketAuthorship());<a name="line.1918"></a>
<span class="sourceLineNo">1919</span>        assertEquals(NameType.SCIENTIFIC, pn.getType());<a name="line.1919"></a>
<span class="sourceLineNo">1920</span><a name="line.1920"></a>
<span class="sourceLineNo">1921</span>        pn = parser.parse("Tridax imbricatus Sch.Bip.", null);<a name="line.1921"></a>
<span class="sourceLineNo">1922</span>        assertEquals("Tridax", pn.getGenusOrAbove());<a name="line.1922"></a>
<span class="sourceLineNo">1923</span>        assertEquals("imbricatus", pn.getSpecificEpithet());<a name="line.1923"></a>
<span class="sourceLineNo">1924</span>        assertEquals("Sch.Bip.", pn.getAuthorship());<a name="line.1924"></a>
<span class="sourceLineNo">1925</span>        assertEquals(NameType.SCIENTIFIC, pn.getType());<a name="line.1925"></a>
<span class="sourceLineNo">1926</span><a name="line.1926"></a>
<span class="sourceLineNo">1927</span>    }<a name="line.1927"></a>
<span class="sourceLineNo">1928</span><a name="line.1928"></a>
<span class="sourceLineNo">1929</span>    @Test<a name="line.1929"></a>
<span class="sourceLineNo">1930</span>    public void testViralNames() throws Exception {<a name="line.1930"></a>
<span class="sourceLineNo">1931</span>        assertTrue(isViralName("Vibrio phage 149 (type IV)"));<a name="line.1931"></a>
<span class="sourceLineNo">1932</span>        assertTrue(isViralName("Cactus virus 2"));<a name="line.1932"></a>
<span class="sourceLineNo">1933</span>        assertTrue(isViralName("Suid herpesvirus 3 Ictv"));<a name="line.1933"></a>
<span class="sourceLineNo">1934</span>        assertTrue(isViralName("Tomato yellow leaf curl Mali virus Ictv"));<a name="line.1934"></a>
<span class="sourceLineNo">1935</span>        assertTrue(isViralName("Not Sapovirus MC10"));<a name="line.1935"></a>
<span class="sourceLineNo">1936</span>        assertTrue(isViralName("Diolcogaster facetosa bracovirus"));<a name="line.1936"></a>
<span class="sourceLineNo">1937</span>        assertTrue(isViralName("Human papillomavirus"));<a name="line.1937"></a>
<span class="sourceLineNo">1938</span>        assertTrue(isViralName("Sapovirus Hu/GI/Nsc, 150/PA/Bra/, 1993"));<a name="line.1938"></a>
<span class="sourceLineNo">1939</span>        assertTrue(isViralName("Aspergillus mycovirus, 1816"));<a name="line.1939"></a>
<span class="sourceLineNo">1940</span>        assertTrue(isViralName("Hantavirus sdp2 Yxl-, 2008"));<a name="line.1940"></a>
<span class="sourceLineNo">1941</span>        assertTrue(isViralName("Norovirus Nizhny Novgorod /, 2461 / Rus /, 2007"));<a name="line.1941"></a>
<span class="sourceLineNo">1942</span>        assertTrue(isViralName("Carrot carlavirus WM-, 2008"));<a name="line.1942"></a>
<span class="sourceLineNo">1943</span>        assertTrue(isViralName("C2-like viruses"));<a name="line.1943"></a>
<span class="sourceLineNo">1944</span>        assertTrue(isViralName("C1 bacteriophage"));<a name="line.1944"></a>
<span class="sourceLineNo">1945</span>        assertTrue(isViralName("C-terminal Gfp fusion vector pUG23"));<a name="line.1945"></a>
<span class="sourceLineNo">1946</span>        assertTrue(isViralName("C-terminal Gfp fusion vector"));<a name="line.1946"></a>
<span class="sourceLineNo">1947</span>        assertTrue(isViralName("CMVd3 Flexi Vector pFN24K (HaloTag 7)"));<a name="line.1947"></a>
<span class="sourceLineNo">1948</span>        assertTrue(isViralName("bacteriophage, 315.6"));<a name="line.1948"></a>
<span class="sourceLineNo">1949</span>        assertTrue(isViralName("bacteriophages"));<a name="line.1949"></a>
<span class="sourceLineNo">1950</span>        assertTrue(isViralName("\"T1-like viruses\""));<a name="line.1950"></a>
<span class="sourceLineNo">1951</span><a name="line.1951"></a>
<span class="sourceLineNo">1952</span>        assertFalse(isViralName("Forcipomyia flavirustica Remm, 1968"));<a name="line.1952"></a>
<span class="sourceLineNo">1953</span><a name="line.1953"></a>
<span class="sourceLineNo">1954</span>    }<a name="line.1954"></a>
<span class="sourceLineNo">1955</span><a name="line.1955"></a>
<span class="sourceLineNo">1956</span>    @Test<a name="line.1956"></a>
<span class="sourceLineNo">1957</span>    public void testBacteriaNames() throws Exception {<a name="line.1957"></a>
<span class="sourceLineNo">1958</span>        assertUnparsableDoubtful("HMWdDNA-degrading marine bacterium 10");<a name="line.1958"></a>
<span class="sourceLineNo">1959</span>        assertUnparsableDoubtful("SAR11 cluster bacterium enrichment culture clone Pshtc-, 019");<a name="line.1959"></a>
<span class="sourceLineNo">1960</span>        assertUnparsableDoubtful("SR1 bacterium canine oral taxon, 369");<a name="line.1960"></a>
<span class="sourceLineNo">1961</span>        assertUnparsableDoubtful("bacterium 'glyphosate'");<a name="line.1961"></a>
<span class="sourceLineNo">1962</span>        assertUnparsableDoubtful("bacterium 'hafez'");<a name="line.1962"></a>
<span class="sourceLineNo">1963</span>        assertUnparsableDoubtful("bacterium A1");<a name="line.1963"></a>
<span class="sourceLineNo">1964</span>    }<a name="line.1964"></a>
<span class="sourceLineNo">1965</span><a name="line.1965"></a>
<span class="sourceLineNo">1966</span>    public boolean isViralName(String name) {<a name="line.1966"></a>
<span class="sourceLineNo">1967</span>        try {<a name="line.1967"></a>
<span class="sourceLineNo">1968</span>            ParsedName pn = parser.parse(name, null);<a name="line.1968"></a>
<span class="sourceLineNo">1969</span>        } catch (UnparsableException e) {<a name="line.1969"></a>
<span class="sourceLineNo">1970</span>            // swallow<a name="line.1970"></a>
<span class="sourceLineNo">1971</span>            if (NameType.VIRUS == e.type) {<a name="line.1971"></a>
<span class="sourceLineNo">1972</span>                return true;<a name="line.1972"></a>
<span class="sourceLineNo">1973</span>            }<a name="line.1973"></a>
<span class="sourceLineNo">1974</span>        }<a name="line.1974"></a>
<span class="sourceLineNo">1975</span>        return false;<a name="line.1975"></a>
<span class="sourceLineNo">1976</span>    }<a name="line.1976"></a>
<span class="sourceLineNo">1977</span><a name="line.1977"></a>
<span class="sourceLineNo">1978</span>    @Test<a name="line.1978"></a>
<span class="sourceLineNo">1979</span>    public void testWhitespaceEpitheta() throws Exception {<a name="line.1979"></a>
<span class="sourceLineNo">1980</span>        ParsedName n = parser.parse("Nupserha van rooni usambarica", null);<a name="line.1980"></a>
<span class="sourceLineNo">1981</span>        assertEquals("Nupserha", n.getGenusOrAbove());<a name="line.1981"></a>
<span class="sourceLineNo">1982</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.1982"></a>
<span class="sourceLineNo">1983</span>        assertEquals("van rooni", n.getSpecificEpithet());<a name="line.1983"></a>
<span class="sourceLineNo">1984</span>        assertEquals("usambarica", n.getInfraSpecificEpithet());<a name="line.1984"></a>
<span class="sourceLineNo">1985</span><a name="line.1985"></a>
<span class="sourceLineNo">1986</span>        n = parser.parse("Sargassum flavicans van pervillei", null);<a name="line.1986"></a>
<span class="sourceLineNo">1987</span>        assertEquals("Sargassum", n.getGenusOrAbove());<a name="line.1987"></a>
<span class="sourceLineNo">1988</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.1988"></a>
<span class="sourceLineNo">1989</span>        assertEquals("flavicans", n.getSpecificEpithet());<a name="line.1989"></a>
<span class="sourceLineNo">1990</span>        assertEquals("van pervillei", n.getInfraSpecificEpithet());<a name="line.1990"></a>
<span class="sourceLineNo">1991</span><a name="line.1991"></a>
<span class="sourceLineNo">1992</span>        n = parser.parse("Salix novae angliae lingulata ", null);<a name="line.1992"></a>
<span class="sourceLineNo">1993</span>        assertEquals("Salix", n.getGenusOrAbove());<a name="line.1993"></a>
<span class="sourceLineNo">1994</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.1994"></a>
<span class="sourceLineNo">1995</span>        assertEquals("novae angliae", n.getSpecificEpithet());<a name="line.1995"></a>
<span class="sourceLineNo">1996</span>        assertEquals("lingulata", n.getInfraSpecificEpithet());<a name="line.1996"></a>
<span class="sourceLineNo">1997</span><a name="line.1997"></a>
<span class="sourceLineNo">1998</span>        n = parser.parse("Ilex collina van trompii", null);<a name="line.1998"></a>
<span class="sourceLineNo">1999</span>        assertEquals("Ilex", n.getGenusOrAbove());<a name="line.1999"></a>
<span class="sourceLineNo">2000</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.2000"></a>
<span class="sourceLineNo">2001</span>        assertEquals("collina", n.getSpecificEpithet());<a name="line.2001"></a>
<span class="sourceLineNo">2002</span>        assertEquals("van trompii", n.getInfraSpecificEpithet());<a name="line.2002"></a>
<span class="sourceLineNo">2003</span><a name="line.2003"></a>
<span class="sourceLineNo">2004</span>        n = parser.parse("Gaultheria depressa novae zealandiae", null);<a name="line.2004"></a>
<span class="sourceLineNo">2005</span>        assertEquals("Gaultheria", n.getGenusOrAbove());<a name="line.2005"></a>
<span class="sourceLineNo">2006</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.2006"></a>
<span class="sourceLineNo">2007</span>        assertEquals("depressa", n.getSpecificEpithet());<a name="line.2007"></a>
<span class="sourceLineNo">2008</span>        assertEquals("novae zealandiae", n.getInfraSpecificEpithet());<a name="line.2008"></a>
<span class="sourceLineNo">2009</span><a name="line.2009"></a>
<span class="sourceLineNo">2010</span>        n = parser.parse("Caraguata van volxemi gracilior", null);<a name="line.2010"></a>
<span class="sourceLineNo">2011</span>        assertEquals("Caraguata", n.getGenusOrAbove());<a name="line.2011"></a>
<span class="sourceLineNo">2012</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.2012"></a>
<span class="sourceLineNo">2013</span>        assertEquals("van volxemi", n.getSpecificEpithet());<a name="line.2013"></a>
<span class="sourceLineNo">2014</span>        assertEquals("gracilior", n.getInfraSpecificEpithet());<a name="line.2014"></a>
<span class="sourceLineNo">2015</span><a name="line.2015"></a>
<span class="sourceLineNo">2016</span>        n = parser.parse("Ancistrocerus agilis novae guineae", null);<a name="line.2016"></a>
<span class="sourceLineNo">2017</span>        assertEquals("Ancistrocerus", n.getGenusOrAbove());<a name="line.2017"></a>
<span class="sourceLineNo">2018</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.2018"></a>
<span class="sourceLineNo">2019</span>        assertEquals("agilis", n.getSpecificEpithet());<a name="line.2019"></a>
<span class="sourceLineNo">2020</span>        assertEquals("novae guineae", n.getInfraSpecificEpithet());<a name="line.2020"></a>
<span class="sourceLineNo">2021</span><a name="line.2021"></a>
<span class="sourceLineNo">2022</span>        // also test the authorless parsing<a name="line.2022"></a>
<span class="sourceLineNo">2023</span>        n = parser.parse("Ancistrocerus agilis novae guineae", null);<a name="line.2023"></a>
<span class="sourceLineNo">2024</span>        assertEquals("Ancistrocerus", n.getGenusOrAbove());<a name="line.2024"></a>
<span class="sourceLineNo">2025</span>        assertTrue(n.getInfraGeneric() == null);<a name="line.2025"></a>
<span class="sourceLineNo">2026</span>        assertEquals("agilis", n.getSpecificEpithet());<a name="line.2026"></a>
<span class="sourceLineNo">2027</span>        assertEquals("novae guineae", n.getInfraSpecificEpithet());<a name="line.2027"></a>
<span class="sourceLineNo">2028</span>    }<a name="line.2028"></a>
<span class="sourceLineNo">2029</span><a name="line.2029"></a>
<span class="sourceLineNo">2030</span>    @Test<a name="line.2030"></a>
<span class="sourceLineNo">2031</span>    @Ignore<a name="line.2031"></a>
<span class="sourceLineNo">2032</span>    public void manuallyTestProblematicName() throws Exception {<a name="line.2032"></a>
<span class="sourceLineNo">2033</span>        for (String n : new String[]{<a name="line.2033"></a>
<span class="sourceLineNo">2034</span>                "Tragacantha leporina (?) Kuntze",<a name="line.2034"></a>
<span class="sourceLineNo">2035</span>                "Lachenalia tricolor var. nelsonii (anon.) Baker",<a name="line.2035"></a>
<span class="sourceLineNo">2036</span>                "Lachenalia tricolor var. nelsonii (ht.) Baker",<a name="line.2036"></a>
<span class="sourceLineNo">2037</span>                "Lachenalia tricolor var. nelsonii (hort.) Baker",<a name="line.2037"></a>
<span class="sourceLineNo">2038</span>                "Puya acris ht.",<a name="line.2038"></a>
<span class="sourceLineNo">2039</span>                "Puya acris hort.",<a name="line.2039"></a>
<span class="sourceLineNo">2040</span>                "Cortinarius angulatus B gracilescens Fr. 1838",<a name="line.2040"></a>
<span class="sourceLineNo">2041</span>                "Salmonella werahensis (Castellani) Hauduroy and Ehringer in Hauduroy 1937",<a name="line.2041"></a>
<span class="sourceLineNo">2042</span>                "Asplenium X inexpectatum (E.L. Braun 1940) Morton (1956)",<a name="line.2042"></a>
<span class="sourceLineNo">2043</span>                "Geranium exili Standl. in R. Knuth",<a name="line.2043"></a>
<span class="sourceLineNo">2044</span>                "Lestodiplosis cryphali Kieffer 1894 1901",<a name="line.2044"></a>
<span class="sourceLineNo">2045</span>                "Cathormiocerus inflatiscapus Escalera, M.M. de la 1918",<a name="line.2045"></a>
<span class="sourceLineNo">2046</span>                "Coracopsis nigra sibilans Milne-Edwards &amp; OuStalet, 1885",<a name="line.2046"></a>
<span class="sourceLineNo">2047</span>                "Trichoglossus haematodus deplanchii J. Verreaux &amp; Des Murs, 1860",<a name="line.2047"></a>
<span class="sourceLineNo">2048</span>                "Anolis porcatus aracelyae Perez-Beato, 1996",<a name="line.2048"></a>
<span class="sourceLineNo">2049</span>                "Anolis marmoratus girafus Lazell, 1964"<a name="line.2049"></a>
<span class="sourceLineNo">2050</span>        }) {<a name="line.2050"></a>
<span class="sourceLineNo">2051</span>            System.out.println(parser.parse(n, null));<a name="line.2051"></a>
<span class="sourceLineNo">2052</span>        }<a name="line.2052"></a>
<span class="sourceLineNo">2053</span><a name="line.2053"></a>
<span class="sourceLineNo">2054</span>    }<a name="line.2054"></a>
<span class="sourceLineNo">2055</span><a name="line.2055"></a>
<span class="sourceLineNo">2056</span>}<a name="line.2056"></a>
<span class="sourceLineNo">2057</span><a name="line.2057"></a>
<span class="sourceLineNo">2058</span><a name="line.2058"></a>
<span class="sourceLineNo">2059</span><a name="line.2059"></a>




























































</pre>
</div>
</body>
</html>